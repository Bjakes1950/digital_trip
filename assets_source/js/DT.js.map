{
  "version": 3,
  "file": "DT.js",
  "sources": [
    "js/vendor/fireworks-bundle.js",
    "js/vendor/Detector.js",
    "js/vendor/threex.windowresize.js",
    "js/vendor/Stats.js",
    "js/vendor/webaudio.js",
    "js/vendor/THREEx.FullScreen.js",
    "js/vendor/AnaglyphEffect.js",
    "js/init.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC74CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,M",
  "sourcesContent": [
    "\n\n/**\n * Global namespace for the whole library\n * @namespace Global namespace for the whole library\n * @type {Object}\n */\nvar Fireworks\t= {};\n\n/**\n * enable or disable debug in the library\n * @type {Boolean}\n */\nFireworks.debug\t= true;//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.EffectsStackBuilder\t= function(emitter){\n\tthis._emitter\t= emitter;\n};\n\n/**\n * Getter for the emitter \n*/\nFireworks.EffectsStackBuilder.prototype.emitter\t= function(){\n\treturn this._emitter;\t\n};\n\nFireworks.EffectsStackBuilder.prototype.back\t= function(){\n\treturn this._emitter;\n}\n\nFireworks.EffectsStackBuilder.prototype.createEffect\t= function(name, opts){\n\tvar creator\t= Fireworks.createEffect(name, opts).pushTo(this._emitter).back(this);\n\tcreator.effect().emitter(this._emitter);\n\treturn creator;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Basic Fireworks.Effect builder\n*/\nFireworks.createEffect\t= function(name, opts){\n\t// handle polymophism\n\tif( typeof(name) === 'object' ){\n\t\topts\t= name;\n\t\tname\t= undefined;\n\t}\n\t\n\tvar effect\t= new Fireworks.Effect();\n\teffect.opts\t= opts;\n\teffect.name\t= name;\n\teffect.back\t= null;\n\tvar methods\t= {\n\t\tonCreate: function(val){\n\t\t\teffect.onCreate\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonBirth: function(val){\n\t\t\teffect.onBirth\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonUpdate: function(val){\n\t\t\teffect.onUpdate\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonDeath: function(val){\n\t\t\teffect.onDeath\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonPreUpdate: function(val){\n\t\t\teffect.onPreUpdate\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonPreRender: function(val){\n\t\t\teffect.onPreRender\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonRender: function(val){\n\t\t\teffect.onRender\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonPostRender: function(val){\n\t\t\teffect.onPostRender\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonIntensityChange: function(val){\n\t\t\teffect.onIntensityChange= val;\n\t\t\treturn methods;\n\t\t},\n\t\tpushTo\t: function(emitter){\n\t\t\temitter.effects().push(effect);\n\t\t\treturn methods;\t\n\t\t},\n\t\tback\t: function(value){\n\t\t\tif( value === undefined )\treturn effect.back;\t\n\t\t\teffect.back\t= value;\n\t\t\treturn methods;\t\n\t\t},\n\t\teffect\t: function(){\n\t\t\treturn effect;\n\t\t}\n\t}\n\treturn methods;\n}\n\n/**\n * An effect to apply on particles\n*/\nFireworks.Effect\t= function(){\n\tthis._emitter\t= null;\n}\n\nFireworks.Effect.prototype.destroy\t= function(){\n}\n\n/**\n * Getter/Setter for the emitter \n*/\nFireworks.Effect.prototype.emitter\t= function(value){\n\tif( value === undefined )\treturn this._emitter;\t\n\tthis._emitter\t= value;\n\treturn this;\t\n};\n\n/**\n * Callback called on particle creation\n*/\n//Fireworks.Effect.prototype.onCreate\t= function(){\n//}\n//\n/**\n * Callback called when a particle is spawning\n *\n * TODO to rename onSpawn\n*/\n//Fireworks.Effect.prototype.onBirth\t= function(){\n//}\n//\n//Fireworks.Effect.prototype.onDeath\t= function(){\n//}\n//\n//Fireworks.Effect.prototype.onUpdate\t= function(){\n//}\n\nFireworks.createEmitter\t= function(opts){\n\treturn new Fireworks.Emitter(opts);\n}\n\n/**\n * The emitter of particles\n*/\nFireworks.Emitter\t= function(opts){\n\tthis._nParticles\t= opts.nParticles !== undefined ? opts.nParticles : 100;\n\tthis._particles\t\t= [];\n\tthis._effects\t\t= [];\n\tthis._started\t\t= false;\n\tthis._onUpdated\t\t= null;\n\tthis._intensity\t\t= 0;\n\tthis._maxDeltaTime\t= 1/3;\n\n\tthis._effectsStackBuilder\t= new Fireworks.EffectsStackBuilder(this)\n}\n\nFireworks.Emitter.prototype.destroy\t= function()\n{\n\tthis._effects.forEach(function(effect){\n\t\teffect.destroy();\n\t});\n\tthis._particles.forEach(function(particle){\n\t\tparticle.destroy();\n\t});\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tGetters\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.Emitter.prototype.effects\t= function(){\n\treturn this._effects;\n}\nFireworks.Emitter.prototype.effect\t= function(name){\n\tfor(var i = 0; i < this._effects.length; i++){\n\t\tvar effect\t= this._effects[i];\n\t\tif( effect.name === name )\treturn effect;\n\t}\n\treturn null;\n}\n\nFireworks.Emitter.prototype.particles\t= function(){\n\treturn this._particles;\n}\nFireworks.Emitter.prototype.liveParticles\t= function(){\n\treturn this._liveParticles;\n}\nFireworks.Emitter.prototype.deadParticles\t= function(){\n\treturn this._deadParticles;\n}\nFireworks.Emitter.prototype.nParticles\t= function(){\n\treturn this._nParticles;\n}\n\nFireworks.Emitter.prototype.effectsStackBuilder\t= function(){\n\treturn this._effectsStackBuilder;\n}\n\n\n/**\n * Getter/setter for intensity\n*/\nFireworks.Emitter.prototype.intensity\t= function(value){\n\t// if it is a getter, return value\n\tif( value === undefined )\treturn this._intensity;\n\t// if the value didnt change, return for chained api\n\tif( value === this._intensity )\treturn this;\n\t// sanity check\n\tFireworks.debug && console.assert( value >= 0, 'Fireworks.Emitter.intensity: invalid value.', value);\n\tFireworks.debug && console.assert( value <= 1, 'Fireworks.Emitter.intensity: invalid value.', value);\n\t// backup the old value\n\tvar oldValue\t= this._intensity;\n\t// update the value\n\tthis._intensity\t= value;\n\t// notify all effects\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onIntensityChange )\treturn;\n\t\teffect.onIntensityChange(this._intensity, oldValue);\t\t\t\n\t}.bind(this));\n\treturn this;\t// for chained API\n}\n\n/**\n * Getter/setter for intensity\n*/\nFireworks.Emitter.prototype.maxDeltaTime\t= function(value){\n\tif( value === undefined )\treturn this._maxDeltaTime;\n\tthis._maxDeltaTime\t= value;\n\treturn this;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tbackward compatibility\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.Emitter.prototype.setParticleData\t= function(particle, namespace, value){\n\tparticle[namespace] = value;\n}\n\nFireworks.Emitter.prototype.getParticleData\t= function(particle, namespace){\n\treturn particle[namespace];\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tStart function\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.Emitter.prototype.start\t= function()\n{\n\tconsole.assert( this._effects.length > 0, \"At least one effect MUST be set\")\n\tconsole.assert( this._started === false );\n\t\n\tthis._particles\t\t= new Array(this._nParticles);\n\tfor(var i = 0; i < this._nParticles; i++){\n\t\tthis._particles[i]\t= new Fireworks.Particle();\n\t}\n\n\tthis._liveParticles\t= [];\n\tthis._deadParticles\t= this._particles.slice(0);\n\tthis._started\t\t= true;\n\n\t// onCreate on all particles\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onCreate )\treturn;\n\t\tthis._particles.forEach(function(particle, particleIdx){\n\t\t\teffect.onCreate(particle, particleIdx);\t\t\t\n\t\t})\n\t}.bind(this));\n\t// set the intensity to 1\n\tthis.intensity(1)\n\n\treturn this;\t// for chained API\n}\n\nFireworks.Emitter.prototype.update\t= function(deltaTime){\n\t// bound the deltaTime to this._maxDeltaTime\n\tdeltaTime\t= Math.min(this._maxDeltaTime, deltaTime)\n\t// honor effect.onPreUpdate\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onPreUpdate )\treturn;\n\t\teffect.onPreUpdate(deltaTime);\t\t\t\n\t}.bind(this));\n\t// update each particles\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onUpdate )\treturn;\n\t\tthis._liveParticles.forEach(function(particle){\n\t\t\teffect.onUpdate(particle, deltaTime);\t\t\t\n\t\t})\n\t}.bind(this));\n\treturn this;\t// for chained API\n}\n\nFireworks.Emitter.prototype.render\t= function(){\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onPreRender )\treturn;\n\t\teffect.onPreRender();\t\t\t\n\t}.bind(this));\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onRender )\treturn;\n\t\tthis._liveParticles.forEach(function(particle){\n\t\t\teffect.onRender(particle);\t\t\t\n\t\t})\n\t}.bind(this));\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onPostRender )\treturn;\n\t\teffect.onPostRender();\t\t\t\n\t}.bind(this));\n\treturn this;\t// for chained API\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * kill this particle\n*/\nFireworks.Emitter.prototype.killParticle\t= function(particle)\n{\n\tvar idx\t= this._liveParticles.indexOf(particle);\n\t// sanity check\n\tFireworks.debug && console.assert( idx !== -1 );\n\tthis._liveParticles.splice(idx, 1)\n\tthis._deadParticles.push(particle);\n\t// do the death on all effects\n\tthis.effects().forEach(function(effect){\n\t\teffect.onDeath && effect.onDeath(particle);\t\t\t\n\t}.bind(this));\n}\n\n/**\n * Spawn a particle\n*/\nFireworks.Emitter.prototype.spawnParticle\t= function(){\n\t// sanity check\n\tFireworks.debug && console.assert(this._deadParticles.length >= 1, 'no more particle available' );\n\t// change the particles \n\tvar particle\t= this.deadParticles().pop();\n\tthis.liveParticles().push(particle);\n\t// do the birth on all effects\n\tthis.effects().forEach(function(effect){\n\t\teffect.onBirth && effect.onBirth(particle);\t\t\t\n\t}.bind(this));\n}\nFireworks.createLinearGradient\t= function(opts){\n\tvar LinearGradient\t= new Fireworks.LinearGradient(opts);\n\treturn LinearGradient;\n}\n\n/**\n * The emitter of particles\n*/\nFireworks.LinearGradient\t= function(opts){\n\tthis._keyPoints\t= [];\n}\n\nFireworks.LinearGradient.prototype.push\t= function(x, y){\n\tthis._keyPoints.push({\n\t\tx\t: x,\n\t\ty\t: y\n\t});\n\treturn this;\n}\n\n/**\n * Compute a value for this LinearGradient\n*/\nFireworks.LinearGradient.prototype.get\t= function(x){\n\tfor( var i = 0; i < this._keyPoints.length; i++ ){\n\t\tvar keyPoint\t= this._keyPoints[i];\n\t\tif( x <= keyPoint.x )\tbreak;\n\t}\n\n\tif( i === 0 )\treturn this._keyPoints[0].y;\n\n\t// sanity check\n\tFireworks.debug && console.assert(i < this._keyPoints.length );\n\n\tvar prev\t= this._keyPoints[i-1];\n\tvar next\t= this._keyPoints[i];\n\t\n\tvar ratio\t= (x - prev.x) / (next.x - prev.x)\n\tvar y\t\t= prev.y + ratio * (next.y - prev.y)\n\t\n\treturn y;\n};\n/**\n * The emitter of particles\n*/\nFireworks.Particle\t= function(){\n}\n\nFireworks.Particle.prototype.set\t= function(key, value){\n\t// sanity check\n\tFireworks.debug && console.assert( this[key] === undefined, \"key already defined: \"+key );\n\t\n\tthis[key]\t= value;\n\treturn this[key];\n}\n\nFireworks.Particle.prototype.get\t= function(key){\n\tFireworks.debug && console.assert( this[key] !== undefined, \"key undefined: \"+key );\n\treturn this[key];\n}\n\nFireworks.Particle.prototype.has\t= function(key){\n\treturn this[key] !== undefined\t? true : false;\n}\nFireworks.Shape\t= function(){\n}\n\n///**\n// * @param {Fireworks.Vector} point the point coordinate to test\n// * @returns {Boolean} true if point is inside the shape, false otherwise\n//*/\n//Fireworks.Shape.prototype.contains\t= function(point){\n//}\n//\n///**\n// * generate a random point contained in this shape\n// * @returns {Fireworks.Vector} the just generated random point\n//*/\n//Firefly.Shape.prototype.randomPoint\t= function(vector){\n//}\nFireworks.createVector = function(x, y, z){\n\treturn new Fireworks.Vector(x,y,z);\n};\n\n/**\n * jme- copy of THREE.Vector3 https://github.com/mrdoob/three.js/blob/master/src/core/Vector3.js\n *\n * @author mr.doob / http://mrdoob.com/\n * @author kile / http://kile.stravaganza.org/\n * @author philogb / http://blog.thejit.org/\n * @author mikael emtinger / http://gomo.se/\n * @author egraether / http://egraether.com/\n */\n\nFireworks.Vector = function ( x, y, z ) {\n\n\tthis.x = x || 0;\n\tthis.y = y || 0;\n\tthis.z = z || 0;\n\n};\n\n\nFireworks.Vector.prototype = {\n\n\tconstructor: Fireworks.Vector,\n\n\tset: function ( x, y, z ) {\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\n\tsetX: function ( x ) {\n\n\t\tthis.x = x;\n\n\t\treturn this;\n\n\t},\n\n\tsetY: function ( y ) {\n\n\t\tthis.y = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetZ: function ( z ) {\n\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\t\n\trandom\t: function( ) {\n\t\tthis.x\t= Math.random() - 0.5;\n\t\tthis.y\t= Math.random() - 0.5;\n\t\tthis.z\t= Math.random() - 0.5;\n\t\treturn this;\n\t}, // jme - added\n\t\n\ttoString\t: function(){\n\t\treturn JSON.stringify(this);\n\t}, // jme - added\n\n\tcopy: function ( v ) {\n\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\n\t\treturn this;\n\n\t},\n\n\tadd: function ( a, b ) {\n\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\t\tthis.z = a.z + b.z;\n\n\t\treturn this;\n\n\t},\n\n\taddSelf: function ( v ) {\n\n\t\tthis.x += v.x;\n\t\tthis.y += v.y;\n\t\tthis.z += v.z;\n\n\t\treturn this;\n\n\t},\n\n\taddScalar: function ( s ) {\n\n\t\tthis.x += s;\n\t\tthis.y += s;\n\t\tthis.z += s;\n\n\t\treturn this;\n\n\t},\n\n\tsub: function ( a, b ) {\n\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\t\tthis.z = a.z - b.z;\n\n\t\treturn this;\n\n\t},\n\n\tsubSelf: function ( v ) {\n\n\t\tthis.x -= v.x;\n\t\tthis.y -= v.y;\n\t\tthis.z -= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( a, b ) {\n\n\t\tthis.x = a.x * b.x;\n\t\tthis.y = a.y * b.y;\n\t\tthis.z = a.z * b.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplySelf: function ( v ) {\n\n\t\tthis.x *= v.x;\n\t\tthis.y *= v.y;\n\t\tthis.z *= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( s ) {\n\n\t\tthis.x *= s;\n\t\tthis.y *= s;\n\t\tthis.z *= s;\n\n\t\treturn this;\n\n\t},\n\n\tdivideSelf: function ( v ) {\n\n\t\tthis.x /= v.x;\n\t\tthis.y /= v.y;\n\t\tthis.z /= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tdivideScalar: function ( s ) {\n\n\t\tif ( s ) {\n\n\t\t\tthis.x /= s;\n\t\t\tthis.y /= s;\n\t\t\tthis.z /= s;\n\n\t\t} else {\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\t\t\tthis.z = 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\n\tnegate: function() {\n\n\t\treturn this.multiplyScalar( - 1 );\n\n\t},\n\n\tdot: function ( v ) {\n\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\n\n\t},\n\n\tlengthSq: function () {\n\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\n\n\t},\n\n\tlength: function () {\n\n\t\treturn Math.sqrt( this.lengthSq() );\n\n\t},\n\n\tnormalize: function () {\n\n\t\treturn this.divideScalar( this.length() );\n\n\t},\n\n\tsetLength: function ( l ) {\n\n\t\treturn this.normalize().multiplyScalar( l );\n\n\t},\n\t\n\tcross: function ( a, b ) {\n\n\t\tthis.x = a.y * b.z - a.z * b.y;\n\t\tthis.y = a.z * b.x - a.x * b.z;\n\t\tthis.z = a.x * b.y - a.y * b.x;\n\n\t\treturn this;\n\n\t},\n\n\tcrossSelf: function ( v ) {\n\n\t\tvar x = this.x, y = this.y, z = this.z;\n\n\t\tthis.x = y * v.z - z * v.y;\n\t\tthis.y = z * v.x - x * v.z;\n\t\tthis.z = x * v.y - y * v.x;\n\n\t\treturn this;\n\n\t},\n\n\tdistanceTo: function ( v ) {\n\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\n\n\t},\n\n\tdistanceToSquared: function ( v ) {\n\n\t\treturn new Fireworks.Vector().sub( this, v ).lengthSq();\n\n\t},\n\n\tequals: function ( v ) {\n\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\n\n\t},\n\n\tisZero: function () {\n\n\t\treturn ( this.lengthSq() < 0.0001 /* almostZero */ );\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new Fireworks.Vector( this.x, this.y, this.z );\n\n\t}\n\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.acceleration\t= function(opts)\n{\n\topts\t\t= opts\t\t|| {};\n\tvar effectId\t= opts.effectId\t|| 'acceleration';\n\tconsole.assert( opts.shape instanceof Fireworks.Shape );\n\t// create the effect itself\n\tFireworks.createEffect(effectId, {\n\t\tshape\t: opts.shape\n\t}).onCreate(function(particle){\n\t\tparticle.acceleration = {\n\t\t\tvector\t: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar acceleration= particle.acceleration.vector;\n\t\tthis.opts.shape.randomPoint(acceleration)\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tvar acceleration= particle.acceleration.vector;\n\t\tvelocity.x\t+= acceleration.x * deltaTime;\n\t\tvelocity.y\t+= acceleration.y * deltaTime;\n\t\tvelocity.z\t+= acceleration.z * deltaTime;\n\t}).pushTo(this._emitter);\n\n\treturn this;\t// for chained API\n};\n/**\n * Handle the friction - aka a value between 0 and 1 which multiply the velocity\n *\n * @param {Number} value the friction number between 0 and 1\n*/\nFireworks.EffectsStackBuilder.prototype.friction = function(value)\n{\n\t// handle parameter polymorphism\n\tvalue = value !== undefined ? value : 1;\n\t// sanity check\n\tconsole.assert( value >= 0 && value <= 1.0 );\n\t// create the effect itself\n\tFireworks.createEffect('friction')\n\t.onCreate(function(particle, particleIdx){\n\t\tparticle.friction = {\n\t\t\tvalue: value\n\t\t};\n\t})\n\t.onBirth(function(particle){\n\t\tvar data = particle.friction;\n\t\tdata.value = value\n\t})\n\t.onUpdate(function(particle){\n\t\tvar friction = particle.friction.value;\n\t\tvar velocity = particle.velocity.vector;\n\t\tvelocity.multiplyScalar(friction);\n\t})\n\t.pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.lifeTime = function(minAge, maxAge)\n{\n\t// sanity check\n\tconsole.assert( minAge !== undefined )\n\t// if maxAge isnt \n\tif( maxAge === undefined )\tmaxAge\t= minAge;\n\tconsole.assert( maxAge !== undefined )\n\t// create the effect itself\n\tvar emitter\t= this._emitter;\n\tFireworks.createEffect('lifeTime', {\n\t\tminAge\t: minAge,\n\t\tmaxAge\t: maxAge\n\t}).onCreate(function(particle){\n\t\tvar data\t= particle.lifeTime = {\n\t\t\tcurAge\t: 0,\n\t\t\tminAge\t: 0,\n\t\t\tmaxAge\t: 0,\n\t\t\tnormalizedAge\t: function(){\n\t\t\t\treturn (data.curAge - data.minAge) / (data.maxAge - data.minAge);\n\t\t\t}\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar lifeTime\t= particle.lifeTime;\n\t\tlifeTime.curAge\t= 0;\n\t\tlifeTime.maxAge\t= this.opts.minAge + Math.random() * (this.opts.maxAge - this.opts.minAge);\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar lifeTime\t= particle.lifeTime;\n\t\tlifeTime.curAge\t+= deltaTime;\n\t\tif( lifeTime.curAge > lifeTime.maxAge )\temitter.killParticle(particle);\n\t}).pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.position = function(shape)\n{\n\tconsole.assert( shape instanceof Fireworks.Shape );\n\tFireworks.createEffect('position', {\n\t\tshape: shape\n\t}).onCreate(function(particle){\n\t\tparticle.position = {\n\t\t\tvector: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar position = particle.position.vector;\n\t\tthis.opts.shape.randomPoint(position)\n\t}).pushTo(this._emitter);\n\treturn this; // for chained API\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.radialVelocity = function(minSpeed, maxSpeed)\n{\n\tFireworks.createEffect('radialVelocity', {\n\t\tminSpeed: minSpeed,\n\t\tmaxSpeed: maxSpeed\n\t}).onCreate(function(particle){\n\t\tparticle.velocity = {\n\t\t\tvector: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle, deltaTime){\n\t\tvar position = particle.position.vector;\n\t\tvar velocity = particle.velocity.vector;\n\t\tvar length = this.opts.minSpeed + (this.opts.maxSpeed - this.opts.minSpeed) * Math.random();\n\t\tvelocity.copy(position).setLength(length);\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar position = particle.position.vector;\n\t\tvar velocity = particle.velocity.vector;\n\t\tposition.x += velocity.x * deltaTime;\n\t\tposition.y += velocity.y * deltaTime;\n\t\tposition.z += velocity.z * deltaTime;\n\t}).pushTo(this._emitter);\n\n\treturn this; // for chained API\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.randomVelocityDrift\t= function(drift)\n{\n\t// create the effect itself\n\tFireworks.createEffect('randomVelocityDrift', {\n\t\tdrift\t: drift\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tvelocity.x\t+= (Math.random()*2 - 1) * this.opts.drift.x * deltaTime;\n\t\tvelocity.y\t+= (Math.random()*2 - 1) * this.opts.drift.y * deltaTime;\n\t\tvelocity.z\t+= (Math.random()*2 - 1) * this.opts.drift.z * deltaTime;\n\t}).pushTo(this._emitter);\n\t// return for chained API\n\treturn this;\t// for chained API\n};\n/**\n * Create a velocity effect\n * @param {Fireworks.Shape}\tshape\tset the direction of the velocity by a randompoint in this shape\n * @param {Number?}\t\tspeed\tset the speed itself. if undefined, keep randompoint length for speed\n*/\nFireworks.EffectsStackBuilder.prototype.velocity\t= function(shape, speed)\n{\n\tFireworks.createEffect('velocity', {\n\t\tshape\t: shape, \n\t\tspeed\t: speed !== undefined ? speed : -1\n\t}).onCreate(function(particle){\n\t\tparticle.velocity = {\n\t\t\tvector\t: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tthis.opts.shape.randomPoint(velocity)\n\t\tif( this.opts.speed !== -1 )\tvelocity.setLength(this.opts.speed);\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar position\t= particle.position.vector;\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tposition.x\t+= velocity.x * deltaTime;\n\t\tposition.y\t+= velocity.y * deltaTime;\n\t\tposition.z\t+= velocity.z * deltaTime;\n\t}).pushTo(this._emitter);\n\n\treturn this;\t// for chained API\n};\n/**\n * Shortcut to create Fireworks.Shape.Box\n*/\nFireworks.createShapeBox\t= function(positionX, positionY, positionZ, sizeX, sizeY, sizeZ){\n\tvar position\t= new Fireworks.Vector(positionX, positionY, positionZ);\n\tvar size\t= new Fireworks.Vector(sizeX, sizeY, sizeZ);\n\treturn new Fireworks.Shape.Box(position, size);\n};\n\n/**\n * Handle a Firework.Shape forming a sphere\n *\n * @param {Fireworks.Vector} position the position of the sphape\n * @param {Fireworks.Vector} shape the size of the shape\n*/\nFireworks.Shape.Box\t= function(position, size)\n{\n\tthis.position\t= position;\n\tthis.size\t= size;\n\tthis._vector\t= new Fireworks.Vector();\n}\n\n// inherit from Fireworks.Effect\nFireworks.Shape.Box.prototype = new Fireworks.Shape();\nFireworks.Shape.Box.prototype.constructor = Fireworks.Shape.Box;\n\nFireworks.Shape.Box.prototype.contains\t= function(point){\n\t// compute delta between the point and the position\n\tvar delta\t= this._vector.sub(point, this.position);\n\t// test the delta is too far\n\tif( Math.abs(delta.x) > this.size.x/2 )\treturn false;\n\tif( Math.abs(delta.y) > this.size.y/2 )\treturn false;\n\tif( Math.abs(delta.z) > this.size.z/2 )\treturn false;\n\t// if all tests, passed true\n\treturn true;\n}\n\nFireworks.Shape.Box.prototype.randomPoint\t= function(vector){\n\tvar point\t= vector\t|| this._vector;\n\t// get a random point\n\tpoint.x\t= Math.random() * this.size.x - this.size.x/2;\n\tpoint.y\t= Math.random() * this.size.y - this.size.y/2;\n\tpoint.z\t= Math.random() * this.size.z - this.size.z/2;\n\t// add this.position\n\tpoint.addSelf(this.position);\n\t// return the point\n\treturn point;\n}\n/**\n * Shortcut to create Fireworks.Shape.Point\n*/\nFireworks.createShapePoint\t= function(positionX, positionY, positionZ){\n\tvar position\t= new Fireworks.Vector(positionX, positionY, positionZ);\n\treturn new Fireworks.Shape.Point(position);\n};\n\n/**\n * Handle a Firework.Shape forming a point\n *\n * @param {Fireworks.Vector} position the position of the point\n*/\nFireworks.Shape.Point\t= function(position)\n{\n\tthis.position\t= position;\n\tthis._vector\t= new Fireworks.Vector();\n}\n\n// inherit from Fireworks.Effect\nFireworks.Shape.Point.prototype = new Fireworks.Shape();\nFireworks.Shape.Point.prototype.constructor = Fireworks.Shape.Point;\n\nFireworks.Shape.Point.prototype.contains\t= function(point){\n\tif( point.x !== this.position.x )\treturn false;\n\tif( point.y !== this.position.y )\treturn false;\n\tif( point.z !== this.position.z )\treturn false;\n\t// if all tests, passed true\n\treturn true;\n}\n\nFireworks.Shape.Point.prototype.randomPoint\t= function(vector){\n\tvar point\t= vector\t|| this._vector;\n\t// get a random point\n\tpoint.copy(this.position);\n\t// return the point\n\treturn point;\n}\n/**\n * Shortcut to create Fireworks.Shape.Box\n*/\nFireworks.createShapeSphere\t= function(positionX, positionY, positionZ, radius, boundingbox){\n\tvar position\t= new Fireworks.Vector(positionX, positionY, positionZ);\n\treturn new Fireworks.ShapeSphere(position, radius);\n};\n\n\n/**\n * Handle a Firework.Shape forming a sphere\n *\n * @param {Fireworks.Vector} position the position of the sphere\n * @param {Number} radius the radius of the sphere\n*/\nFireworks.ShapeSphere\t= function(position, radius)\n{\n\tthis.position\t= position;\n\tthis.radius\t= radius;\n\tthis._vector\t= new Fireworks.Vector();\n}\n\n// inherit from Fireworks.Effect\nFireworks.ShapeSphere.prototype = new Fireworks.Shape();\nFireworks.ShapeSphere.prototype.constructor = Fireworks.ShapeSphere;\n\nFireworks.ShapeSphere.prototype.contains\t= function(point){\n\t// compute distance between the point and the position\n\tvar distance\t= this._vector.sub(point, this.position).length();\n\t// return true if this distance is <= than sphere radius\n\treturn distance <= this.radius;\n}\n\nFireworks.ShapeSphere.prototype.randomPoint\t= function(vector){\n\tvar point\t= vector\t|| this._vector;\n\t// get a random point\n\tpoint.x\t= Math.random()-0.5;\n\tpoint.y\t= Math.random()-0.5;\n\tpoint.z\t= Math.random()-0.5;\n\t// compute the length between the point \n\tvar length\t= Math.random()*this.radius;\n\t// set the point at the proper distance;\n\tpoint.setLength( length );\n\t// add the position\n\tpoint.addSelf(this.position);\n\t// return the point\n\treturn point;\n}\n/**\n * Spawner deliverying paricles in one shot\n * \n * @param {Number?} the number of particle to emit\n*/\nFireworks.EffectsStackBuilder.prototype.spawnerOneShot\t= function(nParticles)\n{\n\t// handle parameter polymorphism\n\tnParticles\t= nParticles\t|| this.emitter().nParticles();\n\t// define local variables\n\tvar emitter\t= this.emitter();\n\tvar nSent\t= 0;\n\tvar spawning\t= true;\n\n\t// create the effect itself\n\tFireworks.createEffect('spawner', {\n\t\treset\t: function(){ nSent\t= 0;\t},\n\t\tstart\t: function(){ spawning\t= true;\t},\n\t\tstop\t: function(){ spawning\t= false;}\n\t}).onPreUpdate(function(deltaTime){\n\t\t// if spawning is false, do nothing\n\t\tif( spawning === false )\treturn;\n\t\t// if already completed, do nothing\n\t\tif( nParticles === nSent )\treturn;\n\t\t// spawn each particle\n\t\tvar amount\t= nParticles - nSent;\n\t\tamount\t\t= Math.min(amount, emitter.deadParticles().length);\n\t\tfor(var i = 0; i < amount; i++){\n\t\t\temitter.spawnParticle();\n\t\t}\n\t\t// update the amount of sent particles\n\t\tnSent\t+= amount;\n\t}).pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * Spawner deliverying paricles at a steady rate\n * \n * @param {Number?} rate the rate at which it gonna emit\n*/\nFireworks.EffectsStackBuilder.prototype.spawnerSteadyRate\t= function(rate)\n{\n\t// handle parameter polymorphism\n\trate\t= rate !== undefined ? rate\t: 1;\n\t// define local variables\n\tvar emitter\t= this.emitter();\n\tvar nToCreate\t= 1;\n\tvar spawning\t= true;\n\t\n\t// create the effect itself\n\tFireworks.createEffect('spawner', {\n\t\trate\t: rate,\n\t\tstart\t: function(){ spawning = true;\t},\n\t\tstop\t: function(){ spawning = false;\t}\n\t}).onPreUpdate(function(deltaTime){\n\t\tvar rate\t= this.opts.rate;\n\t\t// if spawning is false, do nothing\n\t\tif( spawning === false )\treturn;\n\t\t// update nToCreate\n\t\tnToCreate\t+= rate * deltaTime;\n\t\t// nParticles is the interger part of nToCreate as you spawn them one by one\n\t\tvar nParticles\t= Math.floor(nToCreate);\n\t\t// dont spawn more particles than available\n\t\t// TODO here estimate how much more is needed to never lack of it\n\t\tnParticles\t= Math.min(nParticles, emitter.deadParticles().length);\n\t\t// update nToCreate\n\t\tnToCreate\t-= nParticles;\n\t\t// spawn each particle\n\t\tfor(var i = 0; i < nParticles; i++){\n\t\t\temitter.spawnParticle();\n\t\t}\n\t}).pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * render to canvas\n*/\nFireworks.EffectsStackBuilder.prototype.renderToCanvas\t= function(opts)\n{\n\topts\t= opts\t\t|| {};\n\tvar ctx\t= opts.ctx\t|| buildDefaultContext();\n\t// create the effect itself\n\tvar effect\t= Fireworks.createEffect('renderToCanvas', {\n\t\tctx\t: ctx\n\t}).pushTo(this._emitter);\n\n\n\tif( opts.type === 'arc' )\t\tctorTypeArc(effect);\n\telse if( opts.type === 'drawImage' )\tctorTypeDrawImage(effect);\n\telse{\n\t\tconsole.assert(false, 'renderToCanvas opts.type is invalid: ');\n\t}\n\n\treturn this;\t// for chained API\n\t\n\n\tfunction buildDefaultContext(){\n\t\t// build canvas element\n\t\tvar canvas\t= document.createElement('canvas');\n\t\tcanvas.width\t= window.innerWidth;\n\t\tcanvas.height\t= window.innerHeight;\n\t\tdocument.body.appendChild(canvas);\n\t\t// canvas.style\n\t\tcanvas.style.position\t= \"absolute\";\n\t\tcanvas.style.left\t= 0;\n\t\tcanvas.style.top\t= 0;\n\t\t// setup ctx\n\t\tvar ctx\t\t= canvas.getContext('2d');\n\t\t// return ctx\n\t\treturn ctx;\n\t}\n\n\tfunction ctorTypeArc(){\n\t\treturn effect.onCreate(function(particle, particleIdx){\n\t\t\tparticle.renderToCanvas = {\n\t\t\t\tsize\t: 3\n\t\t\t};\n\t\t}).onRender(function(particle){\n\t\t\tvar position\t= particle.position.vector;\n\t\t\tvar size\t= particle.renderToCanvas.size;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(position.x + canvas.width /2, \n\t\t\t\tposition.y + canvas.height/2, size, 0, Math.PI*2, true); \n\t\t\tctx.fill();\t\t\t\t\t\n\t\t});\n\t};\n\tfunction ctorTypeDrawImage(){\n\t\t// handle parameter polymorphism\n\t\tif( typeof(opts.image) === 'string' ){\n\t\t\tvar images\t= [new Image];\n\t\t\timages[0].src\t= opts.image;\n\t\t}else if( opts.image instanceof Image ){\n\t\t\tvar images\t= [opts.image];\n\t\t}else if( opts.image instanceof Array ){\n\t\t\tvar images\t= opts.image;\n\t\t}else\tconsole.assert(false, 'invalid .renderToCanvas() options')\n\n\t\treturn effect.onCreate(function(particle, particleIdx){\n\t\t\tparticle.renderToCanvas = {\n\t\t\t\tscale\t\t: 1,\t// should that be there ? or in its own effect ?\n\t\t\t\topacity\t\t: 1,\t// should that be there ? or in its own effect ?\n\t\t\t\trotation\t: 0*Math.PI\n\t\t\t};\n\t\t}).onRender(function(particle){\n\t\t\tvar position\t= particle.position.vector;\n\t\t\tvar data\t= particle.renderToCanvas;\n\t\t\tvar canonAge\t= particle.lifeTime.normalizedAge();\n\t\t\tvar imageIdx\t= Math.floor(canonAge * images.length);\n\t\t\tvar image\t= images[imageIdx];\n\t\t\t// save the context\n\t\t\tctx.save();\n\t\t\t// translate in canvas's center, and the particle position\n\t\t\tctx.translate(position.x + canvas.width/2, position.y + canvas.height/2);\n\t\t\t// set the scale of this particles\n\t\t\tctx.scale(data.scale, data.scale);\n\t\t\t// set the rotation\n\t\t\tctx.rotate(data.rotation);\n\t\t\t// set ctx.globalAlpha\n\t\t\tctx.globalAlpha\t= data.opacity; \n\t\t\t// draw the image itself\n\t\t\tif( image instanceof Image ){\n\t\t\t\tctx.drawImage(image, -image.width/2, -image.height/2);\t\t\t\n\t\t\t}else if( typeof(image) === 'object' ){\n\t\t\t\tctx.drawImage(image.image\n\t\t\t\t \t,  image.offsetX,  image.offsetY , image.width, image.height\n\t\t\t\t\t, -image.width/2, -image.height/2, image.width, image.height);\n\t\t\t}else\tconsole.assert(false);\n\t\t\t// restore the context\n\t\t\tctx.restore();\n\t\t});\n\t};\n};\n/**\n * render to three.js THREE.Object3D\n * If i play with object3D.visible true/false instead of Object3D.add/remove\n * i got a lot of artefacts\n*/\nFireworks.EffectsStackBuilder.prototype.renderToThreejsObject3D\t= function(opts)\n{\n\tvar effectId\t= opts.effectId\t|| 'renderToThreeParticleSystem';\n\tvar container\t= opts.container;\n\n\n\t// create the effect itself\n\tFireworks.createEffect(effectId)\n\t.onCreate(function(particle, particleIdx){\n\t\tparticle.threejsObject3D = {\n\t\t\tobject3d\t: opts.create()\n\t\t};\n\t\tFireworks.debug && console.assert(particle.threejsObject3D.object3d instanceof THREE.Object3D);\n\t\t\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n\n//\t\tobject3d.visible= false;\n\t}).onBirth(function(particle){\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n//\t\tobject3d.visible= true;\n\t\tcontainer.add(object3d);\n\t}).onDeath(function(particle){\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n//\t\tobject3d.visible= false;\n\t\tcontainer.remove(object3d);\n\t}).onRender(function(particle){\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n\t\tvar position\t= particle.position.vector;\n\t\tobject3d.position.set(position.x, position.y, position.z);\n\t}).pushTo(this._emitter);\n\treturn this;\t// for chained API\n};\n/**\n * render to three.js to THREE.ParticleSystem\n*/\nFireworks.EffectsStackBuilder.prototype.renderToThreejsParticleSystem\t= function(opts)\n{\n\topts\t\t\t= opts\t\t\t|| {};\n\tvar effectId\t\t= opts.effectId\t\t|| 'renderToThreejsParticleSystem';\n\tvar particleSystem\t= opts.particleSystem\t|| defaultParticleSystem;\n\t// if opts.particleSystem is a function, call it to create the particleSystem\n\tif( typeof(particleSystem) === 'function' )\tparticleSystem\t= particleSystem(this._emitter);\n\t// sanity check\n\tconsole.assert(particleSystem instanceof THREE.ParticleSystem, \"particleSystem MUST be THREE.ParticleSystem\");\n\t// some aliases\n\tvar geometry\t= particleSystem.geometry;\n\tconsole.assert(geometry.vertices.length >= this._emitter.nParticles())\n\t// create the effect itself\n\tFireworks.createEffect(effectId, {\n\t\tparticleSystem\t: particleSystem\n\t}).onCreate(function(particle, particleIdx){\n\t\tparticle.threejsParticle = {\n\t\t\tparticleIdx\t: particleIdx\n\t\t};\n\t\tvar vertex\t= geometry.vertices[particleIdx];\n\t\tvertex.set(Infinity, Infinity, Infinity);\n\t}).onDeath(function(particle){\n\t\tvar particleIdx\t= particle.threejsParticle.particleIdx;\n\t\tvar vertex\t= geometry.vertices[particleIdx];\n\t\tvertex.set(Infinity, Infinity, Infinity);\n\t}).onRender(function(particle){\n\t\tvar particleIdx\t= particle.threejsParticle.particleIdx;\n\t\tvar vertex\t= geometry.vertices[particleIdx];\n\t\tvar position\t= particle.position.vector;\n\t\tvertex.set(position.x, position.y, position.z);\n\t}).pushTo(this._emitter);\n\treturn this;\t// for chained API\n\n\t//////////////////////////////////////////////////////////////////////////\n\t//\t\tInternal Functions\t\t\t\t\t//\n\t//////////////////////////////////////////////////////////////////////////\n\n\tfunction defaultParticleSystem(emitter){\n\t\tvar geometry\t= new THREE.Geometry();\n\t\tfor( var i = 0; i < emitter.nParticles(); i++ ){\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\n\t\t}\n\t\tvar material\t= new THREE.ParticleBasicMaterial({\n\t\t\tsize\t\t: 5,\n\t\t\tsizeAttenuation\t: true,\n\t\t\tcolor\t\t: 0xE01B6A,\n\t\t\tmap\t\t: generateTexture(),\n\t\t\tblending\t: THREE.AdditiveBlending,\n\t\t\tdepthWrite\t: false,\n\t\t\ttransparent\t: true\n\t\t});\n\t\tvar particleSystem\t\t= new THREE.ParticleSystem(geometry, material);\n\t\tparticleSystem.dynamic\t\t= true;\n\t\tparticleSystem.sortParticles\t= true;\n\t\treturn particleSystem;\n\t}\n\n\tfunction generateTexture(size){\n\t\tsize\t\t= size || 128;\n\t\tvar canvas\t= document.createElement( 'canvas' );\n\t\tvar context\t= canvas.getContext( '2d' );\n\t\tcanvas.width\t= canvas.height\t= size;\n\n\t\tvar gradient\t= context.createRadialGradient( canvas.width/2, canvas.height /2, 0, canvas.width /2, canvas.height /2, canvas.width /2 );\t\t\n\t\tgradient.addColorStop( 0  , 'rgba(255,255,255,1)' );\n\t\tgradient.addColorStop( 0.5, 'rgba(255,255,255,1)' );\n\t\tgradient.addColorStop( 0.7, 'rgba(128,128,128,1)' );\n\t\tgradient.addColorStop( 1  , 'rgba(0,0,0,1)' );\n\n\t\tcontext.beginPath();\n\t\tcontext.arc(size/2, size/2, size/2, 0, Math.PI*2, false);\n\t\tcontext.closePath();\n\n\t\tcontext.fillStyle\t= gradient;\n\t\t//context.fillStyle\t= 'rgba(128,128,128,1)';\n\t\tcontext.fill();\n\n\t\tvar texture\t= new THREE.Texture( canvas );\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\t}\n};\n\nFireworks.Emitter.prototype.bindTriggerDomEvents\t= function(domElement){\n\tvar tmp\t= new Fireworks.BindTriggerDomEvents(this, domElement);\n\treturn this;\t// for chained API\n}\n\nFireworks.BindTriggerDomEvents\t= function(emitter, domElement){\n\tthis._domElement= domElement\t|| document.body;\n\n\t// bind mouse event\n\tthis._onMouseDown\t= function(){ emitter.effect('spawner').opts.start();\t};\n\tthis._onMouseUp\t\t= function(){ emitter.effect('spawner').opts.stop();\t};\n\tthis._domElement.addEventListener('mousedown'\t, this._onMouseDown\t);\n\tthis._domElement.addEventListener('mouseup'\t, this._onMouseUp\t);\n\n\t// change emitter intensity on mousewheel\t\t\n\tthis._onMouseWheel\t= function(event){\n\t\tvar intensity\t= emitter.intensity();\n\t\tintensity\t+= event.wheelDelta < 0 ? -0.05 : 0.05;\n\t\tintensity\t= Math.max(intensity, 0);\n\t\tintensity\t= Math.min(intensity, 1);\n\t\temitter.intensity(intensity);\n\t};\n\tthis._domElement.addEventListener('mousewheel'\t, this._onMouseWheel\t);\n}\n\n\nFireworks.BindTriggerDomEvents.prototype.destroy\t= function(){\n\tthis._domElement.removeEventListener('mousedown'\t, this._onMouseDown\t);\n\tthis._domElement.removeEventListener('mouseup'\t\t, this._onMouseUp\t);\n\tthis._domElement.removeEventListener('mousewheel'\t, this._onMouseWheel\t);\n};\nFireworks.DatGui4Emitter\t= function(emitter){\n\tvar gui\t\t= new dat.GUI();\n\tvar effects\t= emitter.effects();\n\teffects.forEach(function(effect, idx){\n\t\tvar effectName\t= effect.name\t|| \"effect-\"+idx;\n\t\tvar opts\t= effect.opts\t|| {};\n\t\tvar keys\t= Object.keys(opts).filter(function(key){\n\t\t\tif( opts[key] instanceof Fireworks.Vector )\treturn true;\n\t\t\tif( typeof(opts[key]) === 'object' )\t\treturn false;\n\t\t\treturn true;\n\t\t});\n\t\tif( keys.length ){\n\t\t\tvar folder\t= gui.addFolder('Effect: '+effectName);\n\t\t\tkeys.forEach(function(key){\n\t\t\t\tif( opts[key] instanceof Fireworks.Vector ){\n\t\t\t\t\tfolder.add(opts[key], 'x').name(key+\"X\");\n\t\t\t\t\tfolder.add(opts[key], 'y').name(key+\"Y\");\n\t\t\t\t\tfolder.add(opts[key], 'z').name(key+\"Z\");\n\t\t\t\t}else{\n\t\t\t\t\tfolder.add(opts, key);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\t// return the built gui\n\treturn gui;\n};Fireworks.ProceduralTextures\t= {};\n\nFireworks.ProceduralTextures.buildTexture\t= function(size)\n{\n\tsize\t\t= size || 150;\n\tvar canvas\t= document.createElement( 'canvas' );\n\tvar context\t= canvas.getContext( '2d' );\n\tcanvas.width\t= canvas.height\t= size;\n\n\tvar gradient\t= context.createRadialGradient( canvas.width/2, canvas.height /2, 0, canvas.width /2, canvas.height /2, canvas.width /2 );\t\t\n\tgradient.addColorStop( 0  , 'rgba(255,255,255,1)' );\n\tgradient.addColorStop( 0.5, 'rgba(255,255,255,1)' );\n\tgradient.addColorStop( 0.7, 'rgba(128,128,128,1)' );\n\tgradient.addColorStop( 1  , 'rgba(0,0,0,1)' );\n\n\tcontext.beginPath();\n\tcontext.arc(size/2, size/2, size/2, 0, Math.PI*2, false);\n\tcontext.closePath();\n\n\tcontext.fillStyle\t= gradient;\n\t//context.fillStyle\t= 'rgba(128,128,128,1)';\n\tcontext.fill();\n\n\tvar texture\t= new THREE.Texture( canvas );\n\ttexture.needsUpdate = true;\n\n\treturn texture;\n}\n\n",
    "/**\n * @author alteredq / http://alteredqualia.com/\n * @author mr.doob / http://mrdoob.com/\n */\n\nvar Detector = {\n\n\tcanvas: !! window.CanvasRenderingContext2D,\n\twebgl: ( function () { try { return !! window.WebGLRenderingContext && !! document.createElement( 'canvas' ).getContext( 'experimental-webgl' ); } catch( e ) { return false; } } )(),\n\tworkers: !! window.Worker,\n\tfileapi: window.File && window.FileReader && window.FileList && window.Blob,\n\n\tgetWebGLErrorMessage: function () {\n\n\t\tvar element = document.createElement( 'div' );\n\t\telement.id = 'webgl-error-message';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( ! this.webgl ) {\n\n\t\t\telement.innerHTML = window.WebGLRenderingContext ? [\n\t\t\t\t'Your graphics card does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">WebGL</a>.<br />',\n\t\t\t\t'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000\">here</a>.'\n\t\t\t].join( '\\n' ) : [\n\t\t\t\t'Your browser does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">WebGL</a>.<br/>',\n\t\t\t\t'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000\">here</a>.'\n\t\t\t].join( '\\n' );\n\n\t\t}\n\n\t\treturn element;\n\n\t},\n\n\taddGetWebGLMessage: function ( parameters ) {\n\n\t\tvar parent, id, element;\n\n\t\tparameters = parameters || {};\n\n\t\tparent = parameters.parent !== undefined ? parameters.parent : document.body;\n\t\tid = parameters.id !== undefined ? parameters.id : 'oldie';\n\n\t\telement = Detector.getWebGLErrorMessage();\n\t\telement.id = id;\n\n\t\tparent.appendChild( element );\n\n\t}\n\n};\n",
    "// This THREEx helper makes it easy to handle window resize.\n// It will update renderer and camera when window is resized.\n//\n// # Usage\n//\n// **Step 1**: Start updating renderer and camera\n//\n// ```var windowResize = new THREEx.WindowResize(aRenderer, aCamera)```\n//    \n// **Step 2**: stop updating renderer and camera\n//\n// ```windowResize.destroy()```\n// # Code\n\n//\n\n/** @namespace */\nvar THREEx\t= THREEx || {}\n\n/**\n * Update renderer and camera when the window is resized\n * \n * @param {Object} renderer the renderer to update\n * @param {Object} Camera the camera to update\n*/\nTHREEx.WindowResize\t= function(renderer, camera){\n\tvar callback\t= function(){\n\t\t// notify the renderer of the size change\n\t\trenderer.setSize( window.innerWidth, window.innerHeight )\n\t\t// update the camera\n\t\tcamera.aspect\t= window.innerWidth / window.innerHeight\n\t\tcamera.updateProjectionMatrix()\n\t}\n\t// bind the resize event\n\twindow.addEventListener('resize', callback, false)\n\t// return .stop() the function to stop watching window resize\n\treturn {\n\t\ttrigger\t: function(){\n\t\t\tcallback()\n\t\t},\n\t\t/**\n\t\t * Stop watching window resize\n\t\t*/\n\t\tdestroy\t: function(){\n\t\t\twindow.removeEventListener('resize', callback)\n\t\t}\n\t}\n}\n",
    "// stats.js - http://github.com/mrdoob/stats.js\nvar Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement(\"div\");f.id=\"stats\";f.addEventListener(\"mousedown\",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText=\"width:80px;opacity:0.9;cursor:pointer\";var a=document.createElement(\"div\");a.id=\"fps\";a.style.cssText=\"padding:0 0 3px 3px;text-align:left;background-color:#002\";f.appendChild(a);var i=document.createElement(\"div\");i.id=\"fpsText\";i.style.cssText=\"color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px\";\ni.innerHTML=\"FPS\";a.appendChild(i);var c=document.createElement(\"div\");c.id=\"fpsGraph\";c.style.cssText=\"position:relative;width:74px;height:30px;background-color:#0ff\";for(a.appendChild(c);74>c.children.length;){var j=document.createElement(\"span\");j.style.cssText=\"width:1px;height:30px;float:left;background-color:#113\";c.appendChild(j)}var d=document.createElement(\"div\");d.id=\"ms\";d.style.cssText=\"padding:0 0 3px 3px;text-align:left;background-color:#020;display:none\";f.appendChild(d);var k=document.createElement(\"div\");\nk.id=\"msText\";k.style.cssText=\"color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px\";k.innerHTML=\"MS\";d.appendChild(k);var e=document.createElement(\"div\");e.id=\"msGraph\";e.style.cssText=\"position:relative;width:74px;height:30px;background-color:#0f0\";for(d.appendChild(e);74>e.children.length;)j=document.createElement(\"span\"),j.style.cssText=\"width:1px;height:30px;float:left;background-color:#131\",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display=\n\"block\";d.style.display=\"none\";break;case 1:a.style.display=\"none\",d.style.display=\"block\"}};return{REVISION:11,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+\" MS (\"+n+\"-\"+o+\")\";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+\"px\";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+\" FPS (\"+p+\"-\"+q+\")\",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=\na+\"px\",m=b,r=0);return b},update:function(){l=this.end()}}};\n",
    "\n/**\n * Tutorials:\n * http://www.html5rocks.com/en/tutorials/webaudio/games/\n * http://www.html5rocks.com/en/tutorials/webaudio/positional_audio/ <- +1 as it is three.js\n * http://www.html5rocks.com/en/tutorials/webaudio/intro/\n *\n * Spec:\n * https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html\n *\n * Chromium Demo:\n * http://chromium.googlecode.com/svn/trunk/samples/audio/index.html  <- running page\n * http://code.google.com/p/chromium/source/browse/trunk/samples/audio/ <- source\n*/\n\n\n/**\n * Notes on removing tQuery dependancy\n * * some stuff depends on tQuery\n * * find which one\n * * tQuery.Webaudio got a world link for the listener\n *   * do a plugin with followListener(world), unfollowListener(world)\n * * namespace become WebAudio.* instead of WebAudio.*\n*/\n\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tWebAudio\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n\n\nwindow.AudioContext\t= window.AudioContext || window.webkitAudioContext;\n\n/**\n * Main class to handle webkit audio\n * \n * TODO make the clip detector from http://www.html5rocks.com/en/tutorials/webaudio/games/\n *\n * @class Handle webkit audio API\n *\n * @param {tQuery.World} [world] the world on which to run \n*/\nWebAudio\t= function(){\n\t// sanity check - the api MUST be available\n\tif( WebAudio.isAvailable === false ){\n\t\tthis._addRequiredMessage();\n\t\t// Throw an error to stop execution\n\t\tthrow new Error('WebAudio API is required and not available.')\t\n\t}\n\t\n\t// create the context\n\tthis._ctx\t= new AudioContext();\n\t// setup internal variable\n\tthis._muted\t= false;\n\tthis._volume\t= 1;\n\n\t// setup the end of the node chain\n\t// TODO later code the clipping detection from http://www.html5rocks.com/en/tutorials/webaudio/games/ \n\tthis._gainNode\t= this._ctx.createGain();\n\tthis._compressor= this._ctx.createDynamicsCompressor();\n\tthis._gainNode.connect( this._compressor );\n\tthis._compressor.connect( this._ctx.destination );\t\n\n\t// init page visibility\n\tthis._pageVisibilityCtor();\t\n};\n\n\n/**\n * vendor.js way to make plugins ala jQuery\n * @namespace\n*/\nWebAudio.fn\t= WebAudio.prototype;\n\n\n/**\n * destructor\n*/\nWebAudio.prototype.destroy\t= function(){\n\tthis._pageVisibilityDtor();\n};\n\n/**\n * @return {Boolean} true if it is available or not\n*/\nWebAudio.isAvailable\t= window.AudioContext ? true : false;\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tcomment\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nWebAudio.prototype._addRequiredMessage = function(parent) {\n\t// handle defaults arguements\n\tparent\t= parent || document.body;\n\t// message directly taken from Detector.js\n\tvar domElement = document.createElement( 'div' );\n\tdomElement.style.fontFamily\t= 'monospace';\n\tdomElement.style.fontSize\t= '13px';\n\tdomElement.style.textAlign\t= 'center';\n\tdomElement.style.background\t= '#eee';\n\tdomElement.style.color\t\t= '#000';\n\tdomElement.style.padding\t= '1em';\n\tdomElement.style.width\t\t= '475px';\n\tdomElement.style.margin\t\t= '5em auto 0';\n\tdomElement.innerHTML\t\t= [\n\t\t'Your browser does not seem to support <a href=\"https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html\">WebAudio API</a>.<br />',\n\t\t'Try with <a href=\"https://www.google.com/intl/en/chrome/browser/\">Chrome Browser</a>.'\n\t].join( '\\n' );\n\t// add it to the parent\n\tparent.appendChild(domElement);\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * get the audio context\n *\n * @returns {AudioContext} the audio context\n*/\nWebAudio.prototype.context\t= function(){\n\treturn this._ctx;\n};\n\n/**\n * Create a sound\n *\n * @returns {WebAudio.Sound} the sound just created\n*/\nWebAudio.prototype.createSound\t= function()\n{\n\tvar webaudio\t= this;\n\tvar sound\t= new WebAudio.Sound(webaudio);\n\treturn sound;\n}\n\n\n/**\n * return the entry node in the master node chains\n*/\nWebAudio.prototype._entryNode\t= function(){\n\t//return this._ctx.destination;\n\treturn this._gainNode;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tvolume/mute\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * getter/setter on the volume\n*/\nWebAudio.prototype.volume\t= function(value){\n\tif( value === undefined )\treturn this._volume;\n\t// update volume\n\tthis._volume\t= value;\n\t// update actual volume IIF not muted\n\tif( this._muted  === false ){\n\t\tthis._gainNode.gain.value\t= this._volume;\t\n\t}\n\t// return this for chained API\n\treturn this;\n};\n\n/** \n * getter/setter for mute\n*/\nWebAudio.prototype.mute\t= function(value){\n\tif( value === undefined )\treturn this._muted;\n\tthis._muted\t= value;\n\tthis._gainNode.gain.value\t= this._muted ? 0 : this._volume;\n\treturn this;\t// for chained API\n}\n\n/**\n * to toggle the mute\n*/\nWebAudio.prototype.toggleMute\t= function(){\n\tif( this.mute() )\tthis.mute(false);\n\telse\t\t\tthis.mute(true);\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tpageVisibility\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n\nWebAudio.prototype._pageVisibilityCtor\t= function(){\n\t// shim to handle browser vendor\n\tthis._pageVisibilityEventStr\t= (document.hidden !== undefined\t? 'visibilitychange'\t:\n\t\t(document.mozHidden\t!== undefined\t\t? 'mozvisibilitychange'\t:\n\t\t(document.msHidden\t!== undefined\t\t? 'msvisibilitychange'\t:\n\t\t(document.webkitHidden\t!== undefined\t\t? 'webkitvisibilitychange' :\n\t\tconsole.assert(false, \"Page Visibility API unsupported\")\n\t))));\n\tthis._pageVisibilityDocumentStr\t= (document.hidden !== undefined ? 'hidden' :\n\t\t(document.mozHidden\t!== undefined ? 'mozHidden' :\n\t\t(document.msHidden\t!== undefined ? 'msHidden' :\n\t\t(document.webkitHidden\t!== undefined ? 'webkitHidden' :\n\t\tconsole.assert(false, \"Page Visibility API unsupported\")\n\t))));\n\t// event handler for visibilitychange event\n\tthis._$pageVisibilityCallback\t= function(){\n\t\tvar isHidden\t= document[this._pageVisibilityDocumentStr] ? true : false;\n\t\tthis.mute( isHidden ? true : false );\n\t}.bind(this);\n\t// bind the event itself\n\tdocument.addEventListener(this._pageVisibilityEventStr, this._$pageVisibilityCallback, false);\n}\n\nWebAudio.prototype._pageVisibilityDtor\t= function(){\n\t// unbind the event itself\n\tdocument.removeEventListener(this._pageVisibilityEventStr, this._$pageVisibilityCallback, false);\n}\n/**\n * Constructor\n *\n * @class builder to generate nodes chains. Used in WebAudio.Sound\n * @param {AudioContext} audioContext the audio context\n*/\nWebAudio.NodeChainBuilder\t= function(audioContext){\n\tconsole.assert(audioContext instanceof AudioContext);\n\tthis._context\t= audioContext;\n\tthis._firstNode\t= null;\n\tthis._lastNode\t= null;\n\tthis._nodes\t= {};\n};\n\n/**\n * creator\n * \n * @param  {webkitAudioContext} \taudioContext the context\t\n * @return {WebAudio.NodeChainBuider}\tjust created object\n */\nWebAudio.NodeChainBuilder.create= function(audioContext){\n\treturn new WebAudio.NodeChainBuilder(audioContext);\n}\n\n/**\n * destructor\n*/\nWebAudio.NodeChainBuilder.prototype.destroy\t= function(){\n};\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tgetters\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * getter for the nodes\n*/\nWebAudio.NodeChainBuilder.prototype.nodes\t= function(){\n\treturn this._nodes;\n}\n\n/**\n * @returns the first node of the chain\n*/\nWebAudio.NodeChainBuilder.prototype.first\t= function(){\n\treturn this._firstNode;\n}\n\n/**\n * @returns the last node of the chain\n*/\nWebAudio.NodeChainBuilder.prototype.last\t= function(){\n\treturn this._lastNode;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * add a node to the chain\n * @param {[type]} node       [description]\n * @param {[type]} properties [description]\n */\nWebAudio.NodeChainBuilder.prototype._addNode\t= function(node, properties)\n{\n\t// update this._bufferSourceDst - needed for .cloneBufferSource()\n\tvar lastIsBufferSource\t= this._lastNode && ('playbackRate' in this._lastNode) ? true : false;\n\tif( lastIsBufferSource )\tthis._bufferSourceDst\t= node;\n\n\t// connect this._lastNode to node if suitable\n\tif( this._lastNode !== null )\tthis._lastNode.connect(node);\n\t\n\t// update this._firstNode && this._lastNode\n\tif( this._firstNode === null )\tthis._firstNode\t= node;\n\tthis._lastNode\t= node;\n\t\t\n\t// apply properties to the node\n\tfor( var property in properties ){\n\t\tnode[property]\t= properties[property];\n\t}\n\n\t// for chained API\n\treturn this;\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tcreator for each type of nodes\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Clone the bufferSource. Used just before playing a sound\n * @returns {AudioBufferSourceNode} the clone AudioBufferSourceNode\n*/\nWebAudio.NodeChainBuilder.prototype.cloneBufferSource\t= function(){\n\tconsole.assert(this._nodes.bufferSource, \"no buffersource presents. Add one.\");\n\tvar orig\t= this._nodes.bufferSource;\n\tvar clone\t= this._context.createBufferSource()\n\tclone.buffer\t\t= orig.buffer;\n\tclone.playbackRate\t= orig.playbackRate;\n\tclone.loop\t\t= orig.loop;\n\tclone.connect(this._bufferSourceDst);\n\treturn clone;\n}\n\n/**\n * add a bufferSource\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.bufferSource\t= function(properties){\n\tvar node\t\t= this._context.createBufferSource()\n\tthis._nodes.bufferSource= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a createMediaStreamSource\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.mediaStreamSource\t= function(stream, properties){\n//\tconsole.assert( stream instanceof LocalMediaStream )\n\tvar node\t\t= this._context.createMediaStreamSource(stream)\n\tthis._nodes.bufferSource= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a createMediaElementSource\n * @param  {HTMLElement} element    the element to add\n * @param {Object} [properties] properties to set in the created node\n */\nWebAudio.NodeChainBuilder.prototype.mediaElementSource = function(element, properties){\n\tconsole.assert(element instanceof HTMLAudioElement || element instanceof HTMLVideoElement)\n\tvar node\t\t= this._context.createMediaElementSource(element)\n\tthis._nodes.bufferSource= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a panner\n * \n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.panner\t= function(properties){\n\tvar node\t\t= this._context.createPanner()\n\tthis._nodes.panner\t= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a analyser\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.analyser\t= function(properties){\n\tvar node\t\t= this._context.createAnalyser()\n\tthis._nodes.analyser\t= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a gainNode\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.gainNode\t= function(properties){\n\tvar node\t\t= this._context.createGain()\n\tthis._nodes.gainNode\t= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * sound instance\n *\n * @class Handle one sound for WebAudio\n *\n * @param {tQuery.World} [world] the world on which to run\n * @param {WebAudio.NodeChainBuilder} [nodeChain] the nodeChain to use\n*/\nWebAudio.Sound\t= function(webaudio, nodeChain){\n\tthis._webaudio\t= webaudio;\n\tthis._context\t= this._webaudio.context();\n\n\tconsole.assert( this._webaudio instanceof WebAudio );\n\n\t// create a default NodeChainBuilder if needed\n\tif( nodeChain === undefined ){\n\t\tnodeChain\t= new WebAudio.NodeChainBuilder(this._context)\n\t\t\t\t\t.bufferSource().gainNode().analyser().panner();\n\t}\n\t// setup this._chain\n\tconsole.assert( nodeChain instanceof WebAudio.NodeChainBuilder );\n\tthis._chain\t= nodeChain;\n\t// connect this._chain.last() node to this._webaudio._entryNode()\n\tthis._chain.last().connect( this._webaudio._entryNode() );\n\t\n\t// create some alias\n\tthis._source\t= this._chain.nodes().bufferSource;\n\tthis._gainNode\t= this._chain.nodes().gainNode;\n\tthis._analyser\t= this._chain.nodes().analyser;\n\tthis._panner\t= this._chain.nodes().panner;\n\t\n\t// sanity check\n\tconsole.assert(this._source\t, \"no bufferSource: not yet supported\")\n\tconsole.assert(this._gainNode\t, \"no gainNode: not yet supported\")\n\tconsole.assert(this._analyser\t, \"no analyser: not yet supported\")\n\tconsole.assert(this._panner\t, \"no panner: not yet supported\")\n};\n\nWebAudio.Sound.create\t= function(webaudio, nodeChain){\n\treturn new WebAudio.Sound(webaudio,  nodeChain);\n}\n\n/**\n * destructor\n*/\nWebAudio.Sound.prototype.destroy\t= function(){\n\t// disconnect from this._webaudio\n\tthis._chain.last().disconnect();\n\t// destroy this._chain\n\tthis._chain.destroy();\n\tthis._chain\t= null;\n};\n\n/**\n * vendor.js way to make plugins ala jQuery\n * @namespace\n*/\nWebAudio.Sound.fn\t= WebAudio.Sound.prototype;\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * getter of the chain nodes\n*/\nWebAudio.Sound.prototype.nodes\t= function(){\n\treturn this._chain.nodes();\n};\n\n/**\n * @returns {Boolean} true if the sound is playable, false otherwise\n*/\nWebAudio.Sound.prototype.isPlayable\t= function(){\n\treturn this._source.buffer ? true : false;\n};\n\n/**\n * play the sound\n *\n * @param {Number} [time] time when to play the sound\n*/\nWebAudio.Sound.prototype.play\t\t= function(time){\n\t// handle parameter polymorphism\n\tif( time ===  undefined )\ttime\t= 0;\n\t// if not yet playable, ignore\n\t// - usefull when the sound download isnt yet completed\n\tif( this.isPlayable() === false )\treturn;\n\t// clone the bufferSource\n\tvar clonedNode\t= this._chain.cloneBufferSource();\n\t// set the noteOn\n\tclonedNode.start(time);\n\t// create the source object\n\tvar source\t= {\n\t\tnode\t: clonedNode,\n\t\tstop\t: function(time){\n\t\t\tif( time ===  undefined )\ttime\t= 0;\n\t\t\tthis.node.stop(time);\n\t\t\treturn source;\t// for chained API\n\t\t}\n\t}\n\t// return it\n\treturn source;\n};\n\n/**\n * getter/setter on the volume\n *\n * @param {Number} [value] the value to set, if not provided, get current value\n*/\nWebAudio.Sound.prototype.volume\t= function(value){\n\tif( value === undefined )\treturn this._gainNode.gain.value;\n\tthis._gainNode.gain.value\t= value;\n\treturn this;\t// for chained API\n};\n\n\n/**\n * getter/setter on the loop\n * \n * @param {Number} [value] the value to set, if not provided, get current value\n*/\nWebAudio.Sound.prototype.loop\t= function(value){\n\tif( value === undefined )\treturn this._source.loop;\n\tthis._source.loop\t= value;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the source buffer\n * \n * @param {Number} [value] the value to set, if not provided, get current value\n*/\nWebAudio.Sound.prototype.buffer\t= function(value){\n\tif( value === undefined )\treturn this._source.buffer;\n\tthis._source.buffer\t= value;\n\treturn this;\t// for chained API\n};\n\n\n/**\n * Set parameter for the pannerCone\n *\n * @param {Number} innerAngle the inner cone hangle in radian\n * @param {Number} outerAngle the outer cone hangle in radian\n * @param {Number} outerGain the gain to apply when in the outerCone\n*/\nWebAudio.Sound.prototype.pannerCone\t= function(innerAngle, outerAngle, outerGain)\n{\n\tthis._panner.coneInnerAngle\t= innerAngle * 180 / Math.PI;\n\tthis._panner.coneOuterAngle\t= outerAngle * 180 / Math.PI;\n\tthis._panner.coneOuterGain\t= outerGain;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the pannerConeInnerAngle\n * \n * @param {Number} value the angle in radian\n*/\nWebAudio.Sound.prototype.pannerConeInnerAngle\t= function(value){\n\tif( value === undefined )\treturn this._panner.coneInnerAngle / 180 * Math.PI;\n\tthis._panner.coneInnerAngle\t= value * 180 / Math.PI;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the pannerConeOuterAngle\n *\n * @param {Number} value the angle in radian\n*/\nWebAudio.Sound.prototype.pannerConeOuterAngle\t= function(value){\n\tif( value === undefined )\treturn this._panner.coneOuterAngle / 180 * Math.PI;\n\tthis._panner.coneOuterAngle\t= value * 180 / Math.PI;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the pannerConeOuterGain\n * \n * @param {Number} value the value\n*/\nWebAudio.Sound.prototype.pannerConeOuterGain\t= function(value){\n\tif( value === undefined )\treturn this._panner.coneOuterGain;\n\tthis._panner.coneOuterGain\t= value;\n\treturn this;\t// for chained API\n};\n\n/**\n * compute the amplitude of the sound (not sure at all it is the proper term)\n *\n * @param {Number} width the number of frequencyBin to take into account\n * @returns {Number} return the amplitude of the sound\n*/\nWebAudio.Sound.prototype.amplitude\t= function(width)\n{\n\t// handle paramerter\n\twidth\t\t= width !== undefined ? width : 2;\n\t// inint variable\n\tvar analyser\t= this._analyser;\n\tvar freqByte\t= new Uint8Array(analyser.frequencyBinCount);\n\t// get the frequency data\n\tanalyser.getByteFrequencyData(freqByte);\n\t// compute the sum\n\tvar sum\t= 0;\n\tfor(var i = 0; i < width; i++){\n\t\tsum\t+= freqByte[i];\n\t}\n\t// complute the amplitude\n\tvar amplitude\t= sum / (width*256-1);\n\t// return ampliture\n\treturn amplitude;\n}\n\n/**\n * Generate a sinusoid buffer.\n * FIXME should likely be in a plugin\n*/\nWebAudio.Sound.prototype.tone\t= function(hertz, seconds){\n\t// handle parameter\n\thertz\t= hertz !== undefined ? hertz : 200;\n\tseconds\t= seconds !== undefined ? seconds : 1;\n\t// set default value\t\n\tvar nChannels\t= 1;\n\tvar sampleRate\t= 44100;\n\tvar amplitude\t= 2;\n\t// create the buffer\n\tvar buffer\t= this._webaudio.context().createBuffer(nChannels, seconds*sampleRate, sampleRate);\n\tvar fArray\t= buffer.getChannelData(0);\n\t// fill the buffer\n\tfor(var i = 0; i < fArray.length; i++){\n\t\tvar time\t= i / buffer.sampleRate;\n\t\tvar angle\t= hertz * time * Math.PI;\n\t\tfArray[i]\t= Math.sin(angle)*amplitude;\n\t}\n\t// set the buffer\n\tthis.buffer(buffer);\n\treturn this;\t// for chained API\n}\n\n\n/**\n * Put this function is .Sound with getByt as private callback\n*/\nWebAudio.Sound.prototype.makeHistogram\t= function(nBar)\n{\t\n\t// get analyser node\n\tvar analyser\t= this._analyser;\n\t// allocate the private histo if needed - to avoid allocating at every frame\n\t//this._privHisto\t= this._privHisto || new Float32Array(analyser.frequencyBinCount);\n\tthis._privHisto\t= this._privHisto || new Uint8Array(analyser.frequencyBinCount);\n\t// just an alias\n\tvar freqData\t= this._privHisto;\n\n\t// get the data\n\t//analyser.getFloatFrequencyData(freqData);\n\tanalyser.getByteFrequencyData(freqData);\n\t//analyser.getByteTimeDomainData(freqData);\n\n\t/**\n\t * This should be in imageprocessing.js almost\n\t*/\n\tvar makeHisto\t= function(srcArr, dstLength){\n\t\tvar barW\t= Math.floor(srcArr.length / dstLength);\n\t\tvar nBar\t= Math.floor(srcArr.length / barW);\n\t\tvar arr\t\t= []\n\t\tfor(var x = 0, arrIdx = 0; x < srcArr.length; arrIdx++){\n\t\t\tvar sum\t= 0;\n\t\t\tfor(var i = 0; i < barW; i++, x++){\n\t\t\t\tsum += srcArr[x];\n\t\t\t}\n\t\t\tvar average\t= sum/barW;\n\t\t\tarr[arrIdx]\t= average;\n\t\t}\n\t\treturn arr;\n\t}\n\t// build the histo\n\tvar histo\t= makeHisto(freqData, nBar);\n\t// return it\n\treturn histo;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Load a sound\n *\n * @param {String} url the url of the sound to load\n * @param {Function} onSuccess function to notify once the url is loaded (optional)\n * @param {Function} onError function to notify if an error occurs (optional)\n*/\nWebAudio.Sound.prototype.load = function(url, onSuccess, onError){\n\t// handle default arguments\n\tonError\t= onError\t|| function(){\n\t\tconsole.warn(\"unable to load sound \"+url);\n\t}\n\t// try to load the user\t\n\tthis._loadAndDecodeSound(url, function(buffer){\n\t\tthis._source.buffer\t= buffer;\n\t\tonSuccess && onSuccess(this);\n\t}.bind(this), function(){\n\t\tonError && onError(this);\n\t}.bind(this));\n\treturn this;\t// for chained API\n};\n\n/**\n * Load and decode a sound\n *\n * @param {String} url the url where to get the sound\n * @param {Function} onLoad the function called when the sound is loaded and decoded (optional)\n * @param {Function} onError the function called when an error occured (optional)\n*/\nWebAudio.Sound.prototype._loadAndDecodeSound\t= function(url, onLoad, onError){\n\tvar context\t= this._context;\n\tvar request\t= new XMLHttpRequest();\n\trequest.open('GET', url, true);\n\trequest.responseType\t= 'arraybuffer';\n\t// Decode asynchronously\n\trequest.onload\t= function() {\n\t\tcontext.decodeAudioData(request.response, function(buffer) {\n\t\t\tonLoad && onLoad(buffer);\n\t\t}, function(){\n\t\t\tonError && onError();\n\t\t});\n\t};\n\t// actually start the request\n\trequest.send();\n}\n/**\n * gowiththeflow.js - a javascript flow control micro library\n * https://github.com/jeromeetienne/gowiththeflow.js\n*/\nWebAudio.Flow\t= function(){\n\tvar self, stack = [], timerId = setTimeout(function(){ timerId = null; self._next(); }, 0);\n\treturn self = {\n\t\tdestroy : function(){ timerId && clearTimeout(timerId); },\n\t\tpar\t: function(callback, isSeq){\n\t\t\tif(isSeq || !(stack[stack.length-1] instanceof Array)) stack.push([]);\n\t\t\tstack[stack.length-1].push(callback);\n\t\t\treturn self;\n\t\t},seq\t: function(callback){ return self.par(callback, true);\t},\n\t\t_next\t: function(err, result){\n\t\t\tvar errors = [], results = [], callbacks = stack.shift() || [], nbReturn = callbacks.length, isSeq = nbReturn == 1;\n\t\t\tfor(var i = 0; i < callbacks.length; i++){\n\t\t\t\t(function(fct, index){\n\t\t\t\t\tfct(function(error, result){\n\t\t\t\t\t\terrors[index]\t= error;\n\t\t\t\t\t\tresults[index]\t= result;\t\t\n\t\t\t\t\t\tif(--nbReturn == 0)\tself._next(isSeq?errors[0]:errors, isSeq?results[0]:results)\n\t\t\t\t\t}, err, result)\n\t\t\t\t})(callbacks[i], i);\n\t\t\t}\n\t\t}\n\t}\n};\n",
    "// This THREEx helper makes it easy to handle the fullscreen API\n// * it hides the prefix for each browser\n// * it hides the little discrepencies of the various vendor API\n// * at the time of this writing (nov 2011) it is available in \n//   [firefox nightly](http://blog.pearce.org.nz/2011/11/firefoxs-html-full-screen-api-enabled.html),\n//   [webkit nightly](http://peter.sh/2011/01/javascript-full-screen-api-navigation-timing-and-repeating-css-gradients/) and\n//   [chrome stable](http://updates.html5rocks.com/2011/10/Let-Your-Content-Do-the-Talking-Fullscreen-API).\n\n// \n// # Code\n\n//\n\n/** @namespace */\nvar THREEx\t\t= THREEx \t\t|| {};\nTHREEx.FullScreen\t= THREEx.FullScreen\t|| {};\n\n/**\n * test if it is possible to have fullscreen\n * \n * @returns {Boolean} true if fullscreen API is available, false otherwise\n*/\nTHREEx.FullScreen.available\t= function()\n{\n\treturn this._hasWebkitFullScreen || this._hasMozFullScreen;\n}\n\n/**\n * test if fullscreen is currently activated\n * \n * @returns {Boolean} true if fullscreen is currently activated, false otherwise\n*/\nTHREEx.FullScreen.activated\t= function()\n{\n\tif( this._hasWebkitFullScreen ){\n\t\treturn document.webkitIsFullScreen;\n\t}else if( this._hasMozFullScreen ){\n\t\treturn document.mozFullScreen;\n\t}else{\n\t\tconsole.assert(false);\n\t}\n}\n\n/**\n * Request fullscreen on a given element\n * @param {DomElement} element to make fullscreen. optional. default to document.body\n*/\nTHREEx.FullScreen.request\t= function(element)\n{\n\telement\t= element\t|| document.body;\n\tif( this._hasWebkitFullScreen ){\n\t\telement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n\t}else if( this._hasMozFullScreen ){\n\t\telement.mozRequestFullScreen();\n\t}else{\n\t\tconsole.assert(false);\n\t}\n}\n\n/**\n * Cancel fullscreen\n*/\nTHREEx.FullScreen.cancel\t= function()\n{\n\tif( this._hasWebkitFullScreen ){\n\t\tdocument.webkitCancelFullScreen();\n\t}else if( this._hasMozFullScreen ){\n\t\tdocument.mozCancelFullScreen();\n\t}else{\n\t\tconsole.assert(false);\n\t}\n}\n\n\n// internal functions to know which fullscreen API implementation is available\nTHREEx.FullScreen._hasWebkitFullScreen\t= 'webkitCancelFullScreen' in document\t? true : false;\t\nTHREEx.FullScreen._hasMozFullScreen\t= 'mozCancelFullScreen' in document\t? true : false;\t\n\n/**\n * Bind a key to renderer screenshot\n*/\nTHREEx.FullScreen.bindKey\t= function(opts){\n\topts\t\t= opts\t\t|| {};\n\tvar charCode\t= opts.charCode\t|| 'f'.charCodeAt(0);\n\tvar dblclick\t= opts.dblclick !== undefined ? opts.dblclick : false;\n\tvar element\t= opts.element\n\n\tvar toggle\t= function(){\n\t\tif( THREEx.FullScreen.activated() ){\n\t\t\tTHREEx.FullScreen.cancel();\n\t\t}else{\n\t\t\tTHREEx.FullScreen.request(element);\n\t\t}\t\t\n\t}\n\n\t// callback to handle keypress\n\tvar __bind\t= function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\tvar onKeyPress\t= __bind(function(event){\n\t\t// return now if the KeyPress isnt for the proper charCode\n\t\tif( event.which !== charCode )\treturn;\n\t\t// toggle fullscreen\n\t\ttoggle();\n\t}, this);\n\n\t// listen to keypress\n\t// NOTE: for firefox it seems mandatory to listen to document directly\n\tdocument.addEventListener('keypress', onKeyPress, false);\n\t// listen to dblclick\n\tdblclick && document.addEventListener('dblclick', toggle, false);\n\n\treturn {\n\t\tunbind\t: function(){\n\t\t\tdocument.removeEventListener('keypress', onKeyPress, false);\n\t\t\tdblclick && document.removeEventListener('dblclick', toggle, false);\n\t\t}\n\t};\n}\n",
    "/**\n * @author mrdoob / http://mrdoob.com/\n * @author marklundin / http://mark-lundin.com/\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.AnaglyphEffect = function ( renderer, width, height ) {\n\n\tvar eyeRight = new THREE.Matrix4();\n\tvar eyeLeft = new THREE.Matrix4();\n\tvar focalLength = 125;\n\tvar _aspect, _near, _far, _fov;\n\n\tvar _cameraL = new THREE.PerspectiveCamera();\n\t_cameraL.matrixAutoUpdate = false;\n\n\tvar _cameraR = new THREE.PerspectiveCamera();\n\t_cameraR.matrixAutoUpdate = false;\n\n\tvar _camera = new THREE.OrthographicCamera( -1, 1, 1, - 1, 0, 1 );\n\n\tvar _scene = new THREE.Scene();\n\n\tvar _params = { minFilter: THREE.LinearFilter, magFilter: THREE.NearestFilter, format: THREE.RGBAFormat };\n\n\tif ( width === undefined ) width = 512;\n\tif ( height === undefined ) height = 512;\n\n\tvar _renderTargetL = new THREE.WebGLRenderTarget( width, height, _params );\n\tvar _renderTargetR = new THREE.WebGLRenderTarget( width, height, _params );\n\n\tvar _material = new THREE.ShaderMaterial( {\n\n\t\tuniforms: {\n\n\t\t\t\"mapLeft\": { type: \"t\", value: _renderTargetL },\n\t\t\t\"mapRight\": { type: \"t\", value: _renderTargetR }\n\n\t\t},\n\n\t\tvertexShader: [\n\n\t\t\t\"varying vec2 vUv;\",\n\n\t\t\t\"void main() {\",\n\n\t\t\t\"\tvUv = vec2( uv.x, uv.y );\",\n\t\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n\t\t\t\"}\"\n\n\t\t].join(\"\\n\"),\n\n\t\tfragmentShader: [\n\n\t\t\t\"uniform sampler2D mapLeft;\",\n\t\t\t\"uniform sampler2D mapRight;\",\n\t\t\t\"varying vec2 vUv;\",\n\n\t\t\t\"void main() {\",\n\n\t\t\t\"\tvec4 colorL, colorR;\",\n\t\t\t\"\tvec2 uv = vUv;\",\n\n\t\t\t\"\tcolorL = texture2D( mapLeft, uv );\",\n\t\t\t\"\tcolorR = texture2D( mapRight, uv );\",\n\n\t\t\t\t// http://3dtv.at/Knowhow/AnaglyphComparison_en.aspx\n\n\t\t\t\"\tgl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\",\n\n\t\t\t\"}\"\n\n\t\t].join(\"\\n\")\n\n\t} );\n\n\tvar mesh = new THREE.Mesh( new THREE.PlaneGeometry( 2, 2 ), _material );\n\t_scene.add( mesh );\n\n\tthis.setSize = function ( width, height ) {\n\n\t\tif ( _renderTargetL ) _renderTargetL.dispose();\n\t\tif ( _renderTargetR ) _renderTargetR.dispose();\n\t\t_renderTargetL = new THREE.WebGLRenderTarget( width, height, _params );\n\t\t_renderTargetR = new THREE.WebGLRenderTarget( width, height, _params );\n\n\t\t_material.uniforms[ \"mapLeft\" ].value = _renderTargetL;\n\t\t_material.uniforms[ \"mapRight\" ].value = _renderTargetR;\n\n\t\trenderer.setSize( width, height );\n\n\t};\n\n\t/*\n\t * Renderer now uses an asymmetric perspective projection\n\t * (http://paulbourke.net/miscellaneous/stereographics/stereorender/).\n\t *\n\t * Each camera is offset by the eye seperation and its projection matrix is\n\t * also skewed asymetrically back to converge on the same projection plane.\n\t * Added a focal length parameter to, this is where the parallax is equal to 0.\n\t */\n\n\tthis.render = function ( scene, camera ) {\n\n\t\tscene.updateMatrixWorld();\n\n\t\tif ( camera.parent === undefined ) camera.updateMatrixWorld();\n\n\t\tvar hasCameraChanged = ( _aspect !== camera.aspect ) || ( _near !== camera.near ) || ( _far !== camera.far ) || ( _fov !== camera.fov );\n\n\t\tif ( hasCameraChanged ) {\n\n\t\t\t_aspect = camera.aspect;\n\t\t\t_near = camera.near;\n\t\t\t_far = camera.far;\n\t\t\t_fov = camera.fov;\n\n\t\t\tvar projectionMatrix = camera.projectionMatrix.clone();\n\t\t\t// var eyeSep = focalLength / 30 * 0.5;\n\t\t\tvar eyeSep = 0.05;\n\t\t\t// var eyeSepOnProjection = eyeSep * _near / focalLength;\n\t\t\tvar eyeSepOnProjection = 0;\n\t\t\tvar ymax = _near * Math.tan( THREE.Math.degToRad( _fov * 0.5 ) );\n\t\t\tvar xmin, xmax;\n\n\t\t\t// translate xOffset\n\n\t\t\teyeRight.elements[12] = eyeSep;\n\t\t\teyeLeft.elements[12] = -eyeSep;\n\n\t\t\t// for left eye\n\n\t\t\txmin = -ymax * _aspect + eyeSepOnProjection;\n\t\t\txmax = ymax * _aspect + eyeSepOnProjection;\n\n\t\t\tprojectionMatrix.elements[0] = 2 * _near / ( xmax - xmin );\n\t\t\tprojectionMatrix.elements[8] = ( xmax + xmin ) / ( xmax - xmin );\n\n\t\t\t_cameraL.projectionMatrix.copy( projectionMatrix );\n\n\t\t\t// for right eye\n\n\t\t\txmin = -ymax * _aspect - eyeSepOnProjection;\n\t\t\txmax = ymax * _aspect - eyeSepOnProjection;\n\n\t\t\tprojectionMatrix.elements[0] = 2 * _near / ( xmax - xmin );\n\t\t\tprojectionMatrix.elements[8] = ( xmax + xmin ) / ( xmax - xmin );\n\n\t\t\t_cameraR.projectionMatrix.copy( projectionMatrix );\n\n\t\t}\n\n\t\t_cameraL.matrixWorld.copy( camera.matrixWorld ).multiply( eyeLeft );\n\t\t_cameraL.position.copy( camera.position );\n\t\t_cameraL.near = camera.near;\n\t\t_cameraL.far = camera.far;\n\n\t\trenderer.render( scene, _cameraL, _renderTargetL, true );\n\n\t\t_cameraR.matrixWorld.copy( camera.matrixWorld ).multiply( eyeRight );\n\t\t_cameraR.position.copy( camera.position );\n\t\t_cameraR.near = camera.near;\n\t\t_cameraR.far = camera.far;\n\n\t\trenderer.render( scene, _cameraR, _renderTargetR, true );\n\n\t\trenderer.render( _scene, _camera );\n\n\t};\n\n\tthis.dispose = function() {\n\t\tif ( _renderTargetL ) _renderTargetL.dispose();\n\t\tif ( _renderTargetR ) _renderTargetR.dispose();\n\t}\n\n};\n",
    "// ██████╗ ██╗ ██████╗ ██╗████████╗ █████╗ ██╗         ████████╗██████╗ ██╗██████╗ \n// ██╔══██╗██║██╔════╝ ██║╚══██╔══╝██╔══██╗██║         ╚══██╔══╝██╔══██╗██║██╔══██╗\n// ██║  ██║██║██║  ███╗██║   ██║   ███████║██║            ██║   ██████╔╝██║██████╔╝\n// ██║  ██║██║██║   ██║██║   ██║   ██╔══██║██║            ██║   ██╔══██╗██║██╔═══╝ \n// ██████╔╝██║╚██████╔╝██║   ██║   ██║  ██║███████╗       ██║   ██║  ██║██║██║     \n// ╚═════╝ ╚═╝ ╚═════╝ ╚═╝   ╚═╝   ╚═╝  ╚═╝╚══════╝       ╚═╝   ╚═╝  ╚═╝╚═╝╚═╝     \n                                                                                \nvar DT = (function () {\n    'use strict';\n    var DT = {},\n        THREE = window.THREE || undefined,\n        WebAudio = window.WebAudio || undefined,\n        $ = window.$ || undefined,\n        THREEx = window.THREEx || undefined,\n        requestAnimFrame = function () {\n            return (\n                window.requestAnimationFrame       ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame    ||\n                window.oRequestAnimationFrame      ||\n                window.msRequestAnimationFrame     ||\n                function(/* function */ callback){\n                    window.setTimeout(callback, 1000 / 60);\n                }\n            );\n        }(),\n        cancelAnimFrame = function () {\n            return (\n                window.cancelAnimationFrame       ||\n                window.webkitCancelAnimationFrame ||\n                window.mozCancelAnimationFrame    ||\n                window.oCancelAnimationFrame      ||\n                window.msCancelAnimationFrame     ||\n                function(id){\n                    window.clearTimeout(id);\n                }\n            );\n        }();\n\n// ███████╗███████╗██████╗ ██╗   ██╗██╗ ██████╗███████╗    ███████╗██╗   ██╗███╗   ██╗ ██████╗████████╗██╗ ██████╗ ███╗   ██╗\n// ██╔════╝██╔════╝██╔══██╗██║   ██║██║██╔════╝██╔════╝    ██╔════╝██║   ██║████╗  ██║██╔════╝╚══██╔══╝██║██╔═══██╗████╗  ██║\n// ███████╗█████╗  ██████╔╝██║   ██║██║██║     █████╗      █████╗  ██║   ██║██╔██╗ ██║██║        ██║   ██║██║   ██║██╔██╗ ██║\n// ╚════██║██╔══╝  ██╔══██╗╚██╗ ██╔╝██║██║     ██╔══╝      ██╔══╝  ██║   ██║██║╚██╗██║██║        ██║   ██║██║   ██║██║╚██╗██║\n// ███████║███████╗██║  ██║ ╚████╔╝ ██║╚██████╗███████╗    ██║     ╚██████╔╝██║ ╚████║╚██████╗   ██║   ██║╚██████╔╝██║ ╚████║\n// ╚══════╝╚══════╝╚═╝  ╚═╝  ╚═══╝  ╚═╝ ╚═════╝╚══════╝    ╚═╝      ╚═════╝ ╚═╝  ╚═══╝ ╚═════╝   ╚═╝   ╚═╝ ╚═════╝ ╚═╝  ╚═══╝\n                                                                                                                          \n    DT.getCookie = function (name) {\n        var matches = document.cookie.match(\n            new RegExp('(?:^|; )' + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + '=([^;]*)')\n        );\n        return matches ? decodeURIComponent(matches[1]) : undefined;\n    };\n    DT.getDistance = function (x1, y1, z1, x2, y2, z2) {\n        return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2) + (z1 - z2) * (z1 - z2));\n    };\n    DT.genCoord = function (delta) {\n        var offset = delta || DT.game.param.spacing,\n        x = Math.random() * offset * 2 - offset,\n        absX = Math.abs(x);\n        if (absX <= offset && absX >= offset * 0.33 ) {\n            if (x > 0) {\n                return offset;\n            }\n            if (x < 0) {\n                return offset * -1;\n            }\n        } else {\n            return 0;\n        }\n    };\n    DT.genRandomFloorBetween = function (min, max) {\n        var rand = min - 0.5 + Math.random()*(max-min+1);\n        rand = Math.round(rand);\n        return rand;\n    };\n    DT.genRandomBetween = function (min, max) {\n        return Math.random() * (max - min) + min;\n    };\n    DT.genRandomSign = function () {\n        var signVal = Math.random() - 0.5;\n        return Math.abs(signVal)/signVal;\n    };\n\n    DT.animate = function (nowMsec) {\n        nowMsec = nowMsec || Date.now();\n        DT.animate.lastTimeMsec = DT.animate.lastTimeMsec || nowMsec - 1000 / 60;\n        var deltaMsec = Math.min(200, nowMsec - DT.animate.lastTimeMsec);\n        // keep looping\n        DT.animate.id = requestAnimFrame(DT.animate);\n        // change last time\n        DT.animate.lastTimeMsec = nowMsec;\n        // call each update function\n        $(document).trigger('update', {\n            delta: deltaMsec / 1000,\n            now: nowMsec / 1000\n        });\n    };\n\n// ████████╗██╗  ██╗██████╗ ███████╗███████╗    ██╗    ██╗ ██████╗ ██████╗ ██╗     ██████╗ \n// ╚══██╔══╝██║  ██║██╔══██╗██╔════╝██╔════╝    ██║    ██║██╔═══██╗██╔══██╗██║     ██╔══██╗\n   // ██║   ███████║██████╔╝█████╗  █████╗      ██║ █╗ ██║██║   ██║██████╔╝██║     ██║  ██║\n   // ██║   ██╔══██║██╔══██╗██╔══╝  ██╔══╝      ██║███╗██║██║   ██║██╔══██╗██║     ██║  ██║\n   // ██║   ██║  ██║██║  ██║███████╗███████╗    ╚███╔███╔╝╚██████╔╝██║  ██║███████╗██████╔╝\n   // ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚══════╝     ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚══════╝╚═════╝ \n                                                                                        \n    DT.renderer = new THREE.WebGLRenderer();\n    DT.renderer.setSize(window.innerWidth, window.innerHeight);\n    DT.renderer.physicallyBasedShading = true;\n    document.body.appendChild(DT.renderer.domElement);\n\n    DT.camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 1, 300);\n    DT.camera.position.set(0, 0.5, 15);\n    DT.camera.position.z = DT.camera.z = 15;\n    var lens = DT.camera.lens = 35;\n\n    DT.scene = new THREE.Scene();\n    \n    DT.lights = {\n        light: new THREE.PointLight(0xffffff, 0.75, 100),\n        directionalLight: new THREE.DirectionalLight(0xffffff, 0.25)\n    };\n    DT.lights.light.position.set(0, 0, -1);\n    DT.scene.add(DT.lights.light);\n\n    DT.lights.directionalLight.position.set(0, 0, 1);\n    DT.scene.add(DT.lights.directionalLight);\n\n    // BACKGROUND\n    DT.bgTexture = THREE.ImageUtils.loadTexture('img/bg.jpg');\n    DT.backgroundMesh = new THREE.Mesh(\n        new THREE.PlaneGeometry(44, 22, 0),\n        new THREE.MeshBasicMaterial({\n            map: DT.bgTexture\n        }));\n    DT.backgroundMesh.material.depthTest = false;\n    DT.backgroundMesh.material.depthWrite = false;\n    DT.backgroundMesh.visible = false;\n    DT.scene.add(DT.backgroundMesh);\n\n   // when resize\n    var winResize = new THREEx.WindowResize(DT.renderer, DT.camera);\n\n    // EFFECT\n    DT.effect = new THREE.AnaglyphEffect(DT.renderer);\n\n    // TODO: refactor\n    // render the scene\n    $(document).on('update', function (e, data) {\n        DT.renderer.render(DT.scene, DT.camera);\n        if (DT.player.isFun) {\n            DT.effect.render(DT.scene, DT.camera);\n            DT.effect.setSize( window.innerWidth, window.innerHeight );\n        }\n        if (!DT.backgroundMesh.visible) {\n            DT.backgroundMesh.visible = true;\n        }\n        if ( DT.animation ) {\n            DT.animation.update( data.delta*1000 );\n        }\n    });\n    // LENS\n    $(document).on('update', function (e, data) {\n        var camOffset = 6, camDelta = 0.1,\n            lensOffset = 18, lensDelta = 0.3;\n        if (DT.game.speed.getChanger() > 0) {\n            DT.camera.position.z = Math.max(DT.camera.position.z -= camDelta, DT.camera.z - camOffset);\n            lens = Math.max(lens -= lensDelta, DT.camera.lens - lensOffset);\n        } else if (DT.game.speed.getChanger() < 0) {\n            DT.camera.position.z = Math.min(DT.camera.position.z += camDelta, DT.camera.z + camOffset);\n            lens = Math.min(lens += lensDelta, DT.camera.lens + lensOffset);\n        } else {\n            var delta = DT.camera.lens - lens;\n            if (delta < 0) {\n                DT.camera.position.z = Math.max(DT.camera.position.z -= camDelta, DT.camera.z);\n                lens = Math.max(lens -= lensDelta, DT.camera.lens);\n            } else {\n                DT.camera.position.z = Math.min(DT.camera.position.z += camDelta, DT.camera.z);\n                lens = Math.min(lens += lensDelta, DT.camera.lens);\n            }\n        }\n        DT.camera.setLens(lens);\n    });\n    // change IcosahedronGeometry prototype\n    THREE.IcosahedronGeometry = function ( radius, detail ) {\n        this.radius = radius;\n        this.detail = detail;\n        var t = ( 1 + Math.sqrt( 5 ) ) / 2;\n        var vertices = [\n            [ -1,  t,  0 ], [  1, t, 0 ], [ -1, -t,  0 ], [  1, -t,  0 ],\n            [  0, -1,  t ], [  0, 1, t ], [  0, -1, -t ], [  0,  1, -t ],\n            [  t,  0, -1 ], [  t, 0, 1 ], [ -t,  0, -1 ], [ -t,  0,  1 ]\n        ];\n        vertices = vertices.map(function(el) {\n            return el.map(function(el) {\n                return el * Math.random();\n            });\n        });\n        var faces = [\n            [ 0, 11,  5 ], [ 0,  5,  1 ], [  0,  1,  7 ], [  0,  7, 10 ], [  0, 10, 11 ],\n            [ 1,  5,  9 ], [ 5, 11,  4 ], [ 11, 10,  2 ], [ 10,  7,  6 ], [  7,  1,  8 ],\n            [ 3,  9,  4 ], [ 3,  4,  2 ], [  3,  2,  6 ], [  3,  6,  8 ], [  3,  8,  9 ],\n            [ 4,  9,  5 ], [ 2,  4, 11 ], [  6,  2, 10 ], [  8,  6,  7 ], [  9,  8,  1 ]\n        ];\n        THREE.PolyhedronGeometry.call( this, vertices, faces, radius, detail );\n    };\n    THREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\n\n// ███████╗██╗  ██╗████████╗███████╗██████╗ ███╗   ██╗ █████╗ ██╗         ███╗   ███╗ ██████╗ ██████╗ ███████╗██╗     ███████╗\n// ██╔════╝╚██╗██╔╝╚══██╔══╝██╔════╝██╔══██╗████╗  ██║██╔══██╗██║         ████╗ ████║██╔═══██╗██╔══██╗██╔════╝██║     ██╔════╝\n// █████╗   ╚███╔╝    ██║   █████╗  ██████╔╝██╔██╗ ██║███████║██║         ██╔████╔██║██║   ██║██║  ██║█████╗  ██║     ███████╗\n// ██╔══╝   ██╔██╗    ██║   ██╔══╝  ██╔══██╗██║╚██╗██║██╔══██║██║         ██║╚██╔╝██║██║   ██║██║  ██║██╔══╝  ██║     ╚════██║\n// ███████╗██╔╝ ██╗   ██║   ███████╗██║  ██║██║ ╚████║██║  ██║███████╗    ██║ ╚═╝ ██║╚██████╔╝██████╔╝███████╗███████╗███████║\n// ╚══════╝╚═╝  ╚═╝   ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚══════╝    ╚═╝     ╚═╝ ╚═════╝ ╚═════╝ ╚══════╝╚══════╝╚══════╝\n\n    DT.listOfModels = [\n        {\n            name: 'bonusH',\n            scale: {x: 0.02, y: 0.02, z: 0.02},\n            rotation: {x: Math.PI / 1.3, y: -Math.PI / 1.3, z: -Math.PI / 1.3}\n        },\n        {\n            name: 'bonusI',\n            scale: {x: 0.5, y: 0.5, z: 0.5},\n            rotation: {x: Math.PI / 1.3, y: -Math.PI / 1.3, z: -Math.PI / 1.3}\n        },\n        {\n            name: 'bonusE',\n            scale: {x: 0.025, y: 0.025, z: 0.025},\n            rotation: {x: 0, y: 0, z: 0}\n        }\n    ];\n    // LOADER\n    var loader = new THREE.JSONLoader(true), // init the loader util\n        loadModel;\n    \n        // init loading\n    loadModel = function(modelObj) {\n        loader.load('js/models/' + modelObj.name + '.js', function (geometry, materials) {\n            // create a new material\n            if (modelObj.name === 'bonusE') {\n                modelObj.material = new THREE.MeshLambertMaterial( { color: 0x606060, morphTargets: true } );\n                modelObj.material.emissive.r = modelObj.material.color.r * 0.5;\n                modelObj.material.emissive.g = modelObj.material.color.g * 0.5;\n                modelObj.material.emissive.b = modelObj.material.color.b * 0.5;\n            } else {\n                modelObj.material = new THREE.MeshFaceMaterial( materials );\n                // shining of bonuses\n                modelObj.material.materials.forEach(function (el) {\n                    el.emissive.r = el.color.r * 0.5;\n                    el.emissive.g = el.color.g * 0.5;\n                    el.emissive.b = el.color.b * 0.5;\n                });\n            }\n            modelObj.geometry = geometry;\n        });\n        return modelObj;\n    };\n    DT.listOfModels.map(loadModel);\n\n// ███████╗██╗   ██╗███████╗███╗   ██╗████████╗███████╗\n// ██╔════╝██║   ██║██╔════╝████╗  ██║╚══██╔══╝██╔════╝\n// █████╗  ██║   ██║█████╗  ██╔██╗ ██║   ██║   ███████╗\n// ██╔══╝  ╚██╗ ██╔╝██╔══╝  ██║╚██╗██║   ██║   ╚════██║\n// ███████╗ ╚████╔╝ ███████╗██║ ╚████║   ██║   ███████║\n// ╚══════╝  ╚═══╝  ╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚══════╝\n                                                    \n    DT.events = {\n        'startGame'     : 'custom',\n        'pauseGame'     : 'custom',\n        'resumeGame'    : 'custom',\n        'resetGame'     : 'custom',\n        'update'        : 'custom',\n        'changeSpeed'   : 'custom',\n        'makeFun'       : 'custom',\n        'stopFun'       : 'custom',\n        'changeHelth'   : 'custom',\n        'showHelth'     : 'custom',\n        'changeScore'   : 'custom',\n        'showScore'     : 'custom',\n        'blink'         : 'custom',\n        'focus'         : 'native',\n        'blur'          : 'native',\n    };\n\n    $(document).on('startGame', function (e, data) {\n        DT.animate.id = requestAnimFrame(DT.animate);\n    });\n    $(document).on('pauseGame', function () {\n        cancelAnimFrame(DT.animate.id);\n    });\n    $(document).on('resumeGame', function (e, data) {\n        DT.animate.id = requestAnimFrame(DT.animate);\n    });\n    $(document).on('gameOver', function (e, data) {\n        setTimeout(function() {\n            cancelAnimFrame(DT.animate.id);\n        }, 300);\n    });\n\n // ██████╗  █████╗ ███╗   ███╗███████╗\n// ██╔════╝ ██╔══██╗████╗ ████║██╔════╝\n// ██║  ███╗███████║██╔████╔██║█████╗  \n// ██║   ██║██╔══██║██║╚██╔╝██║██╔══╝  \n// ╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗\n // ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝\n                                    \n    DT.Game = function () {\n        this.param = {\n            spacing: 3,\n            spawnCoord: -200,\n            opacityCoord: 2,\n            dieCoord: 30,\n            stonesCloseness: 18,\n            globalVolume: 1,\n            prevGlobalVolume: 1\n        };\n        this.speed = {\n            value: 36,\n            changer: 0,\n            step: 0.6,\n            increase: function () {\n                this.value += (this.step / 60);\n            },\n            setChanger: function (changer) {\n                this.changer = changer;\n            },\n            getChanger: function() {\n                return this.changer;\n            },\n            getValue: function () {\n                return (this.value + this.changer) / 60;\n            }\n        };\n        this.wasStarted = false;\n        this.wasPaused = false;\n        this.wasOver = false;\n        this.wasMuted = false;\n        this.timer = 0;\n    };\n    DT.Game.prototype.startGame = function() {\n        this.wasStarted = true;\n    };\n\n    DT.Game.prototype.updateTimer = function () {\n        this.timer += 1;\n        if (this.timer % 60 === 0) {\n            var sec, min;\n            sec = this.timer / 60;\n            min = Math.floor(sec / 60);\n            sec = sec % 60;\n            sec = sec < 10 ? '0' + sec.toString() : sec;\n            $('.gameTimer').html(min + ':' + sec);\n            $('title').html(min + ':' + sec + ' in digital trip');\n        }\n    };\n    DT.Game.prototype.update = function() {\n        this.updateTimer();\n        this.speed.increase();\n    };\n    DT.Game.prototype.reset = function() {\n        $(document).trigger('resetGame', {});\n        this.timer = 0;\n    };\n    DT.Game.prototype.gameOver = function() {\n        this.wasOver = true;\n    };\n\n    DT.game = new DT.Game();\n\n    $(document).on('startGame', function (e, data) {\n        DT.game.startGame();\n    });\n    $(document).on('pauseGame', function () {\n        DT.game.wasPaused = true;\n    });\n    $(document).on('resumeGame', function (e, data) {\n        DT.game.wasPaused = false;\n        DT.game.startGame();\n    });\n    $(document).on('update', function (e, data) {\n        DT.game.update();\n    });\n    $(document).on('changeSpeed', function (e, data) {\n        DT.game.speed.setChanger(data.changer);\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.game.gameOver();\n    });\n\n// ██████╗ ██╗      █████╗ ██╗   ██╗███████╗██████╗ \n// ██╔══██╗██║     ██╔══██╗╚██╗ ██╔╝██╔════╝██╔══██╗\n// ██████╔╝██║     ███████║ ╚████╔╝ █████╗  ██████╔╝\n// ██╔═══╝ ██║     ██╔══██║  ╚██╔╝  ██╔══╝  ██╔══██╗\n// ██║     ███████╗██║  ██║   ██║   ███████╗██║  ██║\n// ╚═╝     ╚══════╝╚═╝  ╚═╝   ╚═╝   ╚══════╝╚═╝  ╚═╝\n                                                 \n    DT.Player = function (options) {\n        if (!DT.Player.__instance) {\n            DT.Player.__instance = this;\n        } else {\n            return DT.Player.__instance;\n        }\n        var self = this;\n        this.scene = options.scene || DT.scene;\n        this.currentHelth = options.currentHelth || 100;\n        this.currentScore = options.currentScore || 0;\n        this.destPoint = options.destPoint || {x: 0, y: 0};\n        this.isInvulnerability = options.isInvulnerability || false;\n        this.isFun = options.isFun || false;\n        this.invulnerTimer = null;\n        this.funTimer = null;\n        this.sphere = new THREE.Mesh(new THREE.SphereGeometry(0.5, 32, 32), new THREE.MeshPhongMaterial({color: 0xff0000}));\n        this.sphere.position.set(0, -2.5, 0);\n        this.light = new THREE.PointLight(0xff0000, 1.75, 15);\n        this.light.position.set(0, 0, 0);\n        this.light.color = this.sphere.material.color;\n        this.scene.add(this.light);\n        this.blink = {\n            color: new THREE.Color('red'),\n            frames: 0,\n            framesLeft: 0,\n            dr: 0,\n            dg: 0,\n            db: 0,\n            doBlink: function (color, frames) {\n                var defClr = {r: 1, g: 0, b: 0};\n                this.color = new THREE.Color(color);\n                this.frames = frames;\n                this.framesLeft = frames;\n                this.dr = (defClr.r - this.color.r)/frames;\n                this.dg = (defClr.g - this.color.g)/frames;\n                this.db = (defClr.b - this.color.b)/frames;\n\n            },\n        };\n        this.emitter = Fireworks.createEmitter({nParticles : 100})\n        .effectsStackBuilder()\n            .spawnerSteadyRate(25)\n            .position(Fireworks.createShapePoint(0, 0, 0))\n            .velocity(Fireworks.createShapePoint(0, 0, 2))\n            .lifeTime(0.7, 0.7)\n            .randomVelocityDrift(Fireworks.createVector(0, 0, 0))\n            .renderToThreejsParticleSystem({\n                particleSystem  : function(emitter){\n                    var i,\n                        geometry    = new THREE.Geometry(),\n                        texture = Fireworks.ProceduralTextures.buildTexture(),\n                        material    = new THREE.ParticleBasicMaterial({\n                            color       : new THREE.Color().setHSL(1, 0, 0.3).getHex(),\n                            size        : 100,\n                            sizeAttenuation : false,\n                            vertexColors    : true,\n                            map     : texture,\n                            blending    : THREE.AdditiveBlending,\n                            depthWrite  : false,\n                            transparent : true\n                        }),\n                        particleSystem = new THREE.ParticleSystem(geometry, material);\n                        particleSystem.dynamic  = true;\n                        particleSystem.sortParticles = true;\n                    // init vertices\n                    for(i = 0; i < emitter.nParticles(); i++){\n                        geometry.vertices.push( new THREE.Vector3() );\n                    }\n                    // init colors\n                    geometry.colors = new Array(emitter.nParticles());\n                    for(i = 0; i < emitter.nParticles(); i++){\n                        geometry.colors[i]  = self.sphere.material.color;\n                    }\n                    \n                    self.scene.add(particleSystem);\n                    particleSystem.position = self.sphere.position;\n                    return particleSystem;\n                }\n            }).back()\n        .start();\n    };\n\n    DT.Player.prototype.updateBlink = function () {\n        // TODO: refactor\n        if (this.blink.framesLeft === 0) {\n            return;\n        }\n        if (this.blink.framesLeft === 1) {\n            this.sphere.material.color.setRGB(1,0,0)\n        }\n        if (this.blink.framesLeft === this.blink.frames) {\n            this.sphere.material.color.setRGB(this.blink.color.r,this.blink.color.g,this.blink.color.b);\n        }\n        if (this.blink.framesLeft < this.blink.frames) {\n            this.sphere.material.color.r += this.blink.dr;\n            this.sphere.material.color.g += this.blink.dg;\n            this.sphere.material.color.b += this.blink.db;\n        }\n        this.blink.framesLeft -= 1;\n        return this;\n    };\n\n    DT.Player.prototype.changeHelth = function(delta) {\n        if (delta > 0 || this.isInvulnerability === false) {\n            var helth = this.currentHelth;\n            if (helth > 0) {\n                helth += delta;\n                if (helth < 0) {\n                    helth = 0;\n                    $(document).trigger('gameOver', {});\n                }\n                if (helth > 100) {\n                    helth = 100;\n                }\n            }\n            this.currentHelth = helth;\n            $(document).trigger('showHelth', {helth: this.currentHelth});\n        }\n        return this;\n    };\n\n    DT.Player.prototype.makeInvulner = function (time) {\n        this.invulnerTimer = (time || 10000) / 1000 * 60;\n        this.isInvulnerability = true;\n        $(document).trigger('showInvulner', {invulner: true});\n        return this;\n    };\n\n    DT.Player.prototype.stopInvulner = function () {\n        this.invulnerTimer = 0;\n        this.isInvulnerability = false;\n        $(document).trigger('showInvulner', {invulner: false});\n        return this;\n    };\n\n    DT.Player.prototype.changeScore = function(delta) {\n        this.currentScore += delta;\n        $(document).trigger('showScore', {score: this.currentScore});\n        return this;\n    };\n\n    DT.Player.prototype.makeFun = function(time) {\n        this.isFun = true;\n        this.funTimer = (time || 10000) / 1000 * 60;\n        $(document).trigger('showFun', {isFun: true});\n        return this;\n    };\n\n    DT.Player.prototype.stopFun = function () {\n        this.isFun = false;\n        this.funTimer = 0;\n        $(document).trigger('showFun', {isFun: false});\n        return this;\n    };\n\n    DT.Player.prototype.updateInvulnerability = function () {\n        if (this.isInvulnerability) {\n            this.invulnerTimer -= 1;\n            if (this.invulnerTimer <= 0) {\n                this.isInvulnerability = false;\n                $(document).trigger('showInvulner', {invulner: false});\n            } else {\n                return this;\n            }\n        }\n        return this;\n    };\n\n    DT.Player.prototype.updateFun = function () {\n        if (this.isFun) {\n            this.funTimer -= 1;\n            if (this.funTimer <= 0) {\n                this.stopFun();\n            } else if (this.funTimer % 6 === 0) {\n                var color = new THREE.Color().setRGB(\n                    DT.genRandomFloorBetween(0, 3),\n                    DT.genRandomFloorBetween(0, 3),\n                    DT.genRandomFloorBetween(0, 3)\n                );\n                this.blink.doBlink(color, 10);\n            }\n        }\n        return this;\n    };\n\n    DT.Player.prototype.update = function () {\n        this.updateInvulnerability();\n        this.updateFun();\n        this.updateBlink();\n        return this;\n    };\n\n    DT.Player.prototype.reset = function () {\n        this.currentHelth = 100;\n        this.currentScore = 0;\n        this.destPoint = {x: 0, y: -2.5};\n        this.isInvulnerability = false;\n        this.isFun = false;\n        return this;\n    };\n\n    DT.Player.prototype.changeDestPoint = function(dy, dx) {\n        if ((this.destPoint.x < DT.game.param.spacing && dx > 0) || (this.destPoint.x > -DT.game.param.spacing && dx < 0)) {\n            this.destPoint.x += dx * DT.game.param.spacing;\n        }\n        return this;\n    };\n\n    DT.Player.prototype.moveSphere = function(n) {\n        // TODO: refactor\n        var i, self = this,\n            iterator = function(aix) {\n            var dx = self.destPoint[aix] - self.sphere.position[aix];\n            if (Math.abs(dx) > 0.01) {\n                self.sphere.position[aix] += dx > 0 ? 0.1 : -0.1;\n            }\n        };\n        for (i = 0; i < n; i++) {\n            ['x'].forEach(iterator);\n        }\n            ['y'].forEach(function(aix) {\n                var dx = self.destPoint[aix] - self.sphere.position[aix];\n                if (Math.abs(dx) > 0.01) {\n                    self.sphere.position[aix] += dx > 0 ? 0.1 : -0.1;\n                }\n            });\n        return this;\n    };\n\n    DT.Player.prototype.bump = function (amp) {\n        if (this.isInvulnerability) return;\n        for (var i = 0; i < 2; i++) {\n            amp = amp || 0.15;\n            this.sphere.position.x += DT.genRandomSign() * amp;\n            this.sphere.position.y += DT.genRandomSign() * amp;\n        }\n        return this;\n     };\n\n    DT.player = new DT.Player({\n        currentHelth: 100,\n        currentScore: 0,\n        destPoint: {x: 0, y: -2.5},\n        isInvulnerability: false,\n        isFun: false\n    });\n    $(document).on('update', function (e, data) {\n        DT.player.update();\n    });\n    // TODO: refactor\n    $(document).on('update', function (e, data) {\n        DT.player.moveSphere(3);\n        DT.player.light.position.x = DT.player.sphere.position.x;\n        DT.player.light.position.y = DT.player.sphere.position.y;\n    });\n    $(document).on('update', function (e, data) {\n        DT.player.emitter.update(data.delta).render();\n        DT.player.emitter._particles.forEach(function(el) {\n            el.velocity.vector.z += DT.audio.valueAudio/28;\n        });\n    });\n    $(document).on('makeFun', function (e, data) {\n        DT.player.makeFun();\n    });\n    $(document).on('stopFun', function (e, data) {\n        DT.player.stopFun();\n    });\n    $(document).on('changeScore', function (e, data) {\n        DT.player.changeScore(data.delta);\n    });\n    $(document).on('changeHelth', function (e, data) {\n        DT.player.changeHelth(data.delta);\n    });\n    $(document).on('makeInvulner', function (e, data) {\n        DT.player.makeInvulner();\n    });\n    $(document).on('stopInvulner', function (e, data) {\n        DT.player.stopInvulner();\n    });\n    $(document).on('blink', function (e, data) {\n        DT.player.blink.doBlink(data.color, data.frames);\n    });\n    $(document).on('gameOver', function (e, data) {\n        clearTimeout(DT.player.isFun);\n    });\n\n // ██████╗  █████╗ ███╗   ███╗███████╗     ██████╗ ██████╗      ██╗███████╗ ██████╗████████╗\n// ██╔════╝ ██╔══██╗████╗ ████║██╔════╝    ██╔═══██╗██╔══██╗     ██║██╔════╝██╔════╝╚══██╔══╝\n// ██║  ███╗███████║██╔████╔██║█████╗      ██║   ██║██████╔╝     ██║█████╗  ██║        ██║   \n// ██║   ██║██╔══██║██║╚██╔╝██║██╔══╝      ██║   ██║██╔══██╗██   ██║██╔══╝  ██║        ██║   \n// ╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗    ╚██████╔╝██████╔╝╚█████╔╝███████╗╚██████╗   ██║   \n // ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝     ╚═════╝ ╚═════╝  ╚════╝ ╚══════╝ ╚═════╝   ╚═╝   \n                                                                                          \n    DT.GameObject = function (options) {\n        this.tObject = new options.THREEConstructor(\n            options.geometry,\n            options.material\n        );\n        this.geometry = this.tObject.geometry;\n        this.material = this.tObject.material;\n        this.scene = options.scene || DT.scene;\n    };\n    DT.GameObject.prototype.addToScene = function () {\n        this.scene.add(this.tObject);\n        return this;\n    };\n    DT.GameObject.prototype.removeFromScene = function () {\n        this.scene.remove(this.tObject);\n        return this;\n    };\n    DT.GameObject.prototype.create = function () {\n        // empty method\n        console.log('try to call empty method');\n        return this;\n    };\n    DT.GameObject.prototype.createAndAdd = function () {\n        return this.create()\n            .addToScene();\n    };\n    DT.GameObject.prototype.update = function (options) {\n        return this.updateGeometry(options.geometry)\n            .updateMaterial(options.material);\n    };\n    DT.GameObject.prototype.updateGeometry = function (options) {\n        // empty method\n        console.log('try to call empty method');\n        return this;\n    };\n    DT.GameObject.prototype.updateMaterial = function (options) {\n        // empty method\n        console.log('try to call empty method');\n        return this;\n    };\n    DT.GameObject.prototype.updateParam = function (param, options) {\n        for (var prop in options) if (options.hasOwnProperty(prop)) {\n            this.tObject[param][prop] += options[prop];\n        }\n        return this;\n    };\n    DT.GameObject.prototype.setParam = function (param, options) {\n        for (var prop in options) if (options.hasOwnProperty(prop)) {\n            this.tObject[param][prop] = options[prop];\n        }\n        return this;\n    };\n\n // ██████╗  █████╗ ███╗   ███╗███████╗     ██████╗ ██████╗ ██╗     ██╗          ██████╗ ██████╗      ██╗\n// ██╔════╝ ██╔══██╗████╗ ████║██╔════╝    ██╔════╝██╔═══██╗██║     ██║         ██╔═══██╗██╔══██╗     ██║\n// ██║  ███╗███████║██╔████╔██║█████╗      ██║     ██║   ██║██║     ██║         ██║   ██║██████╔╝     ██║\n// ██║   ██║██╔══██║██║╚██╔╝██║██╔══╝      ██║     ██║   ██║██║     ██║         ██║   ██║██╔══██╗██   ██║\n// ╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗    ╚██████╗╚██████╔╝███████╗███████╗    ╚██████╔╝██████╔╝╚█████╔╝\n // ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝     ╚═════╝ ╚═════╝ ╚══════╝╚══════╝     ╚═════╝ ╚═════╝  ╚════╝ \n                                                                                                      \n    DT.GameCollectionObject = function (options) {\n        DT.GameObject.apply(this, arguments);\n        this.collection = options.collection;\n    };\n    DT.GameCollectionObject.prototype = Object.create(DT.GameObject.prototype);\n    DT.GameCollectionObject.prototype.constructor = DT.GameCollectionObject;\n\n    DT.GameCollectionObject.prototype.create = function () {\n        this.collection.push(this);\n        return this;\n    };\n\n    DT.GameCollectionObject.prototype.update = function (options) {\n        if (this.tObject.position.z > options.dieCoord) {\n            this.removeFromScene();\n        } \n        if (this.tObject.position.z > options.opacityCoord) {\n            if (this.tObject.children.length > 0) {\n                this.tObject.children.forEach(function (el) {\n                    el.material.transparent = true;\n                    el.material.opacity = 0.5; \n                });\n            } else {\n                this.tObject.material = new THREE.MeshLambertMaterial({\n                     shading: THREE.FlatShading,\n                     transparent: true,\n                     opacity: 0.5\n                 });\n            }\n        }\n        return this;\n    };\n\n    DT.GameCollectionObject.prototype.removeFromScene = function () {\n        DT.GameObject.prototype.removeFromScene.apply(this, arguments);\n        var ind = this.collection.indexOf(this);\n        if (ind !== -1) {\n            this.collection.splice(ind, 1);\n        }\n        return this;\n    };\n\n// ███████╗██╗  ██╗██╗███████╗██╗     ██████╗ \n// ██╔════╝██║  ██║██║██╔════╝██║     ██╔══██╗\n// ███████╗███████║██║█████╗  ██║     ██║  ██║\n// ╚════██║██╔══██║██║██╔══╝  ██║     ██║  ██║\n// ███████║██║  ██║██║███████╗███████╗██████╔╝\n// ╚══════╝╚═╝  ╚═╝╚═╝╚══════╝╚══════╝╚═════╝ \n                                           \n    DT.Shield = function (options) {\n        if (!DT.Shield.__instance) {\n            DT.Shield.__instance = this;\n        } else {\n            return DT.Shield.__instance;\n        }\n        DT.GameObject.apply(this, arguments);\n        this.material.color = options.sphere.material.color;\n        this.tObject.position = options.sphere.position;\n    };\n    DT.Shield.prototype = Object.create(DT.GameObject.prototype);\n    DT.Shield.prototype.constructor = DT.Shield;\n\n    DT.shield = new DT.Shield({\n        THREEConstructor: THREE.Mesh,\n        geometry: new THREE.CubeGeometry(1.3, 1.3, 1.3, 2, 2, 2),\n        material: new THREE.MeshPhongMaterial({\n            color: 0xffffff,\n            transparent: true,\n            opacity: 0.5\n        }),\n        sphere: DT.player.sphere\n    });\n    $(document).on('showInvulner', function (e, data) {\n        console.log('showInvulner');\n        if (data.invulner) {\n            DT.shield.addToScene();\n        } else {\n            DT.shield.removeFromScene();\n        }\n    });\n\n// ██████╗ ██╗   ██╗███████╗████████╗\n// ██╔══██╗██║   ██║██╔════╝╚══██╔══╝\n// ██║  ██║██║   ██║███████╗   ██║   \n// ██║  ██║██║   ██║╚════██║   ██║   \n// ██████╔╝╚██████╔╝███████║   ██║   \n// ╚═════╝  ╚═════╝ ╚══════╝   ╚═╝   \n                                  \n    DT.Dust = function (options) {\n        DT.GameObject.apply(this, arguments);\n        this.number = options.number || 100;\n        this.createAndAdd();\n    };\n    DT.Dust.prototype = Object.create(DT.GameObject.prototype);\n    DT.Dust.prototype.constructor = DT.Dust;\n\n    DT.Dust.prototype.create = function () {\n        for (var i = 0; i < this.number; i++) {\n            this.geometry.vertices.push(new THREE.Vector3(\n                DT.genRandomBetween(-10, 10),\n                DT.genRandomBetween(-10, 10),\n                DT.genRandomBetween(-100, 0)\n            ));\n        }\n        this.material.visible = false;\n        return this;\n    };\n\n    DT.Dust.prototype.updateMaterial = function (options) {\n        if (!this.material.visible) {\n            this.material.visible = true;\n        }\n        this.material.color = options.isFun ? options.color : new THREE.Color().setRGB(\n            options.valueAudio/1/1 || 70/255,\n            options.valueAudio/255/1 || 68/255,\n            options.valueAudio/255/1 || 81/255\n        );\n        return this;\n    };\n\n    DT.Dust.prototype.updateGeometry = function (options) {\n        this.geometry.vertices.forEach(function (el) {\n            el.z += options.speed;\n            if (el.z > 10) {\n                el.x = DT.genRandomBetween(-10, 10);\n                el.y = DT.genRandomBetween(-10, 10);\n                el.z = -100;\n            }\n        });\n        this.geometry.verticesNeedUpdate = true;\n        return this;\n    };\n    // Dust object \n    DT.dust = new DT.Dust({\n        geometry: new THREE.Geometry({}),\n        material: new THREE.ParticleSystemMaterial({size: 0.25}),\n        THREEConstructor: THREE.ParticleSystem\n    });\n    $(document).on('update', function (e, data) {\n        DT.dust.update({\n            material: {\n                isFun: DT.player.isFun,\n                valueAudio: DT.audio.valueAudio,\n                color: DT.player.sphere.material.color\n            }, \n            geometry: {\n                speed: DT.game.speed.getValue()\n            }\n        });\n    });\n\n// ███████╗████████╗ ██████╗ ███╗   ██╗███████╗\n// ██╔════╝╚══██╔══╝██╔═══██╗████╗  ██║██╔════╝\n// ███████╗   ██║   ██║   ██║██╔██╗ ██║█████╗  \n// ╚════██║   ██║   ██║   ██║██║╚██╗██║██╔══╝  \n// ███████║   ██║   ╚██████╔╝██║ ╚████║███████╗\n// ╚══════╝   ╚═╝    ╚═════╝ ╚═╝  ╚═══╝╚══════╝\n                                            \n    DT.Stone = function (options) {\n        var radius, color, x, y, depth, geometry, material,\n            part = Math.random();\n        // \n        if (part >= 0 && part < 0.16) {\n            x = DT.genRandomBetween(-15, -5);\n            y = DT.genRandomBetween(-15, -5);\n        } else if (part >= 0.16 && part < 0.32){\n            x = DT.genRandomBetween(5, 15);\n            y = DT.genRandomBetween(5, 15);\n        } else {\n            x = DT.genRandomBetween(-5, 5);\n            y = DT.genRandomBetween(-5, 5);\n        }\n        //\n        if (Math.abs(x) > 5 || Math.abs(y) > 5) {\n            radius = DT.genRandomBetween(1.5, 3);\n            color = new THREE.Color(0x464451);\n        } else {\n            radius = DT.genRandomBetween(1, 2);\n            depth = DT.genRandomFloorBetween(80, 100) / 255;\n            color = new THREE.Color().setRGB(depth, depth, depth);\n        }\n        geometry = new THREE.IcosahedronGeometry(radius, 0);\n        material = new THREE.MeshPhongMaterial({\n            shading: THREE.FlatShading,\n            color: color,\n            specular: 0x111111,\n            shininess: 100\n        });\n        DT.GameCollectionObject.apply(this, [{\n            geometry: geometry,\n            material: material,\n            THREEConstructor: THREE.Mesh,\n            collection: options.collection\n        }]);\n        this.setParam('position', {\n            x: x,\n            y: y,\n            z: options.spawnCoord\n        })\n        .setParam('rotation', {\n            x: Math.random(),\n            y: Math.random()\n        })\n        .createAndAdd();\n        this.distanceToSphere = null;\n    };\n    DT.Stone.prototype = Object.create(DT.GameCollectionObject.prototype);\n    DT.Stone.prototype.constructor = DT.Stone;\n\n    DT.Stone.prototype.update = function (options) {\n        DT.GameCollectionObject.prototype.update.apply(this, arguments);\n        var el = this.tObject;\n        this.distanceToSphere = el.position.distanceTo(options.sphere.position);\n        this.minDistance = options.sphere.geometry.radius + el.geometry.radius;\n            \n        if (this.distanceToSphere < this.minDistance) {\n            DT.audio.sounds.stoneDestroy.play();\n            DT.sendSocketMessage({\n                type: 'vibr',\n                time: 200\n            });\n            this.removeFromScene();\n\n            $(document).trigger('changeHelth', {delta: -19});\n            // вызвать вспышку экрана\n            if (DT.player.isInvulnerability === false) {\n                DT.hit();\n            }\n        }\n        if (this.distanceToSphere > this.minDistance && this.distanceToSphere < this.minDistance + 1 && el.position.z - options.sphere.position.z > 1) {\n            DT.audio.sounds.stoneMiss.play();\n        }\n        if (DT.getDistance(options.sphere.position.x, options.sphere.position.y, el.position.z, el.position.x, el.position.y, el.position.z) < this.minDistance) {\n            el.material.emissive = new THREE.Color().setRGB(\n                el.material.color.r * 0.5,\n                el.material.color.g * 0.5,\n                el.material.color.b * 0.5);\n        } else {\n            el.material.emissive = new THREE.Color().setRGB(0,0,0);\n        }\n        this.updateParam('rotation', {x: 0.014, y: 0.014})\n            .updateParam('position', {z: DT.game.speed.getValue()});\n        return this;\n    };\n\n // ██████╗ ██████╗ ██╗███╗   ██╗\n// ██╔════╝██╔═══██╗██║████╗  ██║\n// ██║     ██║   ██║██║██╔██╗ ██║\n// ██║     ██║   ██║██║██║╚██╗██║\n// ╚██████╗╚██████╔╝██║██║ ╚████║\n // ╚═════╝ ╚═════╝ ╚═╝╚═╝  ╚═══╝\n                              \n    DT.Coin = function (options) {\n        var r = 0.5, i,\n            coin_sides_geo = new THREE.CylinderGeometry( r, r, 0.05, 32, 1, true ),\n            coin_cap_geo = new THREE.Geometry();\n        for (i = 0; i < 100; i++) {\n            var a = i * 1/100 * Math.PI * 2,\n                z = Math.sin(a),\n                xCosA = Math.cos(a),\n                a1 = (i+1) * 1/100 * Math.PI * 2,\n                z1 = Math.sin(a1),\n                x1 = Math.cos(a1);\n            coin_cap_geo.vertices.push(\n                new THREE.Vector3(0, 0, 0),\n                new THREE.Vector3(xCosA*r, 0, z*r),\n                new THREE.Vector3(x1*r, 0, z1*r)\n            );\n            coin_cap_geo.faceVertexUvs[0].push([\n                new THREE.Vector2(0.5, 0.5),\n                new THREE.Vector2(xCosA/2+0.5, z/2+0.5),\n                new THREE.Vector2(x1/2+0.5, z1/2+0.5)\n            ]);\n            coin_cap_geo.faces.push(new THREE.Face3(i*3, i*3+1, i*3+2));\n        }\n        coin_cap_geo.computeCentroids();\n        coin_cap_geo.computeFaceNormals();\n        \n        var coin_cap_texture = THREE.ImageUtils.loadTexture('./img/avers.png'),\n            coin_sides_mat = new THREE.MeshPhongMaterial({emissive: 0xcfb53b, color: 0xcfb53b}),\n            coin_sides = new THREE.Mesh( coin_sides_geo, coin_sides_mat ),\n            coin_cap_mat = new THREE.MeshPhongMaterial({emissive: 0xcfb53b, color: 0xcfb53b, map: coin_cap_texture}),\n            coin_cap_top = new THREE.Mesh( coin_cap_geo, coin_cap_mat ),\n            coin_cap_bottom = new THREE.Mesh( coin_cap_geo, coin_cap_mat );\n\n        coin_cap_top.position.y = 0.05;\n        coin_cap_bottom.position.y = -0.05;\n        coin_cap_top.rotation.x = Math.PI;\n\n        DT.GameCollectionObject.apply(this, [{\n            THREEConstructor: THREE.Object3D,\n            collection: options.collection\n        }]);\n        \n        this.tObject.add(coin_sides);\n        this.tObject.add(coin_cap_top);\n        this.tObject.add(coin_cap_bottom);\n        \n        this.setParam('position', {\n            x: options.x,\n            y: options.y,\n            z: options.z\n        })\n            .setParam('rotation', {\n            x: 1.5,\n            y: 0,\n            z: options.zAngle\n        })\n            .createAndAdd();\n    };\n    DT.Coin.prototype = Object.create(DT.GameCollectionObject.prototype);\n    DT.Coin.prototype.constructor = DT.Coin;\n\n    DT.Coin.prototype.update = function (options) {\n        DT.GameCollectionObject.prototype.update.apply(this, arguments);\n        this.updateParam('rotation', {z: 0.05})\n            .updateParam('position', {z: DT.game.speed.getValue()});\n        var positon = this.tObject.position;\n        var distanceBerweenCenters = positon.distanceTo(options.sphere.position);\n        if (distanceBerweenCenters < 0.9) {\n            this.removeFromScene();\n            $(document).trigger('changeScore', {delta: 1});\n            DT.audio.sounds.catchCoin.play();\n            DT.sendSocketMessage({\n                type: 'vibr',\n                time: 10\n            });\n            $(document).trigger('blink', {color: 0xcfb53b, frames: 60});\n            DT.player.bump();\n        }\n        return this;\n    };\n\n// ██████╗  ██████╗ ███╗   ██╗██╗   ██╗███████╗\n// ██╔══██╗██╔═══██╗████╗  ██║██║   ██║██╔════╝\n// ██████╔╝██║   ██║██╔██╗ ██║██║   ██║███████╗\n// ██╔══██╗██║   ██║██║╚██╗██║██║   ██║╚════██║\n// ██████╔╝╚██████╔╝██║ ╚████║╚██████╔╝███████║\n// ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝ ╚═════╝ ╚══════╝\n                                            \n    DT.Bonus = function (options) {\n        this.type = DT.genRandomFloorBetween(0, 2);\n        DT.GameCollectionObject.apply(this, [{\n            geometry: DT.listOfModels[this.type].geometry,\n            material: DT.listOfModels[this.type].material,\n            THREEConstructor: THREE.Mesh,\n            collection: options.collection\n        }]);\n        this.setParam('position', {\n                x: options.x,\n                y: options.y,\n                z: options.spawnCoord * 2\n            })\n            .setParam('scale', {\n                x: DT.listOfModels[this.type].scale.x || 1,\n                y: DT.listOfModels[this.type].scale.y || 1,\n                z: DT.listOfModels[this.type].scale.z || 1\n            })\n            .setParam('rotation', {\n                x: DT.listOfModels[this.type].rotation.x || 0,\n                y: DT.listOfModels[this.type].rotation.y || 0,\n                z: DT.listOfModels[this.type].rotation.z || 0\n            })\n            .createAndAdd();\n        // TODO: сделать расширяемой возможность анимации\n        if (this.type === 2) {\n            DT.animation = new THREE.MorphAnimation(this.tObject);\n            DT.animation.play();\n        }\n    };\n    DT.Bonus.prototype = Object.create(DT.GameCollectionObject.prototype);\n    DT.Bonus.prototype.constructor = DT.Bonus;\n\n    DT.Bonus.prototype.update = function (options) {\n        var self = this;\n        if (this.type === 0) {\n            this.updateParam('rotation', {z: 0.05});\n        }\n        if (this.type === 1) {\n            this.updateParam('rotation', {z: 0.05});\n        }\n        if (this.type === 2) {\n            // this.updateParam('rotation', {z: 0.05});\n        }\n        \n        this.updateParam('position', {z: DT.game.speed.getValue()});\n        DT.GameCollectionObject.prototype.update.apply(this, arguments);\n        if (DT.getDistance(this.tObject.position.x, this.tObject.position.y, this.tObject.position.z,\n                options.sphere.position.x, options.sphere.position.y, options.sphere.position.z) < 1.0) {\n            \n            if (this.type === 0) {\n                this.tObject.rotation.x += 0.2;\n            }\n            if (this.type === 1) {\n                this.tObject.rotation.y += 0.2;\n            }\n            if (this.type === 2) {\n                // this.tObject.rotation.z += 0.2;\n            }\n            \n            this.tObject.scale.x *= 0.9;\n            this.tObject.scale.y *= 0.9;\n            this.tObject.scale.z *= 0.9;\n            \n            if (DT.getDistance(this.tObject.position.x, this.tObject.position.y, this.tObject.position.z,\n                    options.sphere.position.x, options.sphere.position.y, options.sphere.position.z) < 0.9) {\n                this.removeFromScene();\n                $(document).trigger('catchBonus', {type: self.type});\n            }\n        }\n    };\n\n // ██████╗ ██████╗ ██╗     ██╗     ███████╗ ██████╗████████╗██╗ ██████╗ ███╗   ██╗\n// ██╔════╝██╔═══██╗██║     ██║     ██╔════╝██╔════╝╚══██╔══╝██║██╔═══██╗████╗  ██║\n// ██║     ██║   ██║██║     ██║     █████╗  ██║        ██║   ██║██║   ██║██╔██╗ ██║\n// ██║     ██║   ██║██║     ██║     ██╔══╝  ██║        ██║   ██║██║   ██║██║╚██╗██║\n// ╚██████╗╚██████╔╝███████╗███████╗███████╗╚██████╗   ██║   ██║╚██████╔╝██║ ╚████║\n // ╚═════╝ ╚═════╝ ╚══════╝╚══════╝╚══════╝ ╚═════╝   ╚═╝   ╚═╝ ╚═════╝ ╚═╝  ╚═══╝\n                                                                                \n    DT.Collection = function (options) {\n        this.collection = [];\n        this.constructor = options.constructor;\n    };\n\n    DT.Collection.prototype.createObjects = function (options) {\n        options.number = options.number || 1;\n        options.collection = this.collection;\n        return this;\n    };\n\n    DT.Collection.prototype.update = function (options) {\n        this.collection.forEach(function (el) {\n            el.update(options);\n        });\n        return this;\n    };\n\n    DT.Collection.prototype.removeObjects = function () {\n        this.collection.forEach(function (el) {\n            ei.removeFromScene();\n        });\n        return this;\n    };\n\n    DT.StonesCollection = function () {\n        if (!DT.StonesCollection.__instance) {\n            DT.StonesCollection.__instance = this;\n        } else {\n            return DT.StonesCollection.__instance;\n        }\n        DT.Collection.apply(this, [{\n            constructor: DT.Stone\n        }]);\n    };\n    DT.StonesCollection.prototype = Object.create(DT.Collection.prototype);\n    DT.StonesCollection.prototype.constructor = DT.StonesCollection;\n\n    DT.StonesCollection.prototype.createObjects = function (options) {\n        DT.Collection.prototype.createObjects.apply(this, arguments);\n        var el = this.collection[this.collection.length -1];\n\n        if (el) {\n            var dist = DT.getDistance(0, 0, DT.game.param.spawnCoord,\n                el.tObject.position.x, el.tObject.position.y, el.tObject.position.z);\n            if (dist <= DT.game.param.stonesCloseness) {\n                return this;\n            }\n        }\n        for (var i = 0; i < options.number; i++) {\n            new this.constructor(options);\n        }\n        return this;\n    };\n    $(document).on('update', function (e, data) {\n        new DT.StonesCollection()\n            .createObjects({\n                spawnCoord: DT.game.param.spawnCoord,\n            })\n            .update({\n                dieCoord: DT.game.param.dieCoord,\n                opacityCoord: DT.game.param.opacityCoord,\n                sphere: DT.player.sphere\n            });\n    });\n\n    DT.CoinsCollection = function () {\n        if (!DT.CoinsCollection.__instance) {\n            DT.CoinsCollection.__instance = this;\n        } else {\n            return DT.CoinsCollection.__instance;\n        }\n        DT.Collection.apply(this, [{\n            constructor: DT.Coin\n        }]);\n    };\n    DT.CoinsCollection.prototype = Object.create(DT.Collection.prototype);\n    DT.CoinsCollection.prototype.constructor = DT.CoinsCollection;\n\n    DT.CoinsCollection.prototype.createObjects = function (options) {\n        DT.Collection.prototype.createObjects.apply(this, arguments);\n        if (!this.collection.length) {\n            for (var i = 0; i < options.number; i++) {\n                options.zAngle = i * 0.25;\n                options.z = options.spawnCoord - i * 10;\n                new this.constructor(options);\n            }\n        }\n        return this;\n    };\n    $(document).on('update', function (e, data) {\n        new DT.CoinsCollection()\n            .createObjects({\n                x: DT.genCoord(),\n                y: -2.5,\n                spawnCoord: DT.game.param.spawnCoord,\n                zAngle: 0,\n                number: 10\n            })\n            .update({\n                dieCoord: DT.game.param.dieCoord,\n                opacityCoord: DT.game.param.opacityCoord,\n                sphere: DT.player.sphere\n            });\n    });\n\n    DT.BonusesCollection = function (options) {\n        if (!DT.BonusesCollection.__instance) {\n            DT.BonusesCollection.__instance = this;\n        } else {\n            return DT.BonusesCollection.__instance;\n        }\n        DT.Collection.apply(this, [{\n            constructor: DT.Bonus\n        }]);\n        this.caughtBonuses = [];\n    };\n    DT.BonusesCollection.prototype = Object.create(DT.Collection.prototype);\n    DT.BonusesCollection.prototype.constructor = DT.BonusesCollection;\n\n    DT.BonusesCollection.prototype.createObjects = function (options) {\n        DT.Collection.prototype.createObjects.apply(this, arguments);\n        if (!this.collection.length) {\n            for (var i = 0; i < options.number; i++) {\n                new this.constructor(options);\n            }\n        }\n        return this;\n    };\n    DT.BonusesCollection.prototype.useBonuses = function (type) {\n        // helth\n        if (type === 0) $(document).trigger('changeHelth', {delta: 100});\n        // invulnerability\n        if (type === 1) $(document).trigger('makeInvuler', {});\n        // entertainment\n        if (type === 2) $(document).trigger('makeFun', {});\n        return this;\n    };\n\n    DT.BonusesCollection.prototype.catchBonus = function (type) {\n        var self = this;\n        if (!this.caughtBonuses.length || this.caughtBonuses[0] === type) {\n            this.caughtBonuses.push(type);\n            if (this.caughtBonuses.length === 3) {\n                this.useBonuses(type);\n                var refreshBonus = setTimeout(function() {\n                    self.caughtBonuses.length = 0;\n                    clearTimeout(refreshBonus);\n                }, 100);\n            }\n        } else {\n            this.caughtBonuses.length = 0;\n            this.caughtBonuses.push(type);\n        }\n        $(document).trigger('showBonuses', {caughtBonuses: this.caughtBonuses});\n        return this;\n    };\n    $(document).on('update', function (e, data) {\n        new DT.BonusesCollection()\n            .createObjects({\n                x: DT.genCoord(),\n                y: -2.5,\n                spawnCoord: DT.game.param.spawnCoord,\n            })\n            .update({\n                dieCoord: DT.game.param.dieCoord,\n                opacityCoord: DT.game.param.opacityCoord,\n                sphere: DT.player.sphere\n            });\n    });\n    $(document).on('catchBonus', function (e, data) {\n        new DT.BonusesCollection().catchBonus(data.type);\n    });\n\n // █████╗ ██╗   ██╗██████╗ ██╗ ██████╗ \n// ██╔══██╗██║   ██║██╔══██╗██║██╔═══██╗\n// ███████║██║   ██║██║  ██║██║██║   ██║\n// ██╔══██║██║   ██║██║  ██║██║██║   ██║\n// ██║  ██║╚██████╔╝██████╔╝██║╚██████╔╝\n// ╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═╝ ╚═════╝ \n                                     \n    // TODO: рефакторинг\n    DT.audio = {\n        frequency: { // for audio visualization\n            0: 400,\n            1: 100\n        },\n        valueAudio: 0,\n        webaudio: new WebAudio(),\n        sounds: {\n            catchCoin: 'sounds/coin.',\n            gameover: 'sounds/gameover.',\n            pause: 'sounds/pause.',\n            stoneDestroy: 'sounds/stoneDestroy.',\n            stoneMiss: 'sounds/stoneMiss.'\n        },\n        music: {\n            0: 'sounds/theField_overTheIce.',\n            1: 'sounds/heart.',\n            2: 'sounds/space_ambient2.',\n            started: [],\n            startedAt: [],\n            pausedAt: [],\n            stopped: [],\n            paused: []\n        }\n    };\n    DT.audio.reset = function () {\n        DT.audio.music.startedAt = [];\n        DT.audio.music.pausedAt = [];\n        DT.audio.music.stopped = [];\n        DT.audio.music.paused = [];\n        DT.audio.music.started = [];\n    };\n\n    DT.setVolume = function (volume) {\n        DT.game.param.globalVolume = volume;\n        if (DT.game.param.prevGlobalVolume !== DT.game.param.globalVolume) {\n            DT.gainNodes.forEach(function(el) {\n                if (el) {\n                    el.gain.value = DT.game.param.globalVolume;\n                }\n            });\n            DT.game.param.prevGlobalVolume = DT.game.param.globalVolume;\n        }\n    };\n\n    $(window).on('focus', function() {\n        if (!DT.game.wasMuted) {\n            DT.setVolume(1);\n        }\n    });\n    $(window).on('blur', function() {\n        if (DT.game.wasStarted && !DT.game.wasPaused && !DT.game.wasOver) {\n            $(document).trigger('pauseGame', {});\n        }\n        DT.setVolume(0);\n    });\n    $(document).on('startGame', function (e, data) {\n        DT.stopSound(2);\n        DT.playSound(0);\n    });\n    $(document).on('pauseGame', function () {\n        DT.stopSoundBeforPause();\n        DT.audio.sounds.pause.play();\n    });\n    $(document).on('resumeGame', function (e, data) {\n        DT.playSoundAfterPause();\n        DT.audio.sounds.pause.play();\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.stopSound(0);\n        DT.stopSound(1);\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.audio.sounds.gameover.play();\n    });\n\n        $(function(){\n        // MUSIC\n        var context,\n            counter = 0,\n            buffers = [], sources=[], destination, analysers = [],\n            freqDomain = [];\n        var audio = new Audio();\n        var canPlayOgg = !!audio.canPlayType && audio.canPlayType('audio/ogg; codecs=\\'vorbis\\'') !== '';\n        console.log('canPlayOgg', canPlayOgg);\n        try {\n            window.AudioContext = window.AudioContext || window.webkitAudioContext;\n            context = new AudioContext();\n        }\n        catch(e) {\n            alert('Opps.. Your browser do not support audio API');\n        }\n        DT.stopSound = function(index){\n            if (DT.audio.music.stopped[index] === false) {\n                if (index === 0 || DT.audio.music.paused[index] === false) {\n                    DT.audio.music.pausedAt[index] = Date.now() - DT.audio.music.startedAt[index];\n                } \n                sources[index].stop(index);\n                DT.audio.music.stopped[index] = true;\n                DT.audio.music.started[index] = false;\n            }\n        };\n        DT.gainNodes = [];\n        DT.playSound = function(index){\n            var gainNodes = DT.gainNodes;\n            if (!DT.audio.music.started[index]) {\n                DT.audio.music.started[index] = true;\n                sources[index] = context.createBufferSource();\n                sources[index].loop = true;\n                sources[index].buffer = buffers[index];\n                destination = context.destination;\n                gainNodes[index] = context.createGain();\n                gainNodes[index].gain.value = DT.game.param.globalVolume;\n                analysers[index] = context.createAnalyser();\n                analysers[index].fftSize = 2048;\n                analysers[index].minDecibels = -50;\n                analysers[index].maxDecibels = -20;\n                sources[index].connect(gainNodes[index]);\n                gainNodes[index].connect(analysers[index]);\n                analysers[index].connect(destination);\n                $(document).on('update', function (e, data) {\n                    visualize(index);\n                });\n                DT.audio.music.stopped[index] = false;\n                if (DT.audio.music.pausedAt[index]) {\n                    DT.audio.music.startedAt[index] = Date.now() - DT.audio.music.pausedAt[index];\n                    sources[index].start(index, DT.audio.music.pausedAt[index] / 1000);\n                } else {\n                    DT.audio.music.startedAt[index] = Date.now();\n                    sources[index].start(index);\n                }\n            }\n        };\n        DT.stopSoundBeforPause = function() {\n            DT.audio.music.stopped.forEach(function(el, i) {\n                DT.audio.music.paused[i] = el;\n                DT.stopSound(i);\n            });\n        };\n        DT.playSoundAfterPause = function() {\n            DT.audio.music.paused.forEach(function(el, i) {\n                if (!el) {\n                    DT.playSound(i);\n                }\n            });\n        };\n        var initSound = function(arrayBuffer, bufferIndex) {\n            context.decodeAudioData(arrayBuffer, function(decodedArrayBuffer) {\n                buffers[bufferIndex] = decodedArrayBuffer;\n                console.log('ready sound ' + bufferIndex);\n                counter += 1;\n                yepnope.showLoading(counter);\n            }, function(e) {\n                console.log('Error decoding file', e);\n            });\n        };\n        // SOUNDS\n        var ext = 'ogg';\n        if (!canPlayOgg) {\n            ext = 'mp3';\n        }\n        for (var prop in DT.audio.sounds) if (DT.audio.sounds.hasOwnProperty(prop)) {\n            DT.audio.sounds[prop] = DT.audio.webaudio.createSound().load(DT.audio.sounds[prop] + ext);\n        }\n        var loadSoundFile = function(urlArr, bufferIndex) {\n            var xhr = new XMLHttpRequest();\n            xhr.open('GET', urlArr[bufferIndex] + ext, true);\n            xhr.responseType = 'arraybuffer';\n            xhr.onload = function(e) {\n                initSound(this.response, bufferIndex); // this.response is an ArrayBuffer.\n            };\n            xhr.send();\n        };\n        loadSoundFile(DT.audio.music, 0);\n        loadSoundFile(DT.audio.music, 1);\n        loadSoundFile(DT.audio.music, 2);\n        var visualize = function(index) {\n            freqDomain[index] = new Uint8Array(analysers[index].frequencyBinCount);\n            analysers[index].getByteFrequencyData(freqDomain[index]);\n            DT.audio.valueAudio = getFrequencyValue(DT.audio.frequency[index], index);\n        };\n        var getFrequencyValue = function(frequency, bufferIndex) {\n            var nyquist = context.sampleRate/2,\n                index = Math.round(frequency/nyquist * freqDomain[bufferIndex].length);\n            return freqDomain[bufferIndex][index];\n        };\n        // add update function to webaudio prototype\n        WebAudio.Sound.prototype.update = function() {\n            this.volume(DT.game.param.globalVolume);\n        };\n        WebAudio.Sound.prototype.play = function(time){\n            this.volume(DT.game.param.globalVolume);\n            // handle parameter polymorphism\n            if( time ===  undefined )   time    = 0;\n            // if not yet playable, ignore\n            // - usefull when the sound download isnt yet completed\n            if( this.isPlayable() === false )   return;\n            // clone the bufferSource\n            var clonedNode  = this._chain.cloneBufferSource();\n            // set the noteOn\n            clonedNode.start(time);\n            // create the source object\n            var source  = {\n                node    : clonedNode,\n                stop    : function(time){\n                    if( time ===  undefined )   time    = 0;\n                    this.node.stop(time);\n                    return source;  // for chained API\n                }\n            };\n            // return it\n            return source;\n        };\n    });\n\n// ██╗  ██╗███████╗██╗   ██╗██████╗  ██████╗  █████╗ ██████╗ ██████╗ \n// ██║ ██╔╝██╔════╝╚██╗ ██╔╝██╔══██╗██╔═══██╗██╔══██╗██╔══██╗██╔══██╗\n// █████╔╝ █████╗   ╚████╔╝ ██████╔╝██║   ██║███████║██████╔╝██║  ██║\n// ██╔═██╗ ██╔══╝    ╚██╔╝  ██╔══██╗██║   ██║██╔══██║██╔══██╗██║  ██║\n// ██║  ██╗███████╗   ██║   ██████╔╝╚██████╔╝██║  ██║██║  ██║██████╔╝\n// ╚═╝  ╚═╝╚══════╝   ╚═╝   ╚═════╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝ \n\n    DT.initKeyboardControl = function () {\n        $(document).keydown(function(event) {\n            var k = event.keyCode;\n            // arrows control\n            if (k === 38) {\n                DT.player.changeDestPoint(1, 0);\n            }\n            if (k === 40) {\n                DT.player.changeDestPoint(-1, 0);\n            }\n            if (k === 37) {\n                DT.player.changeDestPoint(0, -1);\n            }\n            if (k === 39) {\n                DT.player.changeDestPoint(0, 1);\n            }\n            // speedUp\n            if (k === 16) { //shift\n                $(document).trigger('stopFun', {});\n                $(document).trigger('changeSpeed', {changer: 36});\n            }\n            if (k === 17) {\n                $(document).trigger('makeFun', {});\n            }\n        });\n        $(document).keyup(function(event) {\n            var k = event.keyCode;\n            if (k === 16) { //shift\n                $(document).trigger('changeSpeed', {changer: 0});\n            }\n        });\n        $(document).keyup(DT.handlers.pauseOnSpace);\n    };\n    \n    $(document).on('startGame', function (e, data) {\n        DT.initKeyboardControl();\n    });\n    $(document).on('gameOver', function (e, data) {\n        $(document).unbind('keyup', DT.handlers.pauseOnSpace);\n        $(document).bind('keyup', DT.handlers.restartOnSpace);\n    });\n\n// ███████╗ ██████╗  ██████╗██╗  ██╗███████╗████████╗\n// ██╔════╝██╔═══██╗██╔════╝██║ ██╔╝██╔════╝╚══██╔══╝\n// ███████╗██║   ██║██║     █████╔╝ █████╗     ██║   \n// ╚════██║██║   ██║██║     ██╔═██╗ ██╔══╝     ██║   \n// ███████║╚██████╔╝╚██████╗██║  ██╗███████╗   ██║   \n// ╚══════╝ ╚═════╝  ╚═════╝╚═╝  ╚═╝╚══════╝   ╚═╝   \n                                                  \n    DT.server = window.location.origin !== 'http://localhost' ? window.location.origin : 'http://192.168.1.36';\n    DT.initSocket = function() {\n        // Game config\n        var leftBreakThreshold = -3,\n            leftTurnThreshold = -20,\n            rightBreakThreshold = 3,\n            rightTurnThreshold = 20,\n            // set socket\n            socket = DT.initSocket.socket = io.connect(DT.server);\n        // When initial welcome message, reply with 'game' device type\n        socket.on('welcome', function(data) {\n            socket.emit('device', {'type':'game', 'cookieUID': DT.getCookie('UID')});\n        });\n        // We receive our game code to show the user\n        socket.on('initialize', function(gameCode) {\n            socket.gameCode = gameCode;\n        });\n        // When the user inputs the code into the phone client,\n        //  we become 'connected'.  Start the game.\n        socket.on('connected', function(data) {\n            $('#gameConnect').hide();\n            $('#status').hide();\n            DT.startAfterChooseControl();\n        });\n            // When the phone is turned, turn the vehicle\n        socket.on('turn', function(turn) {\n            if(turn < leftBreakThreshold) {\n                if(turn > leftTurnThreshold) {\n                    DT.player.destPoint.x = 0;\n                } else {\n                    DT.player.destPoint.x = -DT.game.param.spacing;\n                }\n            } else if (turn > rightBreakThreshold) {\n                if(turn < rightTurnThreshold) {\n                    DT.player.destPoint.x = 0;\n                } else {\n                    DT.player.destPoint.x = DT.game.param.spacing;\n                }\n            } else {\n                DT.player.destPoint.x = 0;\n            }\n        });\n        socket.on('click', function(click) {\n            DT.handlers[click]();\n        });\n    };\n    DT.sendSocketMessage = function (options) {\n        var data = {\n            'type': options.type,\n            'time': options.time,\n            'gameCode': DT.initSocket.socket.gameCode,\n            'sessionid': DT.initSocket.socket.socket.sessionid,\n            'coinsCollect': DT.player.currentScore\n        };\n        if (DT.initSocket.socket) {\n            DT.initSocket.socket.emit('message', data);\n        }\n    };\n\n    $(document).on('startGame', function (e, data) {\n        DT.sendSocketMessage('gamestarted');\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.sendSocketMessage('gameover');\n    });\n\n// ███╗   ███╗ ██████╗ ██████╗ ██╗██╗     ███████╗\n// ████╗ ████║██╔═══██╗██╔══██╗██║██║     ██╔════╝\n// ██╔████╔██║██║   ██║██████╔╝██║██║     █████╗  \n// ██║╚██╔╝██║██║   ██║██╔══██╗██║██║     ██╔══╝  \n// ██║ ╚═╝ ██║╚██████╔╝██████╔╝██║███████╗███████╗\n// ╚═╝     ╚═╝ ╚═════╝ ╚═════╝ ╚═╝╚══════╝╚══════╝\n\n    DT.initPhoneControl = function() {\n        $('.message').html('Please open <span style=\\'color: red\\'>' + DT.server +'/m</span> with your phone and enter code <span style=\\'font-weight:bold; color: red\\' id=\\'socketId\\'></span>');\n        $('#socketId').html(DT.initSocket.socket.gameCode);\n    };\n\n// ██╗    ██╗███████╗██████╗  ██████╗ █████╗ ███╗   ███╗\n// ██║    ██║██╔════╝██╔══██╗██╔════╝██╔══██╗████╗ ████║\n// ██║ █╗ ██║█████╗  ██████╔╝██║     ███████║██╔████╔██║\n// ██║███╗██║██╔══╝  ██╔══██╗██║     ██╔══██║██║╚██╔╝██║\n// ╚███╔███╔╝███████╗██████╔╝╚██████╗██║  ██║██║ ╚═╝ ██║\n // ╚══╝╚══╝ ╚══════╝╚═════╝  ╚═════╝╚═╝  ╚═╝╚═╝     ╚═╝\n    // headtracker realization\n    // DT.enableWebcam = function () {\n        // // Game config\n        // var leftBreakThreshold = -5;\n        // var leftTurnThreshold = -10;\n        // var rightBreakThreshold = 5;\n        // var rightTurnThreshold = 10;\n        // // Получаем элементы video и canvas\n        \n                // var videoInput = document.getElementById('vid');\n        // var canvasInput = document.getElementById('compare');\n        // var debugOverlay = document.getElementById('debug');\n    \n            // var canvasContext = canvasInput.getContext('2d');\n        // // переворачиваем canvas зеркально по горизонтали\n        // canvasContext.translate(canvasInput.width, 0);\n        // canvasContext.scale(-1, 1);\n    \n            // debugOverlay.style.height = '100%';\n        // debugOverlay.style.opacity = '0.1';\n        // debugOverlay.style.zIndex = '0';\n        \n                // // Определяем сообщения, выдаваемые библиотекой\n        \n                // statusMessages = {\n        //     'whitebalance' : 'Проверка камеры или баланса белого',\n        //     'detecting' : 'Обнаружено лицо',\n        //     'hints' : 'Что-то не так, обнаружение затянулось. Попробуйте сместиться относительно камеры',\n        //     'redetecting' : 'Лицо потеряно, поиск..',\n        //     'lost' : 'Лицо потеряно',\n        //     'found' : 'Слежение за лицом'\n        // };\n        \n                // supportMessages = {\n        //     'no getUserMedia' : 'Браузер не поддерживает getUserMedia',\n        //     'no camera' : 'Не обнаружена камера.'\n        // };\n        \n                // document.addEventListener('headtrackrStatus', function(event) {\n        //     if (event.status in supportMessages) {\n        //         console.log(supportMessages[event.status]);\n        //         $('.message').html(supportMessages[event.status])\n        //     } else if (event.status in statusMessages) {\n        //         console.log(statusMessages[event.status]);\n        //         $('.message').html(statusMessages[event.status])\n        //     }\n        //     if (event.status === 'found' && !DT.game.wasStarted) {\n                // DT.startAfterChooseControl();\n        //     }\n        // }, true);\n        \n                // // Установка отслеживания\n        \n                // var htracker = new headtrackr.Tracker({altVideo : {ogv : '', mp4 : ''}, calcAngles : true, ui : false, headPosition : false, debug : debugOverlay});\n        // htracker.init(videoInput, canvasInput);\n        // htracker.start();\n        \n                // // Рисуем прямоугольник вокруг «пойманного» лица\n        \n                // document.addEventListener('facetrackingEvent', function( event ) {\n        //     // once we have stable tracking, draw rectangle\n        //     if (event.detection == 'CS') {\n        //         var angle = Number(event.angle *(180/ Math.PI)-90);\n        //         // console.log(angle);\n        //         if(angle < leftBreakThreshold) {\n        //             if(angle > leftTurnThreshold) {\n        //                 DT.player.destPoint.x = 0;\n        //             } else {\n        //                 DT.player.destPoint.x = -DT.game.param.spacing;\n        //             }\n        //         } else if (angle > rightBreakThreshold) {\n        //             if(angle < rightTurnThreshold) {\n        //                 DT.player.destPoint.x = 0;\n        //             } else {\n        //                 DT.player.destPoint.x = DT.game.param.spacing;\n        //             }\n        //         } else {\n        //             DT.player.destPoint.x = 0;\n        //         }\n        //     }\n        // });\n    // };\n\n // █████╗ ██╗  ████████╗    ██╗    ██╗███████╗██████╗  ██████╗ █████╗ ███╗   ███╗\n// ██╔══██╗██║  ╚══██╔══╝    ██║    ██║██╔════╝██╔══██╗██╔════╝██╔══██╗████╗ ████║\n// ███████║██║     ██║       ██║ █╗ ██║█████╗  ██████╔╝██║     ███████║██╔████╔██║\n// ██╔══██║██║     ██║       ██║███╗██║██╔══╝  ██╔══██╗██║     ██╔══██║██║╚██╔╝██║\n// ██║  ██║███████╗██║       ╚███╔███╔╝███████╗██████╔╝╚██████╗██║  ██║██║ ╚═╝ ██║\n// ╚═╝  ╚═╝╚══════╝╚═╝        ╚══╝╚══╝ ╚══════╝╚═════╝  ╚═════╝╚═╝  ╚═╝╚═╝     ╚═╝\n\n    // virtual button realization\n    DT.enableWebcam = function () {\n        navigator.getUserMedia = navigator.getUserMedia ||\n            navigator.webkitGetUserMedia ||\n            navigator.mozGetUserMedia;\n        window.URL = window.URL || window.webkitURL;\n        \n        var camvideo = document.getElementById('vid');\n\n        if (!navigator.getUserMedia) {\n            $('.message').html('Sorry. <code>navigator.getUserMedia()</code> is not available.');\n        }\n        navigator.getUserMedia({video: true}, gotStream, noStream);\n        \n        function gotStream(stream) {\n            if (window.URL) {\n                camvideo.src = window.URL.createObjectURL(stream);\n            } \n            else { // Opera\n                camvideo.src = stream;\n            }\n            camvideo.onerror = function(e) {\n                stream.stop();\n            };\n            stream.onended = noStream;\n            //start game\n            DT.startAfterChooseControl();\n        }\n        \n        function noStream(e) {\n            var msg = 'No camera available.';\n            if (e.code == 1) \n            {   msg = 'User denied access to use camera.';   }\n            console.log(msg);\n        }\n        \n        // assign global variables to HTML elements\n        console.log(window.innerHeight, window.innerWidth);\n        var video = document.getElementById( 'vid' );\n        var videoCanvas = document.getElementById( 'debug' );\n        var videoContext = videoCanvas.getContext( '2d' );\n        $('#debug').css({\n            'height': window.innerHeight,\n            'width': window.innerWidth,\n            'opacity': 0.2\n        });\n        \n        var blendCanvas  = document.getElementById( 'compare' );\n        var blendContext = blendCanvas.getContext('2d');\n        $('#compare').css({\n            'height': window.innerHeight,\n            'width': window.innerWidth,\n            'opacity': 0.2\n        });\n        \n        $('.cam').css({\n            'background-color': 'rgba(255,255,255,0.2)'\n        });\n        $('.center').css({\n            'background-color': 'rgba(0,0,0,0.2)',\n            'width': '33%',\n            'height': '100%',\n            'margin-left': '33%'\n        });\n        \n        // these changes are permanent\n        videoContext.translate(320, 0);\n        videoContext.scale(-1, 1);\n        \n        // background color if no video present\n        videoContext.fillStyle = '#005337';\n        videoContext.fillRect( 0, 0, videoCanvas.width, videoCanvas.height );\n        \n        var buttons = [];\n        \n        var button1 = new Image();\n        button1.src ='img/lr.png';\n        var buttonData1 = { name:'left', image:button1, x:0, y:0, w:100, h:240, coord: -DT.game.param.spacing };\n        buttons.push( buttonData1 );\n        \n            var button2 = new Image();\n        button2.src ='img/lr.png';\n        var buttonData2 = { name:'right', image:button2, x:220, y:0, w:100, h:240, coord: DT.game.param.spacing };\n        buttons.push( buttonData2 );\n        \n        var button3 = new Image();\n        button3.src ='img/c.png';\n        var buttonData3 = { name:'center', image:button3, x:100, y:0, w:120, h:240, coord: 0 };\n        buttons.push( buttonData3 );\n        \n        // start the loop\n        $(document).on('update', function (e, data) {\n            render();\n            blend();\n            checkAreas();\n        });\n        \n        function render() { \n            if ( video.readyState === video.HAVE_ENOUGH_DATA ) {\n                // mirror video\n                videoContext.drawImage( video, 0, 0, videoCanvas.width, videoCanvas.height );\n            }\n        }\n        var lastImageData;\n        function blend() {\n            var width  = videoCanvas.width;\n            var height = videoCanvas.height;\n            // get current webcam image data\n            var sourceData = videoContext.getImageData(0, 0, width, height);\n            // create an image if the previous image doesn't exist\n            if (!lastImageData) lastImageData = videoContext.getImageData(0, 0, width, height);\n            // create a ImageData instance to receive the blended result\n            var blendedData = videoContext.createImageData(width, height);\n            // blend the 2 images\n            differenceAccuracy(blendedData.data, sourceData.data, lastImageData.data);\n            // draw the result in a canvas\n            blendContext.putImageData(blendedData, 0, 0);\n            // store the current webcam image\n            lastImageData = sourceData;\n        }\n        function differenceAccuracy(target, data1, data2) {\n            if (data1.length != data2.length) return null;\n            var i = 0;\n            while (i < (data1.length * 0.25)) {\n                var average1 = (data1[4*i] + data1[4*i+1] + data1[4*i+2]) / 3;\n                var average2 = (data2[4*i] + data2[4*i+1] + data2[4*i+2]) / 3;\n                var diff = threshold(fastAbs(average1 - average2));\n                target[4*i]   = diff;\n                target[4*i+1] = diff;\n                target[4*i+2] = diff;\n                target[4*i+3] = 0xFF;\n                ++i;\n            }\n        }\n        function fastAbs(value) {\n            return (value ^ (value >> 31)) - (value >> 31);\n        }\n        function threshold(value) {\n            return (value > 0x15) ? 0xFF : 0;\n        }\n        \n            // check if white region from blend overlaps area of interest (e.g. handlers)\n        function checkAreas() {\n            var b, l = buttons.length;\n            for (b = 0; b < l; b++) {\n                // get the pixels in a note area from the blended image\n                // calculate the average lightness of the blended data\n                var blendedData = blendContext.getImageData( buttons[b].x, buttons[b].y, buttons[b].w, buttons[b].h ),\n                    i = 0,\n                    sum = 0,\n                    countPixels = blendedData.data.length * 0.25;\n                while (i < countPixels) {\n                    sum += (blendedData.data[i*4] + blendedData.data[i*4+1] + blendedData.data[i*4+2]);\n                    ++i;\n                }\n                // calculate an average between of the color values of the note area [0-255]\n                var average = Math.round(sum / (3 * countPixels));\n                // more than 20% movement detected\n                if (average > 30) {\n                    console.log( 'Button ' + buttons[b].name + ' triggered.' ); // do stuff\n                    // messageArea.innerHTML = '<font size='+4' color=white>'+ buttons[b].name + '</b></font>';\n                    DT.player.destPoint.x = buttons[b].coord;\n                }\n            }\n        }\n    };\n\n// ██╗     ██╗███████╗████████╗███████╗███╗   ██╗███████╗██████╗ ███████╗\n// ██║     ██║██╔════╝╚══██╔══╝██╔════╝████╗  ██║██╔════╝██╔══██╗██╔════╝\n// ██║     ██║███████╗   ██║   █████╗  ██╔██╗ ██║█████╗  ██████╔╝███████╗\n// ██║     ██║╚════██║   ██║   ██╔══╝  ██║╚██╗██║██╔══╝  ██╔══██╗╚════██║\n// ███████╗██║███████║   ██║   ███████╗██║ ╚████║███████╗██║  ██║███████║\n// ╚══════╝╚═╝╚══════╝   ╚═╝   ╚══════╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚══════╝\n\n    $(document).on('showFun', function (e, data) {\n        if (data.isFun) {\n            $(document).trigger('changeSpeed', {changer: -18});\n            DT.stopSound(0);\n            DT.playSound(1);\n        } else {\n            $(document).trigger('changeSpeed', {changer: 0});\n            DT.stopSound(1);\n            DT.playSound(0);\n        }\n    });\n    $(document).on('resetGame', function (e, data) {\n\n    });\n\n// ██╗  ██╗ █████╗ ███╗   ██╗██████╗ ██╗     ███████╗██████╗ ███████╗\n// ██║  ██║██╔══██╗████╗  ██║██╔══██╗██║     ██╔════╝██╔══██╗██╔════╝\n// ███████║███████║██╔██╗ ██║██║  ██║██║     █████╗  ██████╔╝███████╗\n// ██╔══██║██╔══██║██║╚██╗██║██║  ██║██║     ██╔══╝  ██╔══██╗╚════██║\n// ██║  ██║██║  ██║██║ ╚████║██████╔╝███████╗███████╗██║  ██║███████║\n// ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝╚══════╝\n\n    DT.handlers = {};\n    DT.handlers.startOnSpace = function(event) {\n        var k = event.keyCode;\n        if (k === 32) {\n            DT.startAfterChooseControl();\n        }\n    };\n    DT.handlers.pauseOnSpace = function(event) {\n        var k = event.keyCode;\n        if (k === 32) {\n            DT.handlers.pause();\n        }\n    };\n    DT.handlers.restartOnSpace = function(event) {\n        var k = event.keyCode;\n        if (k === 32) {\n            DT.handlers.restart();\n        }\n    };\n    DT.handlers.fullscreen = function () {\n        var isActivated = THREEx.FullScreen.activated();\n        if (isActivated) {\n            THREEx.FullScreen.cancel();\n        } else {\n            THREEx.FullScreen.request(document.body);\n        }\n    };\n    DT.handlers.pause = function () {\n        if (DT.game.wasPaused) {\n            $(document).trigger('resumeGame', {});\n        } else {\n            $(document).trigger('pauseGame', {});\n        }\n    };\n    DT.handlers.mute = function() {\n        if (DT.game.param.globalVolume === 1) {\n            DT.setVolume(0);\n            $('.music_button').html('N');\n            DT.game.wasMuted = true;\n        } else {\n            DT.setVolume(1);\n            $('.music_button').html('M');\n            DT.game.wasMuted = false;\n        }\n    };\n    DT.handlers.left = function () {\n        DT.player.changeDestPoint(0, -1);\n    };\n    DT.handlers.right = function () {\n        DT.player.changeDestPoint(0, 1);\n    };\n    DT.handlers.restart = function () {\n        DT.game.reset();\n        DT.player.reset();\n        $('.current_coins').html('0');\n        $('.bonus').html('');\n        $('.gameTimer').html('0:00');\n        $('.helth').css({width: '100%'});\n        $('.game_over').hide();\n        $(document).bind('keyup', DT.handlers.pauseOnSpace);\n        $(document).unbind('keyup', DT.handlers.restartOnSpace);\n        $('#one_more_time').unbind('click');\n        DT.audio.reset();\n        $(document).trigger('startGame', {});\n        DT.playSound(0);\n    };\n\n// ██╗███╗   ██╗████████╗███████╗██████╗ ███████╗ █████╗  ██████╗███████╗\n// ██║████╗  ██║╚══██╔══╝██╔════╝██╔══██╗██╔════╝██╔══██╗██╔════╝██╔════╝\n// ██║██╔██╗ ██║   ██║   █████╗  ██████╔╝█████╗  ███████║██║     █████╗  \n// ██║██║╚██╗██║   ██║   ██╔══╝  ██╔══██╗██╔══╝  ██╔══██║██║     ██╔══╝  \n// ██║██║ ╚████║   ██║   ███████╗██║  ██║██║     ██║  ██║╚██████╗███████╗\n// ╚═╝╚═╝  ╚═══╝   ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝  ╚═╝ ╚═════╝╚══════╝\n                                                                      \n    DT.runApp = function () {\n        DT.initSocket();\n        DT.playSound(2);\n        $(function() {\n            $('.loader').fadeOut(250);\n            $('.choose_control').css({'display': 'table', 'opacity': '0'}).animate({'opacity': '1'}, 250);\n            $(document).keyup(DT.handlers.startOnSpace);\n            $('.choose_wasd').click(function() {\n                DT.startAfterChooseControl();\n            });\n            $('.choose_mobile').click(function() {\n                DT.initPhoneControl();\n            });\n            $('.choose_webcam').click(function() {\n                DT.enableWebcam();\n            });\n        });\n    };\n    DT.startAfterChooseControl = function () {\n        if (!DT.game.wasStarted) {\n            $(document).trigger('startGame', {});\n        }\n        $(document).unbind('keyup',DT.handlers.startOnSpace);\n    };\n    DT.hit = function() {\n        $(function(){\n            $('.error').html('ERROR ' + DT.genRandomFloorBetween(500, 511));\n            $('.hit').css({'display': 'table'}).fadeOut(250);\n        });\n    };\n\n    $('.menu_button').click(function() {\n        $(document).trigger('pauseGame', {});\n    });\n    $('.resume').click(function() {\n        $(document).trigger('resumeGame', {});\n    });\n    $('.music_button').click(DT.handlers.mute);\n    $('.fs_button').click(DT.handlers.fullscreen);\n    $(document).keyup(function(event) {\n        var k = event.keyCode;\n        if (k === 77) {\n            DT.handlers.mute();\n        }\n    });\n    $(document).keyup(function(event) {\n        var k = event.keyCode;\n        if (k === 70) {\n            DT.handlers.fullscreen();\n        }\n    });\n\n    $(document).on('startGame', function (e, data) {\n        $('.choose_control').fadeOut(250);\n    });\n    $(document).on('pauseGame', function () {\n        $('.menu_page').css({'display': 'table'});\n    });\n    $(document).on('resumeGame', function (e, data) {\n        $('.menu_page').css({'display': 'none'});\n    });\n    $(document).on('startGame', function (e, data) {\n        $('.gameTimer').css({'display': 'block'});\n    });\n    $(document).on('showScore', function (e, data) {\n        $('.current_coins').text(data.score);\n    });\n    $(document).on('showHelth', function (e, data) {\n        $('.helth').animate({width: data.helth + '%'});\n    });\n    $(document).on('showBonuses', function (e, data) {\n        $('.bonus').text(data.caughtBonuses.join(' '));\n        if (data.caughtBonuses.length === 3) {\n            $('.bonus').fadeOut(300, function(){\n                $('.bonus').text('').fadeIn(100);\n            });\n        }\n    });\n    $(document).on('gameOver', function (e, data) {\n        $('.total_coins').text(DT.player.currentScore);\n        $('.game_over').css({'display': 'table', 'opacity': '0'}).animate({'opacity': '1'}, 1000);\n        $('#one_more_time').click(function () {\n            DT.handlers.restart();\n        });\n    });\n\n// ███████╗████████╗ █████╗ ████████╗███████╗\n// ██╔════╝╚══██╔══╝██╔══██╗╚══██╔══╝██╔════╝\n// ███████╗   ██║   ███████║   ██║   ███████╗\n// ╚════██║   ██║   ██╔══██║   ██║   ╚════██║\n// ███████║   ██║   ██║  ██║   ██║   ███████║\n// ╚══════╝   ╚═╝   ╚═╝  ╚═╝   ╚═╝   ╚══════╝\n\n    DT.setStats = function () {\n        var body = document.getElementsByTagName('body')[0];\n        DT.stats = DT.stats|| new Stats();\n        DT.stats.domElement.style.position = 'absolute';\n        DT.stats.domElement.style.top = '0px';\n        DT.stats.domElement.style.zIndex = 100;\n        body.appendChild( DT.stats.domElement );\n        DT.stats2 = DT.stats2 || new Stats();\n        DT.stats2.setMode(1); // 0: fps, 1: ms\n        DT.stats2.domElement.style.position = 'absolute';\n        DT.stats2.domElement.style.top = '0px';\n        DT.stats2.domElement.style.left = '80px';\n        DT.stats2.domElement.style.zIndex = 100;\n        body.appendChild( DT.stats2.domElement );\n    };\n    $(document).on('startGame', function (e, data) {\n        DT.setStats();\n    });\n    $(document).on('update', function (e, data) {\n        DT.stats.update();\n        DT.stats2.update();\n    });\n\n// ████████╗██╗  ██╗███████╗    ███████╗███╗   ██╗██████╗ \n// ╚══██╔══╝██║  ██║██╔════╝    ██╔════╝████╗  ██║██╔══██╗\n   // ██║   ███████║█████╗      █████╗  ██╔██╗ ██║██║  ██║\n   // ██║   ██╔══██║██╔══╝      ██╔══╝  ██║╚██╗██║██║  ██║\n   // ██║   ██║  ██║███████╗    ███████╗██║ ╚████║██████╔╝\n   // ╚═╝   ╚═╝  ╚═╝╚══════╝    ╚══════╝╚═╝  ╚═══╝╚═════╝ \n\n    return DT;\n} ());"
  ]
}