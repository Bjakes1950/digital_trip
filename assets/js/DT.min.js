/* Created by deemidroll | deemidroll@gmail.com | 2014 */
var Fireworks={};Fireworks.debug=!0,Fireworks.EffectsStackBuilder=function(a){this._emitter=a},Fireworks.EffectsStackBuilder.prototype.emitter=function(){return this._emitter},Fireworks.EffectsStackBuilder.prototype.back=function(){return this._emitter},Fireworks.EffectsStackBuilder.prototype.createEffect=function(a,b){var c=Fireworks.createEffect(a,b).pushTo(this._emitter).back(this);return c.effect().emitter(this._emitter),c},Fireworks.createEffect=function(a,b){"object"==typeof a&&(b=a,a=void 0);var c=new Fireworks.Effect;c.opts=b,c.name=a,c.back=null;var d={onCreate:function(a){return c.onCreate=a,d},onBirth:function(a){return c.onBirth=a,d},onUpdate:function(a){return c.onUpdate=a,d},onDeath:function(a){return c.onDeath=a,d},onPreUpdate:function(a){return c.onPreUpdate=a,d},onPreRender:function(a){return c.onPreRender=a,d},onRender:function(a){return c.onRender=a,d},onPostRender:function(a){return c.onPostRender=a,d},onIntensityChange:function(a){return c.onIntensityChange=a,d},pushTo:function(a){return a.effects().push(c),d},back:function(a){return void 0===a?c.back:(c.back=a,d)},effect:function(){return c}};return d},Fireworks.Effect=function(){this._emitter=null},Fireworks.Effect.prototype.destroy=function(){},Fireworks.Effect.prototype.emitter=function(a){return void 0===a?this._emitter:(this._emitter=a,this)},Fireworks.createEmitter=function(a){return new Fireworks.Emitter(a)},Fireworks.Emitter=function(a){this._nParticles=void 0!==a.nParticles?a.nParticles:100,this._particles=[],this._effects=[],this._started=!1,this._onUpdated=null,this._intensity=0,this._maxDeltaTime=1/3,this._effectsStackBuilder=new Fireworks.EffectsStackBuilder(this)},Fireworks.Emitter.prototype.destroy=function(){this._effects.forEach(function(a){a.destroy()}),this._particles.forEach(function(a){a.destroy()})},Fireworks.Emitter.prototype.effects=function(){return this._effects},Fireworks.Emitter.prototype.effect=function(a){for(var b=0;b<this._effects.length;b++){var c=this._effects[b];if(c.name===a)return c}return null},Fireworks.Emitter.prototype.particles=function(){return this._particles},Fireworks.Emitter.prototype.liveParticles=function(){return this._liveParticles},Fireworks.Emitter.prototype.deadParticles=function(){return this._deadParticles},Fireworks.Emitter.prototype.nParticles=function(){return this._nParticles},Fireworks.Emitter.prototype.effectsStackBuilder=function(){return this._effectsStackBuilder},Fireworks.Emitter.prototype.intensity=function(a){if(void 0===a)return this._intensity;if(a===this._intensity)return this;Fireworks.debug&&console.assert(a>=0,"Fireworks.Emitter.intensity: invalid value.",a),Fireworks.debug&&console.assert(1>=a,"Fireworks.Emitter.intensity: invalid value.",a);var b=this._intensity;return this._intensity=a,this._effects.forEach(function(a){a.onIntensityChange&&a.onIntensityChange(this._intensity,b)}.bind(this)),this},Fireworks.Emitter.prototype.maxDeltaTime=function(a){return void 0===a?this._maxDeltaTime:(this._maxDeltaTime=a,this)},Fireworks.Emitter.prototype.setParticleData=function(a,b,c){a[b]=c},Fireworks.Emitter.prototype.getParticleData=function(a,b){return a[b]},Fireworks.Emitter.prototype.start=function(){console.assert(this._effects.length>0,"At least one effect MUST be set"),console.assert(this._started===!1),this._particles=new Array(this._nParticles);for(var a=0;a<this._nParticles;a++)this._particles[a]=new Fireworks.Particle;return this._liveParticles=[],this._deadParticles=this._particles.slice(0),this._started=!0,this._effects.forEach(function(a){a.onCreate&&this._particles.forEach(function(b,c){a.onCreate(b,c)})}.bind(this)),this.intensity(1),this},Fireworks.Emitter.prototype.update=function(a){return a=Math.min(this._maxDeltaTime,a),this._effects.forEach(function(b){b.onPreUpdate&&b.onPreUpdate(a)}.bind(this)),this._effects.forEach(function(b){b.onUpdate&&this._liveParticles.forEach(function(c){b.onUpdate(c,a)})}.bind(this)),this},Fireworks.Emitter.prototype.render=function(){return this._effects.forEach(function(a){a.onPreRender&&a.onPreRender()}.bind(this)),this._effects.forEach(function(a){a.onRender&&this._liveParticles.forEach(function(b){a.onRender(b)})}.bind(this)),this._effects.forEach(function(a){a.onPostRender&&a.onPostRender()}.bind(this)),this},Fireworks.Emitter.prototype.killParticle=function(a){var b=this._liveParticles.indexOf(a);Fireworks.debug&&console.assert(-1!==b),this._liveParticles.splice(b,1),this._deadParticles.push(a),this.effects().forEach(function(b){b.onDeath&&b.onDeath(a)}.bind(this))},Fireworks.Emitter.prototype.spawnParticle=function(){Fireworks.debug&&console.assert(this._deadParticles.length>=1,"no more particle available");var a=this.deadParticles().pop();this.liveParticles().push(a),this.effects().forEach(function(b){b.onBirth&&b.onBirth(a)}.bind(this))},Fireworks.createLinearGradient=function(a){var b=new Fireworks.LinearGradient(a);return b},Fireworks.LinearGradient=function(){this._keyPoints=[]},Fireworks.LinearGradient.prototype.push=function(a,b){return this._keyPoints.push({x:a,y:b}),this},Fireworks.LinearGradient.prototype.get=function(a){for(var b=0;b<this._keyPoints.length;b++){var c=this._keyPoints[b];if(a<=c.x)break}if(0===b)return this._keyPoints[0].y;Fireworks.debug&&console.assert(b<this._keyPoints.length);var d=this._keyPoints[b-1],e=this._keyPoints[b],f=(a-d.x)/(e.x-d.x),g=d.y+f*(e.y-d.y);return g},Fireworks.Particle=function(){},Fireworks.Particle.prototype.set=function(a,b){return Fireworks.debug&&console.assert(void 0===this[a],"key already defined: "+a),this[a]=b,this[a]},Fireworks.Particle.prototype.get=function(a){return Fireworks.debug&&console.assert(void 0!==this[a],"key undefined: "+a),this[a]},Fireworks.Particle.prototype.has=function(a){return void 0!==this[a]?!0:!1},Fireworks.Shape=function(){},Fireworks.createVector=function(a,b,c){return new Fireworks.Vector(a,b,c)},Fireworks.Vector=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},Fireworks.Vector.prototype={constructor:Fireworks.Vector,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},random:function(){return this.x=Math.random()-.5,this.y=Math.random()-.5,this.z=Math.random()-.5,this},toString:function(){return JSON.stringify(this)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addSelf:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},subSelf:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},multiply:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},multiplySelf:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},divideSelf:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a,this.z/=a):(this.x=0,this.y=0,this.z=0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},cross:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new Fireworks.Vector).sub(this,a).lengthSq()},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new Fireworks.Vector(this.x,this.y,this.z)}},Fireworks.EffectsStackBuilder.prototype.acceleration=function(a){a=a||{};var b=a.effectId||"acceleration";return console.assert(a.shape instanceof Fireworks.Shape),Fireworks.createEffect(b,{shape:a.shape}).onCreate(function(a){a.acceleration={vector:new Fireworks.Vector}}).onBirth(function(a){var b=a.acceleration.vector;this.opts.shape.randomPoint(b)}).onUpdate(function(a,b){var c=a.velocity.vector,d=a.acceleration.vector;c.x+=d.x*b,c.y+=d.y*b,c.z+=d.z*b}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.friction=function(a){return a=void 0!==a?a:1,console.assert(a>=0&&1>=a),Fireworks.createEffect("friction").onCreate(function(b){b.friction={value:a}}).onBirth(function(b){var c=b.friction;c.value=a}).onUpdate(function(a){var b=a.friction.value,c=a.velocity.vector;c.multiplyScalar(b)}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.lifeTime=function(a,b){console.assert(void 0!==a),void 0===b&&(b=a),console.assert(void 0!==b);var c=this._emitter;return Fireworks.createEffect("lifeTime",{minAge:a,maxAge:b}).onCreate(function(a){var b=a.lifeTime={curAge:0,minAge:0,maxAge:0,normalizedAge:function(){return(b.curAge-b.minAge)/(b.maxAge-b.minAge)}}}).onBirth(function(a){var b=a.lifeTime;b.curAge=0,b.maxAge=this.opts.minAge+Math.random()*(this.opts.maxAge-this.opts.minAge)}).onUpdate(function(a,b){var d=a.lifeTime;d.curAge+=b,d.curAge>d.maxAge&&c.killParticle(a)}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.position=function(a){return console.assert(a instanceof Fireworks.Shape),Fireworks.createEffect("position",{shape:a}).onCreate(function(a){a.position={vector:new Fireworks.Vector}}).onBirth(function(a){var b=a.position.vector;this.opts.shape.randomPoint(b)}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.radialVelocity=function(a,b){return Fireworks.createEffect("radialVelocity",{minSpeed:a,maxSpeed:b}).onCreate(function(a){a.velocity={vector:new Fireworks.Vector}}).onBirth(function(a){var b=a.position.vector,c=a.velocity.vector,d=this.opts.minSpeed+(this.opts.maxSpeed-this.opts.minSpeed)*Math.random();c.copy(b).setLength(d)}).onUpdate(function(a,b){var c=a.position.vector,d=a.velocity.vector;c.x+=d.x*b,c.y+=d.y*b,c.z+=d.z*b}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.randomVelocityDrift=function(a){return Fireworks.createEffect("randomVelocityDrift",{drift:a}).onUpdate(function(a,b){var c=a.velocity.vector;c.x+=(2*Math.random()-1)*this.opts.drift.x*b,c.y+=(2*Math.random()-1)*this.opts.drift.y*b,c.z+=(2*Math.random()-1)*this.opts.drift.z*b}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.velocity=function(a,b){return Fireworks.createEffect("velocity",{shape:a,speed:void 0!==b?b:-1}).onCreate(function(a){a.velocity={vector:new Fireworks.Vector}}).onBirth(function(a){var b=a.velocity.vector;this.opts.shape.randomPoint(b),-1!==this.opts.speed&&b.setLength(this.opts.speed)}).onUpdate(function(a,b){var c=a.position.vector,d=a.velocity.vector;c.x+=d.x*b,c.y+=d.y*b,c.z+=d.z*b}).pushTo(this._emitter),this},Fireworks.createShapeBox=function(a,b,c,d,e,f){var g=new Fireworks.Vector(a,b,c),h=new Fireworks.Vector(d,e,f);return new Fireworks.Shape.Box(g,h)},Fireworks.Shape.Box=function(a,b){this.position=a,this.size=b,this._vector=new Fireworks.Vector},Fireworks.Shape.Box.prototype=new Fireworks.Shape,Fireworks.Shape.Box.prototype.constructor=Fireworks.Shape.Box,Fireworks.Shape.Box.prototype.contains=function(a){var b=this._vector.sub(a,this.position);return Math.abs(b.x)>this.size.x/2?!1:Math.abs(b.y)>this.size.y/2?!1:Math.abs(b.z)>this.size.z/2?!1:!0},Fireworks.Shape.Box.prototype.randomPoint=function(a){var b=a||this._vector;return b.x=Math.random()*this.size.x-this.size.x/2,b.y=Math.random()*this.size.y-this.size.y/2,b.z=Math.random()*this.size.z-this.size.z/2,b.addSelf(this.position),b},Fireworks.createShapePoint=function(a,b,c){var d=new Fireworks.Vector(a,b,c);return new Fireworks.Shape.Point(d)},Fireworks.Shape.Point=function(a){this.position=a,this._vector=new Fireworks.Vector},Fireworks.Shape.Point.prototype=new Fireworks.Shape,Fireworks.Shape.Point.prototype.constructor=Fireworks.Shape.Point,Fireworks.Shape.Point.prototype.contains=function(a){return a.x!==this.position.x?!1:a.y!==this.position.y?!1:a.z!==this.position.z?!1:!0},Fireworks.Shape.Point.prototype.randomPoint=function(a){var b=a||this._vector;return b.copy(this.position),b},Fireworks.createShapeSphere=function(a,b,c,d){var e=new Fireworks.Vector(a,b,c);return new Fireworks.ShapeSphere(e,d)},Fireworks.ShapeSphere=function(a,b){this.position=a,this.radius=b,this._vector=new Fireworks.Vector},Fireworks.ShapeSphere.prototype=new Fireworks.Shape,Fireworks.ShapeSphere.prototype.constructor=Fireworks.ShapeSphere,Fireworks.ShapeSphere.prototype.contains=function(a){var b=this._vector.sub(a,this.position).length();return b<=this.radius},Fireworks.ShapeSphere.prototype.randomPoint=function(a){var b=a||this._vector;b.x=Math.random()-.5,b.y=Math.random()-.5,b.z=Math.random()-.5;var c=Math.random()*this.radius;return b.setLength(c),b.addSelf(this.position),b},Fireworks.EffectsStackBuilder.prototype.spawnerOneShot=function(a){a=a||this.emitter().nParticles();var b=this.emitter(),c=0,d=!0;return Fireworks.createEffect("spawner",{reset:function(){c=0},start:function(){d=!0},stop:function(){d=!1}}).onPreUpdate(function(){if(d!==!1&&a!==c){var e=a-c;e=Math.min(e,b.deadParticles().length);for(var f=0;e>f;f++)b.spawnParticle();c+=e}}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.spawnerSteadyRate=function(a){a=void 0!==a?a:1;var b=this.emitter(),c=1,d=!0;return Fireworks.createEffect("spawner",{rate:a,start:function(){d=!0},stop:function(){d=!1}}).onPreUpdate(function(a){var e=this.opts.rate;if(d!==!1){c+=e*a;var f=Math.floor(c);f=Math.min(f,b.deadParticles().length),c-=f;for(var g=0;f>g;g++)b.spawnParticle()}}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.renderToCanvas=function(a){function b(){var a=document.createElement("canvas");a.width=window.innerWidth,a.height=window.innerHeight,document.body.appendChild(a),a.style.position="absolute",a.style.left=0,a.style.top=0;var b=a.getContext("2d");return b}function c(){return f.onCreate(function(a){a.renderToCanvas={size:3}}).onRender(function(a){var b=a.position.vector,c=a.renderToCanvas.size;e.beginPath(),e.arc(b.x+canvas.width/2,b.y+canvas.height/2,c,0,2*Math.PI,!0),e.fill()})}function d(){if("string"==typeof a.image){var b=[new Image];b[0].src=a.image}else if(a.image instanceof Image)var b=[a.image];else if(a.image instanceof Array)var b=a.image;else console.assert(!1,"invalid .renderToCanvas() options");return f.onCreate(function(a){a.renderToCanvas={scale:1,opacity:1,rotation:0*Math.PI}}).onRender(function(a){var c=a.position.vector,d=a.renderToCanvas,f=a.lifeTime.normalizedAge(),g=Math.floor(f*b.length),h=b[g];e.save(),e.translate(c.x+canvas.width/2,c.y+canvas.height/2),e.scale(d.scale,d.scale),e.rotate(d.rotation),e.globalAlpha=d.opacity,h instanceof Image?e.drawImage(h,-h.width/2,-h.height/2):"object"==typeof h?e.drawImage(h.image,h.offsetX,h.offsetY,h.width,h.height,-h.width/2,-h.height/2,h.width,h.height):console.assert(!1),e.restore()})}a=a||{};var e=a.ctx||b(),f=Fireworks.createEffect("renderToCanvas",{ctx:e}).pushTo(this._emitter);return"arc"===a.type?c(f):"drawImage"===a.type?d(f):console.assert(!1,"renderToCanvas opts.type is invalid: "),this},Fireworks.EffectsStackBuilder.prototype.renderToThreejsObject3D=function(a){var b=a.effectId||"renderToThreeParticleSystem",c=a.container;return Fireworks.createEffect(b).onCreate(function(b){b.threejsObject3D={object3d:a.create()},Fireworks.debug&&console.assert(b.threejsObject3D.object3d instanceof THREE.Object3D);b.threejsObject3D.object3d}).onBirth(function(a){var b=a.threejsObject3D.object3d;c.add(b)}).onDeath(function(a){var b=a.threejsObject3D.object3d;c.remove(b)}).onRender(function(a){var b=a.threejsObject3D.object3d,c=a.position.vector;b.position.set(c.x,c.y,c.z)}).pushTo(this._emitter),this},Fireworks.EffectsStackBuilder.prototype.renderToThreejsParticleSystem=function(a){function b(a){for(var b=new THREE.Geometry,d=0;d<a.nParticles();d++)b.vertices.push(new THREE.Vector3);var e=new THREE.ParticleBasicMaterial({size:5,sizeAttenuation:!0,color:14687082,map:c(),blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0}),f=new THREE.ParticleSystem(b,e);return f.dynamic=!0,f.sortParticles=!0,f}function c(a){a=a||128;var b=document.createElement("canvas"),c=b.getContext("2d");b.width=b.height=a;var d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,b.width/2);d.addColorStop(0,"rgba(255,255,255,1)"),d.addColorStop(.5,"rgba(255,255,255,1)"),d.addColorStop(.7,"rgba(128,128,128,1)"),d.addColorStop(1,"rgba(0,0,0,1)"),c.beginPath(),c.arc(a/2,a/2,a/2,0,2*Math.PI,!1),c.closePath(),c.fillStyle=d,c.fill();var e=new THREE.Texture(b);return e.needsUpdate=!0,e}a=a||{};var d=a.effectId||"renderToThreejsParticleSystem",e=a.particleSystem||b;"function"==typeof e&&(e=e(this._emitter)),console.assert(e instanceof THREE.ParticleSystem,"particleSystem MUST be THREE.ParticleSystem");var f=e.geometry;return console.assert(f.vertices.length>=this._emitter.nParticles()),Fireworks.createEffect(d,{particleSystem:e}).onCreate(function(a,b){a.threejsParticle={particleIdx:b};var c=f.vertices[b];c.set(1/0,1/0,1/0)}).onDeath(function(a){var b=a.threejsParticle.particleIdx,c=f.vertices[b];c.set(1/0,1/0,1/0)}).onRender(function(a){var b=a.threejsParticle.particleIdx,c=f.vertices[b],d=a.position.vector;c.set(d.x,d.y,d.z)}).pushTo(this._emitter),this},Fireworks.Emitter.prototype.bindTriggerDomEvents=function(a){new Fireworks.BindTriggerDomEvents(this,a);return this},Fireworks.BindTriggerDomEvents=function(a,b){this._domElement=b||document.body,this._onMouseDown=function(){a.effect("spawner").opts.start()},this._onMouseUp=function(){a.effect("spawner").opts.stop()},this._domElement.addEventListener("mousedown",this._onMouseDown),this._domElement.addEventListener("mouseup",this._onMouseUp),this._onMouseWheel=function(b){var c=a.intensity();c+=b.wheelDelta<0?-.05:.05,c=Math.max(c,0),c=Math.min(c,1),a.intensity(c)},this._domElement.addEventListener("mousewheel",this._onMouseWheel)},Fireworks.BindTriggerDomEvents.prototype.destroy=function(){this._domElement.removeEventListener("mousedown",this._onMouseDown),this._domElement.removeEventListener("mouseup",this._onMouseUp),this._domElement.removeEventListener("mousewheel",this._onMouseWheel)},Fireworks.DatGui4Emitter=function(a){var b=new dat.GUI,c=a.effects();return c.forEach(function(a,c){var d=a.name||"effect-"+c,e=a.opts||{},f=Object.keys(e).filter(function(a){return e[a]instanceof Fireworks.Vector?!0:"object"==typeof e[a]?!1:!0});if(f.length){var g=b.addFolder("Effect: "+d);f.forEach(function(a){e[a]instanceof Fireworks.Vector?(g.add(e[a],"x").name(a+"X"),g.add(e[a],"y").name(a+"Y"),g.add(e[a],"z").name(a+"Z")):g.add(e,a)})}}),b},Fireworks.ProceduralTextures={},Fireworks.ProceduralTextures.buildTexture=function(a){a=a||150;var b=document.createElement("canvas"),c=b.getContext("2d");b.width=b.height=a;var d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,b.width/2);d.addColorStop(0,"rgba(255,255,255,1)"),d.addColorStop(.5,"rgba(255,255,255,1)"),d.addColorStop(.7,"rgba(128,128,128,1)"),d.addColorStop(1,"rgba(0,0,0,1)"),c.beginPath(),c.arc(a/2,a/2,a/2,0,2*Math.PI,!1),c.closePath(),c.fillStyle=d,c.fill();var e=new THREE.Texture(b);return e.needsUpdate=!0,e};var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}},THREEx=THREEx||{};THREEx.WindowResize=function(a,b){var c=function(){a.setSize(window.innerWidth,window.innerHeight),b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix()};return window.addEventListener("resize",c,!1),{trigger:function(){c()},destroy:function(){window.removeEventListener("resize",c)}}};var Stats=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}},THREEx=THREEx||{};THREEx.RendererStats=function(){var a=document.createElement("div");a.style.cssText="width:80px;opacity:0.9;cursor:pointer";var b=document.createElement("div");b.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;",a.appendChild(b);var c=document.createElement("div");c.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",c.innerHTML="WebGLRenderer",b.appendChild(c);for(var d=[],e=9,f=0;e>f;f++)d[f]=document.createElement("div"),d[f].style.cssText="color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",b.appendChild(d[f]),d[f].innerHTML="-";var g=Date.now();return{domElement:a,update:function(a){if(console.assert(a instanceof THREE.WebGLRenderer),!(Date.now()-g<1e3/30)){g=Date.now();var b=0;d[b++].textContent="== Memory =====",d[b++].textContent="Programs: "+a.info.memory.programs,d[b++].textContent="Geometries: "+a.info.memory.geometries,d[b++].textContent="Textures: "+a.info.memory.textures,d[b++].textContent="== Render =====",d[b++].textContent="Calls: "+a.info.render.calls,d[b++].textContent="Vertices: "+a.info.render.vertices,d[b++].textContent="Faces: "+a.info.render.faces,d[b++].textContent="Points: "+a.info.render.points}}}},window.AudioContext=window.AudioContext||window.webkitAudioContext,WebAudio=function(){if(WebAudio.isAvailable===!1)throw this._addRequiredMessage(),new Error("WebAudio API is required and not available.");this._ctx=new AudioContext,this._muted=!1,this._volume=1,this._gainNode=this._ctx.createGain(),this._compressor=this._ctx.createDynamicsCompressor(),this._gainNode.connect(this._compressor),this._compressor.connect(this._ctx.destination),this._pageVisibilityCtor()},WebAudio.fn=WebAudio.prototype,WebAudio.prototype.destroy=function(){this._pageVisibilityDtor()},WebAudio.isAvailable=window.AudioContext?!0:!1,WebAudio.prototype._addRequiredMessage=function(a){a=a||document.body;var b=document.createElement("div");b.style.fontFamily="monospace",b.style.fontSize="13px",b.style.textAlign="center",b.style.background="#eee",b.style.color="#000",b.style.padding="1em",b.style.width="475px",b.style.margin="5em auto 0",b.innerHTML=['Your browser does not seem to support <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">WebAudio API</a>.<br />','Try with <a href="https://www.google.com/intl/en/chrome/browser/">Chrome Browser</a>.'].join("\n"),a.appendChild(b)},WebAudio.prototype.context=function(){return this._ctx},WebAudio.prototype.createSound=function(){var a=this,b=new WebAudio.Sound(a);return b},WebAudio.prototype._entryNode=function(){return this._gainNode},WebAudio.prototype.volume=function(a){return void 0===a?this._volume:(this._volume=a,this._muted===!1&&(this._gainNode.gain.value=this._volume),this)},WebAudio.prototype.mute=function(a){return void 0===a?this._muted:(this._muted=a,this._gainNode.gain.value=this._muted?0:this._volume,this)},WebAudio.prototype.toggleMute=function(){this.mute(this.mute()?!1:!0)},WebAudio.prototype._pageVisibilityCtor=function(){this._pageVisibilityEventStr=void 0!==document.hidden?"visibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.webkitHidden?"webkitvisibilitychange":console.assert(!1,"Page Visibility API unsupported"),this._pageVisibilityDocumentStr=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":console.assert(!1,"Page Visibility API unsupported"),this._$pageVisibilityCallback=function(){var a=document[this._pageVisibilityDocumentStr]?!0:!1;this.mute(a?!0:!1)}.bind(this),document.addEventListener(this._pageVisibilityEventStr,this._$pageVisibilityCallback,!1)},WebAudio.prototype._pageVisibilityDtor=function(){document.removeEventListener(this._pageVisibilityEventStr,this._$pageVisibilityCallback,!1)},WebAudio.NodeChainBuilder=function(a){console.assert(a instanceof AudioContext),this._context=a,this._firstNode=null,this._lastNode=null,this._nodes={}},WebAudio.NodeChainBuilder.create=function(a){return new WebAudio.NodeChainBuilder(a)},WebAudio.NodeChainBuilder.prototype.destroy=function(){},WebAudio.NodeChainBuilder.prototype.nodes=function(){return this._nodes},WebAudio.NodeChainBuilder.prototype.first=function(){return this._firstNode},WebAudio.NodeChainBuilder.prototype.last=function(){return this._lastNode},WebAudio.NodeChainBuilder.prototype._addNode=function(a,b){var c=this._lastNode&&"playbackRate"in this._lastNode?!0:!1;c&&(this._bufferSourceDst=a),null!==this._lastNode&&this._lastNode.connect(a),null===this._firstNode&&(this._firstNode=a),this._lastNode=a;for(var d in b)a[d]=b[d];return this},WebAudio.NodeChainBuilder.prototype.cloneBufferSource=function(){console.assert(this._nodes.bufferSource,"no buffersource presents. Add one.");var a=this._nodes.bufferSource,b=this._context.createBufferSource();return b.buffer=a.buffer,b.playbackRate=a.playbackRate,b.loop=a.loop,b.connect(this._bufferSourceDst),b},WebAudio.NodeChainBuilder.prototype.bufferSource=function(a){var b=this._context.createBufferSource();return this._nodes.bufferSource=b,this._addNode(b,a)},WebAudio.NodeChainBuilder.prototype.mediaStreamSource=function(a,b){var c=this._context.createMediaStreamSource(a);return this._nodes.bufferSource=c,this._addNode(c,b)},WebAudio.NodeChainBuilder.prototype.mediaElementSource=function(a,b){console.assert(a instanceof HTMLAudioElement||a instanceof HTMLVideoElement);var c=this._context.createMediaElementSource(a);return this._nodes.bufferSource=c,this._addNode(c,b)},WebAudio.NodeChainBuilder.prototype.panner=function(a){var b=this._context.createPanner();return this._nodes.panner=b,this._addNode(b,a)},WebAudio.NodeChainBuilder.prototype.analyser=function(a){var b=this._context.createAnalyser();return this._nodes.analyser=b,this._addNode(b,a)},WebAudio.NodeChainBuilder.prototype.gainNode=function(a){var b=this._context.createGain();return this._nodes.gainNode=b,this._addNode(b,a)},WebAudio.Sound=function(a,b){this._webaudio=a,this._context=this._webaudio.context(),console.assert(this._webaudio instanceof WebAudio),void 0===b&&(b=new WebAudio.NodeChainBuilder(this._context).bufferSource().gainNode().analyser().panner()),console.assert(b instanceof WebAudio.NodeChainBuilder),this._chain=b,this._chain.last().connect(this._webaudio._entryNode()),this._source=this._chain.nodes().bufferSource,this._gainNode=this._chain.nodes().gainNode,this._analyser=this._chain.nodes().analyser,this._panner=this._chain.nodes().panner,console.assert(this._source,"no bufferSource: not yet supported"),console.assert(this._gainNode,"no gainNode: not yet supported"),console.assert(this._analyser,"no analyser: not yet supported"),console.assert(this._panner,"no panner: not yet supported")},WebAudio.Sound.create=function(a,b){return new WebAudio.Sound(a,b)},WebAudio.Sound.prototype.destroy=function(){this._chain.last().disconnect(),this._chain.destroy(),this._chain=null},WebAudio.Sound.fn=WebAudio.Sound.prototype,WebAudio.Sound.prototype.nodes=function(){return this._chain.nodes()},WebAudio.Sound.prototype.isPlayable=function(){return this._source.buffer?!0:!1},WebAudio.Sound.prototype.play=function(a){if(void 0===a&&(a=0),this.isPlayable()!==!1){var b=this._chain.cloneBufferSource();b.start(a);var c={node:b,stop:function(a){return void 0===a&&(a=0),this.node.stop(a),c}};return c}},WebAudio.Sound.prototype.volume=function(a){return void 0===a?this._gainNode.gain.value:(this._gainNode.gain.value=a,this)},WebAudio.Sound.prototype.loop=function(a){return void 0===a?this._source.loop:(this._source.loop=a,this)},WebAudio.Sound.prototype.buffer=function(a){return void 0===a?this._source.buffer:(this._source.buffer=a,this)},WebAudio.Sound.prototype.pannerCone=function(a,b,c){return this._panner.coneInnerAngle=180*a/Math.PI,this._panner.coneOuterAngle=180*b/Math.PI,this._panner.coneOuterGain=c,this},WebAudio.Sound.prototype.pannerConeInnerAngle=function(a){return void 0===a?this._panner.coneInnerAngle/180*Math.PI:(this._panner.coneInnerAngle=180*a/Math.PI,this)},WebAudio.Sound.prototype.pannerConeOuterAngle=function(a){return void 0===a?this._panner.coneOuterAngle/180*Math.PI:(this._panner.coneOuterAngle=180*a/Math.PI,this)},WebAudio.Sound.prototype.pannerConeOuterGain=function(a){return void 0===a?this._panner.coneOuterGain:(this._panner.coneOuterGain=a,this)
},WebAudio.Sound.prototype.amplitude=function(a){a=void 0!==a?a:2;var b=this._analyser,c=new Uint8Array(b.frequencyBinCount);b.getByteFrequencyData(c);for(var d=0,e=0;a>e;e++)d+=c[e];var f=d/(256*a-1);return f},WebAudio.Sound.prototype.tone=function(a,b){a=void 0!==a?a:200,b=void 0!==b?b:1;for(var c=1,d=44100,e=2,f=this._webaudio.context().createBuffer(c,b*d,d),g=f.getChannelData(0),h=0;h<g.length;h++){var i=h/f.sampleRate,j=a*i*Math.PI;g[h]=Math.sin(j)*e}return this.buffer(f),this},WebAudio.Sound.prototype.makeHistogram=function(a){var b=this._analyser;this._privHisto=this._privHisto||new Uint8Array(b.frequencyBinCount);var c=this._privHisto;b.getByteFrequencyData(c);var d=function(a,b){for(var c=Math.floor(a.length/b),d=(Math.floor(a.length/c),[]),e=0,f=0;e<a.length;f++){for(var g=0,h=0;c>h;h++,e++)g+=a[e];var i=g/c;d[f]=i}return d},e=d(c,a);return e},WebAudio.Sound.prototype.load=function(a,b,c){return c=c||function(){console.warn("unable to load sound "+a)},this._loadAndDecodeSound(a,function(a){this._source.buffer=a,b&&b(this)}.bind(this),function(){c&&c(this)}.bind(this)),this},WebAudio.Sound.prototype._loadAndDecodeSound=function(a,b,c){var d=this._context,e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType="arraybuffer",e.onload=function(){d.decodeAudioData(e.response,function(a){b&&b(a)},function(){c&&c()})},e.send()},WebAudio.Flow=function(){var a,b=[],c=setTimeout(function(){c=null,a._next()},0);return a={destroy:function(){c&&clearTimeout(c)},par:function(c,d){return!d&&b[b.length-1]instanceof Array||b.push([]),b[b.length-1].push(c),a},seq:function(b){return a.par(b,!0)},_next:function(c,d){for(var e=[],f=[],g=b.shift()||[],h=g.length,i=1==h,j=0;j<g.length;j++)!function(b,g){b(function(b,c){e[g]=b,f[g]=c,0==--h&&a._next(i?e[0]:e,i?f[0]:f)},c,d)}(g[j],j)}}};var THREEx=THREEx||{};THREEx.FullScreen=THREEx.FullScreen||{},THREEx.FullScreen.available=function(){return this._hasWebkitFullScreen||this._hasMozFullScreen},THREEx.FullScreen.activated=function(){return this._hasWebkitFullScreen?document.webkitIsFullScreen:this._hasMozFullScreen?document.mozFullScreen:void console.assert(!1)},THREEx.FullScreen.request=function(a){a=a||document.body,this._hasWebkitFullScreen?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this._hasMozFullScreen?a.mozRequestFullScreen():console.assert(!1)},THREEx.FullScreen.cancel=function(){this._hasWebkitFullScreen?document.webkitCancelFullScreen():this._hasMozFullScreen?document.mozCancelFullScreen():console.assert(!1)},THREEx.FullScreen._hasWebkitFullScreen="webkitCancelFullScreen"in document?!0:!1,THREEx.FullScreen._hasMozFullScreen="mozCancelFullScreen"in document?!0:!1,THREEx.FullScreen.bindKey=function(a){a=a||{};var b=a.charCode||"f".charCodeAt(0),c=void 0!==a.dblclick?a.dblclick:!1,d=a.element,e=function(){THREEx.FullScreen.activated()?THREEx.FullScreen.cancel():THREEx.FullScreen.request(d)},f=function(a,b){return function(){return a.apply(b,arguments)}},g=f(function(a){a.which===b&&e()},this);return document.addEventListener("keypress",g,!1),c&&document.addEventListener("dblclick",e,!1),{unbind:function(){document.removeEventListener("keypress",g,!1),c&&document.removeEventListener("dblclick",e,!1)}}},THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.DotScreenShader={uniforms:{tDiffuse:{type:"t",value:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},THREE.RGBShiftShader={uniforms:{tDiffuse:{type:"t",value:null},amount:{type:"f",value:.005},angle:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},THREE.EffectComposer=function(a,b){if(this.renderer=a,void 0===b){var c=window.innerWidth||1,d=window.innerHeight||1,e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};b=new THREE.WebGLRenderTarget(c,d,e)}this.renderTarget1=b,this.renderTarget2=b.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},THREE.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},addPass:function(a){this.passes.push(a)},insertPass:function(a,b){this.passes.splice(b,0,a)},render:function(a){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var b,c,d=!1,e=this.passes.length;for(c=0;e>c;c++)if(b=this.passes[c],b.enabled){if(b.render(this.renderer,this.writeBuffer,this.readBuffer,a,d),b.needsSwap){if(d){var f=this.renderer.context;f.stencilFunc(f.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a),f.stencilFunc(f.EQUAL,1,4294967295)}this.swapBuffers()}b instanceof THREE.MaskPass?d=!0:b instanceof THREE.ClearMaskPass&&(d=!1)}},reset:function(a){void 0===a&&(a=this.renderTarget1.clone(),a.width=window.innerWidth,a.height=window.innerHeight),this.renderTarget1=a,this.renderTarget2=a.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(a,b){var c=this.renderTarget1.clone();c.width=a,c.height=b,this.reset(c)}},THREE.RenderPass=function(a,b,c,d,e){this.scene=a,this.camera=b,this.overrideMaterial=c,this.clearColor=d,this.clearAlpha=void 0!==e?e:1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(a,b,c){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(a.getClearColor()),this.oldClearAlpha=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha)),a.render(this.scene,this.camera,c,this.clear),this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}},THREE.MaskPass=function(a,b){this.scene=a,this.camera=b,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype={render:function(a,b,c){var d=a.context;d.colorMask(!1,!1,!1,!1),d.depthMask(!1);var e,f;this.inverse?(e=0,f=1):(e=1,f=0),d.enable(d.STENCIL_TEST),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),d.stencilFunc(d.ALWAYS,e,4294967295),d.clearStencil(f),a.render(this.scene,this.camera,c,this.clear),a.render(this.scene,this.camera,b,this.clear),d.colorMask(!0,!0,!0,!0),d.depthMask(!0),d.stencilFunc(d.EQUAL,1,4294967295),d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}},THREE.ClearMaskPass=function(){this.enabled=!0},THREE.ClearMaskPass.prototype={render:function(a){var b=a.context;b.disable(b.STENCIL_TEST)}},THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),this.scene.add(this.quad)},THREE.ShaderPass.prototype={render:function(a,b,c){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c),this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}},THREE.BadTVShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},distortion:{type:"f",value:3},distortion2:{type:"f",value:5},speed:{type:"f",value:.2},rollSpeed:{type:"f",value:.1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float time;","uniform float distortion;","uniform float distortion2;","uniform float speed;","uniform float rollSpeed;","varying vec2 vUv;","vec3 mod289(vec3 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","  return mod289(((x*34.0)+1.0)*x);","}","float snoise(vec2 v)","  {","  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","                     -0.577350269189626,  // -1.0 + 2.0 * C.x","                      0.024390243902439); // 1.0 / 41.0","  vec2 i  = floor(v + dot(v, C.yy) );","  vec2 x0 = v -   i + dot(i, C.xx);","  vec2 i1;","  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","  vec4 x12 = x0.xyxy + C.xxzz;"," x12.xy -= i1;","  i = mod289(i); // Avoid truncation effects in permutation","  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","		+ i.x + vec3(0.0, i1.x, 1.0 ));","  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","  m = m*m ;","  m = m*m ;","  vec3 x = 2.0 * fract(p * C.www) - 1.0;","  vec3 h = abs(x) - 0.5;","  vec3 ox = floor(x + 0.5);","  vec3 a0 = x - ox;","  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","  vec3 g;","  g.x  = a0.x  * x0.x  + h.x  * x0.y;","  g.yz = a0.yz * x12.xz + h.yz * x12.yw;","  return 130.0 * dot(m, g);","}","void main() {","vec2 p = vUv;","float ty = time*speed;","float yt = p.y - ty;","float offset = snoise(vec2(yt*3.0,0.0))*0.2;","offset = pow( offset*distortion,3.0)/distortion;","offset += snoise(vec2(yt*50.0,0.0))*distortion2*0.001;","gl_FragColor = texture2D(tDiffuse,  vec2(fract(p.x + offset),fract(p.y-time*rollSpeed) ));","}"].join("\n")};var DT=function(){"use strict";var a={},b=window.THREE,c=window.WebAudio,d=window.$,e=window.THREEx,f=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),g=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){window.clearTimeout(a)}}();a.$document=d(document),a.$window=d(window),a.getCookie=function(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):void 0},a.getDistance=function(a,b,c,d,e,f){return Math.sqrt((a-d)*(a-d)+(b-e)*(b-e)+(c-f)*(c-f))},a.genCoord=function(b){var c=b||a.game.param.spacing,d=Math.random()*c*2-c,e=Math.abs(d);return c>=e&&e>=.33*c?d>0?c:0>d?-1*c:void 0:0},a.genRandomFloorBetween=function(a,b){var c=a-.5+Math.random()*(b-a+1);return c=Math.round(c)},a.genRandomBetween=function(a,b){return Math.random()*(b-a)+a},a.genRandomSign=function(){var a=Math.random()-.5;return Math.abs(a)/a},a.normalizeT=function(a){return a%=1},a.getBinormalAt=function(c,d){d=d||a.tube;var e=new b.Vector3,f=d.tangents.length,g=c*f,h=Math.floor(g),i=(h+1)%f;return d=d||a.tube,e.subVectors(d.binormals[i],d.binormals[h]),e.multiplyScalar(g-h).add(d.binormals[h]),e},a.animate=function(b){b=b||Date.now(),a.animate.lastTimeMsec=a.animate.lastTimeMsec||b-1e3/60;var c=Math.min(100,b-a.animate.lastTimeMsec);a.animate.id=f(a.animate),a.animate.lastTimeMsec=b,a.animate.timeElapsed=a.animate.timeElapsed||0,a.animate.timeElapsed+=c,a.$document.trigger("updatePath",{delta:c/1e3,now:b/1e3,timeElapsed:a.animate.timeElapsed/1e3})},a.$document.on("startGame",function(){a.animate.id=f(a.animate)}),a.$document.on("resetGame",function(){a.animate.id=f(a.animate)}),a.$document.on("pauseGame",function(){g(a.animate.id)}),a.$document.on("resumeGame",function(){a.animate.id=f(a.animate)}),a.$document.on("gameOver",function(){setTimeout(function(){g(a.animate.id)},300)}),a.renderer=new b.WebGLRenderer({antialiasing:!0}),a.renderer.setSize(window.innerWidth,window.innerHeight),a.renderer.physicallyBasedShading=!0,document.body.appendChild(a.renderer.domElement),a.camera=new b.PerspectiveCamera(55,window.innerWidth/window.innerHeight,1,1e3),a.camera.position.set(0,.5,200),new e.WindowResize(a.renderer,a.camera),a.scene=new b.Scene;var h=new b.Object3D;a.scene.add(h),a.scale=3,a.splineCamera=new b.PerspectiveCamera(84,window.innerWidth/window.innerHeight,.01,1e3),h.add(a.splineCamera);var i=new b.Curves.TorusKnot,j=new b.TubeGeometry(i,500,3,16,!0,!0);a.tube=j;var k=b.SceneUtils.createMultiMaterialObject(j,[new b.MeshLambertMaterial({opacity:0,transparent:!0}),new b.MeshBasicMaterial({opacity:0,transparent:!0})]);h.add(k),k.scale.set(a.scale,a.scale,a.scale);var l=new b.Vector3,m=new b.Vector3,n=0;a.cam=0,a.$document.on("updatePath",function(b,c){var d=c.timeElapsed,e=30,f=d%e/e,g=j.path.getPointAt(f);g.multiplyScalar(a.scale);var i=j.tangents.length,k=f*i,o=Math.floor(k),p=(o+1)%i;l.subVectors(j.binormals[p],j.binormals[o]),l.multiplyScalar(k-o).add(j.binormals[o]);var q=j.path.getTangentAt(f);m.copy(l).cross(q),a.splineCamera.position=g;var r=j.path.getPointAt((f+30/j.path.getLength())%1).multiplyScalar(a.scale);r.copy(g).add(q),a.splineCamera.matrix.lookAt(a.splineCamera.position,r,m),a.splineCamera.rotation.setFromRotationMatrix(a.splineCamera.matrix,a.splineCamera.rotation.order),h.rotation.y+=.05*(n-h.rotation.y),c.tube=j,c.t=f,c.normal=m,c.binormal=l,a.$document.trigger("update",c)}),a.$document.on("keyup",function(b){67==b.which&&(a.cam=a.cam>0?0:a.cam+1)}),a.lights={light:new b.PointLight(16777215,.75,100),directionalLight:new b.DirectionalLight(16777215,.25)},a.scene.add(a.lights.light),a.scene.add(a.lights.directionalLight),a.$document.on("update",function(b,c){var d=c.tube.path.getPointAt(c.t-.005);d.multiplyScalar(a.scale),a.lights.light.position=d;var e=c.tube.path.getPointAt(c.t+.006);e.multiplyScalar(a.scale),a.lights.directionalLight.position=e});var o=40,p=500,q=Math.PI/2;a.backgroundMesh=new b.Mesh(new b.PlaneGeometry(44*o/5,22*o/5,0),new b.MeshBasicMaterial({map:b.ImageUtils.loadTexture("img/bg3.jpg")})),a.backgroundMesh.position.set(p,0,0),a.backgroundMesh.rotation.set(0,-q,q),a.scene.add(a.backgroundMesh),a.backgroundMesh1=new b.Mesh(new b.PlaneGeometry(1366,768,0),new b.MeshBasicMaterial({map:b.ImageUtils.loadTexture("img/bg1.jpg")})),a.backgroundMesh1.position.set(-100,0,0),a.backgroundMesh1.rotation.set(0,q,q),a.scene.add(a.backgroundMesh1),a.effectComposer=new b.EffectComposer(a.renderer),a.effectComposer.addPass(new b.RenderPass(a.scene,a.splineCamera)),a.effectComposer.on=!1;var r={mute:!0,show:!0,distortion:3,distortion2:1,speed:.3,rollSpeed:.1},s=new b.ShaderPass(b.BadTVShader);s.on=!1,s.uniforms.distortion.value=r.distortion,s.uniforms.distortion2.value=r.distortion2,s.uniforms.speed.value=r.speed,s.uniforms.rollSpeed.value=r.rollSpeed,s.renderToScreen=!0,a.effectComposer.addPass(s),a.$document.on("update",function(){0===a.cam&&a.renderer.render(a.scene,a.splineCamera),1===a.cam&&a.renderer.render(a.scene,a.camera),a.effectComposer.on&&a.effectComposer.render()}),a.$document.on("bump",function(){a.effectComposer.on=!0,a.effectComposer.timeOut=setTimeout(function(){a.effectComposer.on=!1},1e3)}),b.IcosahedronGeometry=function(a,c){this.radius=a,this.detail=c;var d=(1+Math.sqrt(5))/2,e=[[-1,d,0],[1,d,0],[-1,-d,0],[1,-d,0],[0,-1,d],[0,1,d],[0,-1,-d],[0,1,-d],[d,0,-1],[d,0,1],[-d,0,-1],[-d,0,1]];e=e.map(function(a){return a.map(function(a){return a*Math.random()})});var f=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];b.PolyhedronGeometry.call(this,e,f,a,c)},b.IcosahedronGeometry.prototype=Object.create(b.Geometry.prototype),a.listOfModels=[{name:"bonusH",scale:{x:.02,y:.02,z:.02},rotation:{x:Math.PI/1.3,y:-Math.PI/1.3,z:-Math.PI/1.3}},{name:"bonusI",scale:{x:.5,y:.5,z:.5},rotation:{x:Math.PI/1.3,y:-Math.PI/1.3,z:-Math.PI/1.3}},{name:"bonusE",scale:{x:.025,y:.025,z:.025},rotation:{x:0,y:0,z:0}}];var t,u=new b.JSONLoader(!0);t=function(a){return u.load("js/models/"+a.name+".js",function(c,d){"bonusE"===a.name?(a.material=new b.MeshLambertMaterial({color:6316128,morphTargets:!0}),a.material.emissive.copy(a.material.color),a.material.emissive.multiplyScalar(.5)):(a.material=new b.MeshFaceMaterial(d),a.material.materials.forEach(function(a){a.emissive.copy(a.color),a.emissive.multiplyScalar(.5)})),a.geometry=c}),a},a.listOfModels.map(t),a.events={startGame:"custom",pauseGame:"custom",resumeGame:"custom",gameOver:"custom",resetGame:"custom",update:"custom",updatePath:"custom",changeSpeed:"custom",makeFun:"custom",stopFun:"custom",showFun:"custom",makeInvulner:"custom",stopInvulner:"custom",showInvulner:"custom",changeHelth:"custom",showHelth:"custom",changeScore:"custom",showScore:"custom",catchBonus:"custom",blink:"custom",bump:"custom",focus:"native",blur:"native"},a.Game=function(){this.param={spacing:3,spawnCoord:-200,opacityCoord:2,dieCoord:30,stonesCloseness:30,globalVolume:1,prevGlobalVolume:1},this.speed={value:36,changer:0,step:.6,increase:function(){this.value+=this.step/60},setChanger:function(a){this.changer=a},getChanger:function(){return this.changer},getValue:function(){return(this.value+this.changer)/60}},this.wasStarted=!1,this.wasPaused=!1,this.wasOver=!1,this.wasMuted=!1,this.timer=0},a.Game.prototype.startGame=function(){this.wasStarted=!0},a.Game.prototype.updateTimer=function(){if(this.timer+=1,this.timer%60===0){var a,b;a=this.timer/60,b=Math.floor(a/60),a%=60,a=10>a?"0"+a.toString():a,d(".gameTimer").html(b+":"+a),d("title").html(b+":"+a+" in digital trip")}},a.Game.prototype.update=function(){this.updateTimer(),this.speed.increase()},a.Game.prototype.reset=function(){this.timer=0,this.speed.value=36,this.wasOver=!1},a.Game.prototype.gameOver=function(){this.wasOver=!0},a.game=new a.Game,a.$document.on("startGame",function(){a.game.startGame()}),a.$document.on("pauseGame",function(){a.game.wasPaused=!0}),a.$document.on("resumeGame",function(){a.game.wasPaused=!1,a.game.startGame()}),a.$document.on("update",function(){a.game.update()}),a.$document.on("changeSpeed",function(b,c){a.game.speed.setChanger(c.changer)}),a.$document.on("gameOver",function(){a.game.gameOver()}),a.$document.on("resetGame",function(){a.game.reset(),a.game.startGame()}),a.Player=function(c){if(a.Player.__instance)return a.Player.__instance;a.Player.__instance=this;var d=this;this.scene=c.scene||a.scene,this.currentHelth=c.currentHelth||100,this.currentScore=c.currentScore||0,this.position=new b.Vector3,this.destPoint=c.destPoint||new b.Vector3(0,0,0),this.isInvulnerability=c.isInvulnerability||!1,this.isFun=c.isFun||!1,this.invulnerTimer=null,this.funTimer=null,this.sphere=new b.Mesh(new b.SphereGeometry(.5,32,32),new b.MeshPhongMaterial({color:16711680})),this.sphere.position=this.position,this.light=new b.PointLight(16711680,1.75,15),this.light.position=this.position,this.light.color=this.sphere.material.color,this.scene.add(this.light),this.scene.add(this.sphere),this.firstMove=!0,this.moveIterator=0,this.blink={defColor:new b.Color("red"),color:new b.Color("white"),bColor:new b.Color(0,0,0),frames:0,framesLeft:0,doBlink:function(a,c){var d=new b.Color(a).multiplyScalar(-1);this.color=new b.Color(a),this.framesLeft=this.frames=c,this.bColor.addColors(this.defColor,d).multiplyScalar(1/c)}},this.emitter=Fireworks.createEmitter({nParticles:10}).effectsStackBuilder().spawnerSteadyRate(25).position(Fireworks.createShapePoint(0,0,0)).velocity(Fireworks.createShapePoint(0,0,0)).lifeTime(.2,.7).renderToThreejsParticleSystem({particleSystem:function(a){var c,e=new b.Geometry,f=Fireworks.ProceduralTextures.buildTexture(),g=new b.ParticleBasicMaterial({color:(new b.Color).setHSL(1,0,.6).getHex(),size:1.3,sizeAttenuation:!0,vertexColors:!0,map:f,blending:b.AdditiveBlending,depthWrite:!1,transparent:!0}),i=new b.ParticleSystem(e,g);for(i.dynamic=!0,i.sortParticles=!0,c=0;c<a.nParticles();c++)e.vertices.push(new b.Vector3);for(e.colors=new Array(a.nParticles()),c=0;c<a.nParticles();c++)e.colors[c]=d.sphere.material.color;return h.add(i),d.particleSystem=i,i}}).back().start()},a.Player.prototype.updateBlink=function(){return 0===this.blink.framesLeft?this:(1===this.blink.framesLeft&&this.sphere.material.color.copy(this.blink.defColor),this.blink.framesLeft===this.blink.frames&&this.sphere.material.color.copy(this.blink.color),this.blink.framesLeft<this.blink.frames&&this.sphere.material.color.add(this.blink.bColor),this.blink.framesLeft-=1,this)},a.Player.prototype.changeHelth=function(b){if(b>0||this.isInvulnerability===!1){var c=this.currentHelth;c>0&&(c+=b,0>c&&(c=0,a.$document.trigger("gameOver",{})),c>100&&(c=100)),this.currentHelth=c,a.$document.trigger("showHelth",{helth:this.currentHelth})}return this},a.Player.prototype.makeInvulner=function(b){return this.invulnerTimer=(b||1e4)/1e3*60,this.isInvulnerability=!0,a.$document.trigger("showInvulner",{invulner:!0}),this},a.Player.prototype.stopInvulner=function(){return this.invulnerTimer=0,this.isInvulnerability=!1,a.$document.trigger("showInvulner",{invulner:!1}),this},a.Player.prototype.changeScore=function(b){return this.currentScore+=b,a.$document.trigger("showScore",{score:this.currentScore}),this},a.Player.prototype.makeFun=function(b){return this.isFun=!0,this.funTimer=(b||1e4)/1e3*60,a.$document.trigger("showFun",{isFun:!0}),this},a.Player.prototype.stopFun=function(){return this.isFun=!1,this.funTimer=0,a.$document.trigger("showFun",{isFun:!1}),this},a.Player.prototype.updateInvulnerability=function(){if(this.isInvulnerability){if(this.invulnerTimer-=1,!(this.invulnerTimer<=0))return this;this.isInvulnerability=!1,a.$document.trigger("showInvulner",{invulner:!1})}return this},a.Player.prototype.updateFun=function(){if(this.isFun)if(this.funTimer-=1,this.funTimer<=0)this.stopFun();else if(this.funTimer%6===0){var c=(new b.Color).setRGB(a.genRandomFloorBetween(0,3),a.genRandomFloorBetween(0,3),a.genRandomFloorBetween(0,3));this.blink.doBlink(c,10)}return this},a.Player.prototype.update=function(b){var c=b.tube.path.getPointAt(b.t+.004),d=c.clone().multiplyScalar(a.scale);b.normalPos=d.clone(),d.add(l.multiplyScalar(a.scale*this.destPoint.x)),b.actualPos=d.clone(),this.updateInvulnerability(),this.updateFun(),this.updateBlink(),this.moveSphere(b),this.particleSystem.position.copy(this.position);var e=a.audio.valueAudio/10,f=b.tube.path.getTangentAt(b.t).negate().multiplyScalar(a.scale).setLength(3+e);return this.emitter.update(b.delta).render(),this.emitter._particles.forEach(function(a){a.velocity.vector=f}),this},a.Player.prototype.reset=function(){return this.currentHelth=100,this.currentScore=0,this.destPoint=new b.Vector3(0,0,0),this.isInvulnerability=!1,this.isFun=!1,this},a.Player.prototype.changeDestPoint=function(a){return a.equals(this.destPoint)||this.destPoint.add(a),this},a.Player.prototype.moveSphere=function(a){var b,c,d=a.normalPos,e=a.actualPos,f=7;return this.firstMove&&(this.position=e,this.prevActualPos=e,this.prevNormalPos=d,this.firstMove=!this.firstMove),b=d.clone().sub(this.position),this.position.add(b),this.prevActualPos.add(d.clone().sub(this.prevNormalPos)),this.prevNormalPos.add(d.clone().sub(this.prevNormalPos)),this.position.equals(e)?this.moveIterator-=1:(this.prevActualPos=e,this.moveIterator+=1),this.moveIterator>f&&(this.moveIterator=f),this.moveIterator<0&&(this.moveIterator=0),c=this.prevActualPos.clone().sub(d).multiplyScalar(this.moveIterator/f),this.position.add(c),d.equals(e)||(this.prevActualPos=e),this.light.position=this.sphere.position=this.position,this},a.Player.prototype.bump=function(b){if(!this.isInvulnerability){for(var c=0;2>c;c++)b=b||.15,this.sphere.position.x+=a.genRandomSign()*b,this.sphere.position.y+=a.genRandomSign()*b;return this}},a.player=new a.Player({currentHelth:100,currentScore:0,destPoint:new b.Vector3(0,0,0),isInvulnerability:!1,isFun:!1}),a.$document.on("update",function(b,c){a.player.update(c)}),a.$document.on("makeFun",function(){a.player.makeFun()}),a.$document.on("stopFun",function(){a.player.stopFun()}),a.$document.on("changeScore",function(b,c){a.player.changeScore(c.delta)}),a.$document.on("changeHelth",function(b,c){a.player.changeHelth(c.delta)}),a.$document.on("makeInvulner",function(){a.player.makeInvulner()}),a.$document.on("stopInvulner",function(){a.player.stopInvulner()}),a.$document.on("blink",function(b,c){a.player.blink.doBlink(c.color,c.frames)}),a.$document.on("gameOver",function(){a.player.stopFun()}),a.$document.on("resetGame",function(){a.player.reset()}),a.GameObject=function(b){this.tObject=new b.THREEConstructor(b.geometry,b.material),this.geometry=this.tObject.geometry,this.material=this.tObject.material,this.scene=b.scene||a.scene},a.GameObject.prototype.addToScene=function(){return this.scene.add(this.tObject),this},a.GameObject.prototype.removeFromScene=function(){return this.scene.remove(this.tObject),this},a.GameObject.prototype.create=function(){return console.log("try to call empty method"),this},a.GameObject.prototype.createAndAdd=function(){return this.create().addToScene()},a.GameObject.prototype.update=function(a){return this.updateGeometry(a.geometry).updateMaterial(a.material)},a.GameObject.prototype.updateGeometry=function(){return console.log("try to call empty method"),this},a.GameObject.prototype.updateMaterial=function(){return console.log("try to call empty method"),this},a.GameObject.prototype.updateParam=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(this.tObject[a][c]+=b[c]);return this},a.GameObject.prototype.setParam=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(this.tObject[a][c]=b[c]);return this},a.GameCollectionObject=function(b){a.GameObject.apply(this,arguments),this.collection=b.collection},a.GameCollectionObject.prototype=Object.create(a.GameObject.prototype),a.GameCollectionObject.prototype.constructor=a.GameCollectionObject,a.GameCollectionObject.prototype.create=function(){return this.collection.push(this),this},a.GameCollectionObject.prototype.update=function(a){this.tObject.position.distanceTo(a.dieCoord)<10&&this.removeFromScene();var c=this.tObject.position.distanceTo(a.opacityCoord),d=15;if(d>c){var e=c/d;this.tObject.children.length>0?this.tObject.children.forEach(function(a){a.material.transparent=!0,a.material.opacity=e}):this.tObject.material=new b.MeshLambertMaterial({shading:b.FlatShading,transparent:!0,opacity:e})}return this},a.GameCollectionObject.prototype.removeFromScene=function(){a.GameObject.prototype.removeFromScene.apply(this,arguments);var b=this.collection.indexOf(this);return-1!==b&&this.collection.splice(b,1),this},a.Shield=function(b){return a.Shield.__instance?a.Shield.__instance:(a.Shield.__instance=this,a.GameObject.apply(this,arguments),this.material.color=b.player.sphere.material.color,this.tObject.position=b.player.position,void(this.player=b.player))},a.Shield.prototype=Object.create(a.GameObject.prototype),a.Shield.prototype.constructor=a.Shield,a.Shield.prototype.update=function(){this.tObject.position=this.player.position},a.shield=new a.Shield({THREEConstructor:b.Mesh,geometry:new b.CubeGeometry(1.3,1.3,1.3,2,2,2),material:new b.MeshPhongMaterial({color:16777215,transparent:!0,opacity:.5}),player:a.player}),a.$document.on("update",function(){a.shield.update()}),a.$document.on("showInvulner",function(b,c){console.log("showInvulner"),c.invulner?a.shield.addToScene():a.shield.removeFromScene()}),a.Dust=function(b){a.GameObject.apply(this,arguments),this.number=b.number||100,this.createAndAdd()},a.Dust.prototype=Object.create(a.GameObject.prototype),a.Dust.prototype.constructor=a.Dust,a.Dust.prototype.create=function(){for(var b=j.vertices.length,c=0;b>c;c+=16)this.geometry.vertices.push(j.vertices[c].clone().multiplyScalar(a.scale));return this},a.Dust.prototype.updateMaterial=function(a){return this.material.color=a.isFun?a.color:(new b.Color).setRGB(0,0,0),this},a.Dust.prototype.updateGeometry=function(){return this},a.dust=new a.Dust({geometry:new b.Geometry({}),material:new b.ParticleSystemMaterial({size:.25}),THREEConstructor:b.ParticleSystem}),a.$document.on("update",function(){a.dust.update({material:{isFun:a.player.isFun,valueAudio:a.audio.valueAudio,color:a.player.sphere.material.color}})}),a.Stone=function(c){var d,e,f,g,h;d=a.genRandomBetween(1,2),f=a.genRandomFloorBetween(80,100)/255,e=(new b.Color).setRGB(f,f,f),g=new b.IcosahedronGeometry(d,0),h=new b.MeshPhongMaterial({shading:b.FlatShading,color:e,specular:1118481,shininess:100}),a.GameCollectionObject.apply(this,[{geometry:g,material:h,THREEConstructor:b.Mesh,collection:c.collection}]),this.t=c.t,this.tObject.position=c.position,this.setParam("rotation",{x:Math.random(),y:Math.random()}).createAndAdd(),this.distanceToSphere=null},a.Stone.prototype=Object.create(a.GameCollectionObject.prototype),a.Stone.prototype.constructor=a.Stone,a.Stone.prototype.update=function(c){a.GameCollectionObject.prototype.update.apply(this,arguments);var d=this.tObject;this.distanceToSphere=d.position.distanceTo(c.sphere.position),this.minDistance=c.sphere.geometry.radius+d.geometry.radius,this.distanceToSphere<this.minDistance&&(a.audio.sounds.stoneDestroy.play(),a.sendSocketMessage({type:"vibr",time:200}),this.removeFromScene(),a.$document.trigger("changeHelth",{delta:-19}),a.$document.trigger("bump",{}),a.player.isInvulnerability===!1&&a.hit()),this.distanceToSphere>this.minDistance&&this.distanceToSphere<this.minDistance+1&&a.audio.sounds.stoneMiss.play();var e=a.getBinormalAt(this.t),f=c.data.tube.path.getPointAt(this.t).multiplyScalar(a.scale).add(e.multiplyScalar(a.scale*a.player.destPoint.x));return d.position.distanceTo(f)<this.minDistance?a.player.isFun?(d.material.emissive=(new b.Color).setRGB(1,0,0),d.material.wireframe=!0):(d.material.emissive=(new b.Color).setRGB(.5,0,0),d.material.wireframe=!1):a.player.isFun?(d.material.emissive=(new b.Color).setRGB(0,1,0),d.material.wireframe=!0):(d.material.emissive=(new b.Color).setRGB(0,0,0),d.material.wireframe=!1),this.updateParam("rotation",{x:.014,y:.014}),this},a.Coin=function(c){var d,e=.5,f=new b.CylinderGeometry(e,e,.05,32,1,!0),g=new b.Geometry;for(d=0;100>d;d++){var h=1*d/100*Math.PI*2,i=Math.sin(h),j=Math.cos(h),k=1*(d+1)/100*Math.PI*2,l=Math.sin(k),m=Math.cos(k);g.vertices.push(new b.Vector3(0,0,0),new b.Vector3(j*e,0,i*e),new b.Vector3(m*e,0,l*e)),g.faceVertexUvs[0].push([new b.Vector2(.5,.5),new b.Vector2(j/2+.5,i/2+.5),new b.Vector2(m/2+.5,l/2+.5)]),g.faces.push(new b.Face3(3*d,3*d+1,3*d+2))
}g.computeCentroids(),g.computeFaceNormals();var n=a.Coin.texture,o=new b.MeshPhongMaterial({emissive:13612347,color:13612347}),p=new b.Mesh(f,o),q=new b.MeshPhongMaterial({emissive:13612347,color:13612347,map:n}),r=new b.Mesh(g,q),s=new b.Mesh(g,q);r.position.y=.05,s.position.y=-.05,r.rotation.x=Math.PI,a.GameCollectionObject.apply(this,[{THREEConstructor:b.Object3D,collection:c.collection}]),this.tObject.add(p),this.tObject.add(r),this.tObject.add(s);var t=a.normalizeT(c.t+.25+c.dt),u=a.getBinormalAt(t),v=c.tube.path.getPointAt(t).multiplyScalar(a.scale).add(u.clone().multiplyScalar(c.offset*a.scale));this.tObject.position=v,this.setParam("rotation",{x:1.5,y:0,z:c.zAngle}).createAndAdd()},a.Coin.prototype=Object.create(a.GameCollectionObject.prototype),a.Coin.prototype.constructor=a.Coin,a.Coin.texture=b.ImageUtils.loadTexture("./img/avers.png"),a.Coin.prototype.update=function(b){a.GameCollectionObject.prototype.update.apply(this,arguments),this.updateParam("rotation",{z:.05});var c=this.tObject.position,d=c.distanceTo(b.sphere.position);return.9>d&&(this.removeFromScene(),a.$document.trigger("changeScore",{delta:1}),a.audio.sounds.catchCoin.play(),a.sendSocketMessage({type:"vibr",time:10}),a.$document.trigger("blink",{color:13612347,frames:60}),a.player.bump()),this},a.Bonus=function(c){this.type=a.genRandomFloorBetween(0,2),a.GameCollectionObject.apply(this,[{geometry:a.listOfModels[this.type].geometry,material:a.listOfModels[this.type].material,THREEConstructor:b.Mesh,collection:c.collection}]);var d=c.t+.5;d=d>1?d-1:d;var e=a.getBinormalAt(d),f=c.tube.path.getPointAt(d).multiplyScalar(a.scale).add(e.clone().multiplyScalar(c.offset*a.scale));this.tObject.position=f,this.setParam("scale",{x:a.listOfModels[this.type].scale.x||1,y:a.listOfModels[this.type].scale.y||1,z:a.listOfModels[this.type].scale.z||1}).setParam("rotation",{x:a.listOfModels[this.type].rotation.x||0,y:a.listOfModels[this.type].rotation.y||0,z:a.listOfModels[this.type].rotation.z||0}).createAndAdd(),2===this.type&&(this.animation=new b.MorphAnimation(this.tObject),this.animation.play())},a.Bonus.prototype=Object.create(a.GameCollectionObject.prototype),a.Bonus.prototype.constructor=a.Bonus,a.Bonus.prototype.update=function(b){var c=this;a.GameCollectionObject.prototype.update.apply(this,arguments),0===this.type&&this.updateParam("rotation",{z:.05}),1===this.type&&this.updateParam("rotation",{z:.05}),2===this.type,this.animation&&this.animation.update(b.delta),this.tObject.position.distanceTo(b.sphere.position)<.9&&(this.removeFromScene(),a.$document.trigger("catchBonus",{type:c.type}))},a.Collection=function(a){this.collection=[],this.constructor=a.constructor},a.Collection.prototype.createObjects=function(a){return a.number=a.number||1,a.collection=this.collection,this},a.Collection.prototype.update=function(a){return this.collection.forEach(function(b){b.update(a)}),this},a.Collection.prototype.removeObjects=function(){return this.collection.forEach(function(a){a.removeFromScene()}),this},a.StonesCollection=function(){return a.StonesCollection.__instance?a.StonesCollection.__instance:(a.StonesCollection.__instance=this,void a.Collection.apply(this,[{constructor:a.Stone}]))},a.StonesCollection.prototype=Object.create(a.Collection.prototype),a.StonesCollection.prototype.constructor=a.StonesCollection,a.StonesCollection.prototype.createObjects=function(b){a.Collection.prototype.createObjects.apply(this,arguments);var c=this.collection[this.collection.length-1];if(c){var d=c.tObject.position.distanceTo(b.position);if(d<=a.game.param.stonesCloseness)return this}var e=5,f=!(new a.CoinsCollection).collection.every(function(a){return a.tObject.position.distanceTo(b.position)>e}),g=!(new a.BonusesCollection).collection.every(function(a){return a.tObject.position.distanceTo(b.position)>e});if(f||g)return this;for(var h=0;h<b.number;h++)new this.constructor(b);return this},a.$document.on("update",function(b,c){var d=a.normalizeT(c.t+.08),e=a.getBinormalAt(d);(new a.StonesCollection).createObjects({position:c.tube.path.getPointAt(d).multiplyScalar(a.scale).add(e.multiplyScalar(a.genRandomBetween(-5,5))),t:d,sphere:a.player.sphere}).update({dieCoord:c.tube.path.getPointAt(a.normalizeT(c.t-.008)).multiplyScalar(a.scale),opacityCoord:c.tube.path.getPointAt(a.normalizeT(c.t+.002)).multiplyScalar(a.scale),sphere:a.player.sphere,data:c})}),a.$document.on("resetGame",function(){(new a.StonesCollection).removeObjects()}),a.StaticStonesCollection=function(){return a.StaticStonesCollection.__instance?a.StaticStonesCollection.__instance:(a.StaticStonesCollection.__instance=this,void a.Collection.apply(this,[{constructor:a.Stone}]))},a.StaticStonesCollection.prototype=Object.create(a.Collection.prototype),a.StaticStonesCollection.prototype.constructor=a.StaticStonesCollection,a.StaticStonesCollection.prototype.createObjects=function(b){a.Collection.prototype.createObjects.apply(this,arguments);var c=this.collection[this.collection.length-1];if(c){var d=c.tObject.position.distanceTo(b.position);if(d<=a.game.param.stonesCloseness)return this}var e=10,f=!(new a.StaticStonesCollection).collection.every(function(a){return a.tObject.position.distanceTo(b.position)>e});if(f)return this;for(var g=0;g<b.number;g++)new this.constructor(b);return this},a.$document.on("update",function(b,c){{var d=a.normalizeT(c.t+.08);a.getBinormalAt(d)}(new a.StaticStonesCollection).createObjects({position:c.tube.vertices[a.genRandomFloorBetween(0,c.tube.vertices.length)].multiplyScalar(a.scale),t:d,sphere:a.player.sphere}).update({dieCoord:c.tube.path.getPointAt(a.normalizeT(c.t-.008)).multiplyScalar(a.scale),opacityCoord:c.tube.path.getPointAt(a.normalizeT(c.t+.002)).multiplyScalar(a.scale),sphere:a.player.sphere,data:c})}),a.$document.on("resetGame",function(){(new a.StaticStonesCollection).removeObjects()}),a.CoinsCollection=function(){return a.CoinsCollection.__instance?a.CoinsCollection.__instance:(a.CoinsCollection.__instance=this,void a.Collection.apply(this,[{constructor:a.Coin}]))},a.CoinsCollection.prototype=Object.create(a.Collection.prototype),a.CoinsCollection.prototype.constructor=a.CoinsCollection,a.CoinsCollection.prototype.createObjects=function(b){if(a.Collection.prototype.createObjects.apply(this,arguments),!this.collection.length)for(var c=0;c<b.number;c++)b.zAngle=.25*c,b.dt=.004*c,new this.constructor(b);return this},a.$document.on("update",function(b,c){(new a.CoinsCollection).createObjects({offset:a.genRandomFloorBetween(-1,1),tube:c.tube,t:c.t,zAngle:0,number:10}).update({dieCoord:c.tube.path.getPointAt(a.normalizeT(c.t-.008)).multiplyScalar(a.scale),opacityCoord:c.tube.path.getPointAt(a.normalizeT(c.t+.002)).multiplyScalar(a.scale),sphere:a.player.sphere,data:c})}),a.$document.on("resetGame",function(){(new a.CoinsCollection).removeObjects()}),a.BonusesCollection=function(){return a.BonusesCollection.__instance?a.BonusesCollection.__instance:(a.BonusesCollection.__instance=this,a.Collection.apply(this,[{constructor:a.Bonus}]),void(this.caughtBonuses=[]))},a.BonusesCollection.prototype=Object.create(a.Collection.prototype),a.BonusesCollection.prototype.constructor=a.BonusesCollection,a.BonusesCollection.prototype.createObjects=function(b){if(a.Collection.prototype.createObjects.apply(this,arguments),!this.collection.length)for(var c=0;c<b.number;c++)new this.constructor(b);return this},a.BonusesCollection.prototype.useBonuses=function(b){return 0===b&&a.$document.trigger("changeHelth",{delta:100}),1===b&&a.$document.trigger("makeInvulner",{}),2===b&&a.$document.trigger("makeFun",{}),this},a.BonusesCollection.prototype.catchBonus=function(b){var c=this;if(this.caughtBonuses.length&&this.caughtBonuses[0]!==b)this.caughtBonuses.length=0,this.caughtBonuses.push(b);else if(this.caughtBonuses.push(b),3===this.caughtBonuses.length){this.useBonuses(b);var d=setTimeout(function(){c.caughtBonuses.length=0,clearTimeout(d)},100)}return a.$document.trigger("showBonuses",{caughtBonuses:this.caughtBonuses}),this},a.BonusesCollection.prototype.reset=function(){this.caughtBonuses.length=0},a.$document.on("update",function(b,c){(new a.BonusesCollection).createObjects({offset:a.genRandomFloorBetween(-1,1),tube:c.tube,t:c.t}).update({dieCoord:c.tube.path.getPointAt(a.normalizeT(c.t-.008)).multiplyScalar(a.scale),opacityCoord:c.tube.path.getPointAt(a.normalizeT(c.t+.002)).multiplyScalar(a.scale),sphere:a.player.sphere,delta:1e3*c.delta})}),a.$document.on("catchBonus",function(b,c){(new a.BonusesCollection).catchBonus(c.type)}),a.$document.on("resetGame",function(){(new a.BonusesCollection).removeObjects().reset()}),a.audio={frequency:{0:400,1:100},valueAudio:0,webaudio:new c,sounds:{catchCoin:"sounds/coin.",gameover:"sounds/gameover.",pause:"sounds/pause.",stoneDestroy:"sounds/stoneDestroy.",stoneMiss:"sounds/stoneMiss."},music:{0:"sounds/theField_overTheIce.",1:"sounds/heart.",2:"sounds/space_ambient2.",started:[],startedAt:[],pausedAt:[],stopped:[],paused:[]}},a.audio.reset=function(){a.audio.music.startedAt.length=0,a.audio.music.pausedAt.length=0,a.audio.music.stopped.length=0,a.audio.music.paused.length=0,a.audio.music.started.length=0},a.setVolume=function(b){a.game.param.globalVolume=b,a.game.param.prevGlobalVolume!==a.game.param.globalVolume&&(a.gainNodes.forEach(function(b){b&&(b.gain.value=a.game.param.globalVolume)}),a.game.param.prevGlobalVolume=a.game.param.globalVolume)},a.$window.on("focus",function(){a.game.wasMuted||a.setVolume(1)}),a.$window.on("blur",function(){!a.game.wasStarted||a.game.wasPaused||a.game.wasOver||a.$document.trigger("pauseGame",{}),a.setVolume(0)}),a.$document.on("startGame",function(){a.stopSound(2),a.playSound(0)}),a.$document.on("resetGame",function(){a.audio.reset(),a.stopSound(2),a.playSound(0)}),a.$document.on("pauseGame",function(){a.stopSoundBeforPause(),a.audio.sounds.pause.play()}),a.$document.on("resumeGame",function(){a.playSoundAfterPause(),a.audio.sounds.pause.play()}),a.$document.on("gameOver",function(){a.stopSound(0),a.stopSound(1)}),a.$document.on("gameOver",function(){a.audio.sounds.gameover.play()}),d(function(){var b,d,e=0,f=[],g=[],h=[],i=[],j=new Audio,k=!!j.canPlayType&&""!==j.canPlayType("audio/ogg; codecs='vorbis'");console.log("canPlayOgg",k);try{window.AudioContext=window.AudioContext||window.webkitAudioContext,b=new AudioContext}catch(l){alert("Opps.. Your browser do not support audio API")}a.stopSound=function(b){a.audio.music.stopped[b]===!1&&((0===b||a.audio.music.paused[b]===!1)&&(a.audio.music.pausedAt[b]=Date.now()-a.audio.music.startedAt[b]),g[b].stop(b),a.audio.music.stopped[b]=!0,a.audio.music.started[b]=!1)},a.gainNodes=[],a.playSound=function(c){var e=a.gainNodes;a.audio.music.started[c]||(a.audio.music.started[c]=!0,g[c]=b.createBufferSource(),g[c].loop=!0,g[c].buffer=f[c],d=b.destination,e[c]=b.createGain(),e[c].gain.value=a.game.param.globalVolume,h[c]=b.createAnalyser(),h[c].fftSize=2048,h[c].minDecibels=-50,h[c].maxDecibels=-20,g[c].connect(e[c]),e[c].connect(h[c]),h[c].connect(d),a.$document.on("update",function(){q(c)}),a.audio.music.stopped[c]=!1,a.audio.music.pausedAt[c]?(a.audio.music.startedAt[c]=Date.now()-a.audio.music.pausedAt[c],g[c].start(c,a.audio.music.pausedAt[c]/1e3)):(a.audio.music.startedAt[c]=Date.now(),g[c].start(c)))},a.stopSoundBeforPause=function(){a.audio.music.stopped.forEach(function(b,c){a.audio.music.paused[c]=b,a.stopSound(c)})},a.playSoundAfterPause=function(){a.audio.music.paused.forEach(function(b,c){b||a.playSound(c)})};var m=function(a,c){b.decodeAudioData(a,function(a){f[c]=a,console.log("ready sound "+c),e+=1,yepnope.showLoading(e)},function(a){console.log("Error decoding file",a)})},n="ogg";k||(n="mp3");for(var o in a.audio.sounds)a.audio.sounds.hasOwnProperty(o)&&(a.audio.sounds[o]=a.audio.webaudio.createSound().load(a.audio.sounds[o]+n));var p=function(a,b){var c=new XMLHttpRequest;c.open("GET",a[b]+n,!0),c.responseType="arraybuffer",c.onload=function(){m(this.response,b)},c.send()};p(a.audio.music,0),p(a.audio.music,1),p(a.audio.music,2);var q=function(b){i[b]=new Uint8Array(h[b].frequencyBinCount),h[b].getByteFrequencyData(i[b]),a.audio.valueAudio=r(a.audio.frequency[b],b)},r=function(a,c){var d=b.sampleRate/2,e=Math.round(a/d*i[c].length);return i[c][e]};c.Sound.prototype.update=function(){this.volume(a.game.param.globalVolume)},c.Sound.prototype.play=function(b){if(this.volume(a.game.param.globalVolume),void 0===b&&(b=0),this.isPlayable()!==!1){var c=this._chain.cloneBufferSource();c.start(b);var d={node:c,stop:function(a){return void 0===a&&(a=0),this.node.stop(a),d}};return d}}}),a.initKeyboardControl=function(){a.$document.keydown(function(b){var c=b.keyCode;37===c&&a.handlers.toTheLeft(),39===c&&a.handlers.toTheRight(),16===c&&(a.$document.trigger("stopFun",{}),a.$document.trigger("changeSpeed",{changer:36})),17===c&&a.$document.trigger("makeFun",{})}),a.$document.keyup(function(b){var c=b.keyCode;16===c&&a.$document.trigger("changeSpeed",{changer:0})}),a.$document.keyup(a.handlers.pauseOnSpace)},a.$document.on("startGame",function(){a.initKeyboardControl()}),a.$document.on("gameOver",function(){a.$document.unbind("keyup",a.handlers.pauseOnSpace),a.$document.bind("keyup",a.handlers.restartOnSpace)}),a.server="http://localhost"!==window.location.origin?window.location.origin:"http://192.168.1.36",a.initSocket=function(){var b=-3,c=-20,e=3,f=20,g=a.initSocket.socket=io.connect(a.server);g.on("welcome",function(){g.emit("device",{type:"game",cookieUID:a.getCookie("UID")})}),g.on("initialize",function(a){g.gameCode=a}),g.on("connected",function(){d("#gameConnect").hide(),d("#status").hide(),a.startAfterChooseControl()}),g.on("turn",function(d){b>d?d>c?a.handlers.center():a.handlers.left():d>e?f>d?a.handlers.center():a.handlers.right():a.handlers.center()}),g.on("click",function(b){a.handlers[b]()})},a.sendSocketMessage=function(b){var c={type:b.type,time:b.time,gameCode:a.initSocket.socket.gameCode,sessionid:a.initSocket.socket.socket.sessionid,coinsCollect:a.player.currentScore};a.initSocket.socket&&a.initSocket.socket.emit("message",c)},a.$document.on("startGame",function(){a.sendSocketMessage("gamestarted")}),a.$document.on("resetGame",function(){a.sendSocketMessage("gamestarted")}),a.$document.on("gameOver",function(){a.sendSocketMessage("gameover")}),a.initPhoneControl=function(){d(".message").html("Please open <span style='color: red'>"+a.server+"/m</span> with your phone and enter code <span style='font-weight:bold; color: red' id='socketId'></span>"),d("#socketId").html(a.initSocket.socket.gameCode)},a.enableWebcam=function(){function b(b){k.src=window.URL?window.URL.createObjectURL(b):b,k.onerror=function(){b.stop()},b.onended=c,a.startAfterChooseControl()}function c(a){var b="No camera available.";1==a.code&&(b="User denied access to use camera."),console.log(b)}function e(){l.readyState===l.HAVE_ENOUGH_DATA&&n.drawImage(l,0,0,m.width,m.height)}function f(){var a=m.width,b=m.height,c=n.getImageData(0,0,a,b);x||(x=n.getImageData(0,0,a,b));var d=n.createImageData(a,b);g(d.data,c.data,x.data),p.putImageData(d,0,0),x=c}function g(a,b,c){if(b.length!=c.length)return null;for(var d=0;d<.25*b.length;){var e=(b[4*d]+b[4*d+1]+b[4*d+2])/3,f=(c[4*d]+c[4*d+1]+c[4*d+2])/3,g=i(h(e-f));a[4*d]=g,a[4*d+1]=g,a[4*d+2]=g,a[4*d+3]=255,++d}}function h(a){return(a^a>>31)-(a>>31)}function i(a){return a>21?255:0}function j(){var b,c=q.length;for(b=0;c>b;b++){for(var d=p.getImageData(q[b].x,q[b].y,q[b].w,q[b].h),e=0,f=0,g=.25*d.data.length;g>e;)f+=d.data[4*e]+d.data[4*e+1]+d.data[4*e+2],++e;var h=Math.round(f/(3*g));h>30&&(console.log("Button "+q[b].name+" triggered."),a.handlers[name]())}}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var k=document.getElementById("vid");navigator.getUserMedia||d(".message").html("Sorry. <code>navigator.getUserMedia()</code> is not available."),navigator.getUserMedia({video:!0},b,c),console.log(window.innerHeight,window.innerWidth);var l=document.getElementById("vid"),m=document.getElementById("debug"),n=m.getContext("2d");d("#debug").css({height:window.innerHeight,width:window.innerWidth,opacity:.2});var o=document.getElementById("compare"),p=o.getContext("2d");d("#compare").css({height:window.innerHeight,width:window.innerWidth,opacity:.2}),d(".cam").css({"background-color":"rgba(255,255,255,0.2)"}),d(".center").css({"background-color":"rgba(0,0,0,0.2)",width:"33%",height:"100%","margin-left":"33%"}),n.translate(320,0),n.scale(-1,1),n.fillStyle="#005337",n.fillRect(0,0,m.width,m.height);var q=[],r=new Image;r.src="img/lr.png";var s={name:"left",image:r,x:0,y:0,w:100,h:240,coord:-a.game.param.spacing};q.push(s);var t=new Image;t.src="img/lr.png";var u={name:"right",image:t,x:220,y:0,w:100,h:240,coord:a.game.param.spacing};q.push(u);var v=new Image;v.src="img/c.png";var w={name:"center",image:v,x:100,y:0,w:120,h:240,coord:0};q.push(w),a.$document.on("update",function(){e(),f(),j()});var x},a.$document.on("showFun",function(b,c){c.isFun?(a.$document.trigger("changeSpeed",{changer:-18}),a.stopSound(0),a.playSound(1)):(a.$document.trigger("changeSpeed",{changer:0}),a.stopSound(1),a.playSound(0))}),a.handlers={},a.handlers.startOnSpace=function(b){var c=b.keyCode;32===c&&a.startAfterChooseControl()},a.handlers.pauseOnSpace=function(b){var c=b.keyCode;32===c&&a.handlers.pause()},a.handlers.restartOnSpace=function(b){var c=b.keyCode;32===c&&a.$document.trigger("resetGame",{})},a.handlers.fullscreen=function(){var a=e.FullScreen.activated();a?e.FullScreen.cancel():e.FullScreen.request(document.body)},a.handlers.pause=function(){a.game.wasPaused?a.$document.trigger("resumeGame",{}):a.$document.trigger("pauseGame",{})},a.handlers.mute=function(){1===a.game.param.globalVolume?(a.setVolume(0),d(".music_button").html("N"),a.game.wasMuted=!0):(a.setVolume(1),d(".music_button").html("M"),a.game.wasMuted=!1)},a.handlers.toTheLeft=function(){a.player.changeDestPoint(new b.Vector3(-1,0,0))},a.handlers.toTheRight=function(){a.player.changeDestPoint(new b.Vector3(1,0,0))},a.handlers.left=function(){a.player.destPoint.copy(new b.Vector3(-1,0,0))},a.handlers.right=function(){a.player.destPoint.copy(new b.Vector3(1,0,0))},a.handlers.center=function(){a.player.destPoint.copy(new b.Vector3(0,0,0))},a.handlers.restart=function(){},a.$document.on("resetGame",function(){a.$document.bind("keyup",a.handlers.pauseOnSpace),a.$document.unbind("keyup",a.handlers.restartOnSpace)}),a.runApp=function(){a.initSocket(),a.setVolume(document.hasFocus()?1:0),a.playSound(2),d(function(){d(".loader").fadeOut(250),d(".choose_control").css({display:"table",opacity:"0"}).animate({opacity:"1"},250),a.$document.keyup(a.handlers.startOnSpace),d(".choose_wasd").click(function(){a.startAfterChooseControl()}),d(".choose_mobile").click(function(){a.initPhoneControl()}),d(".choose_webcam").click(function(){a.enableWebcam()})})},a.startAfterChooseControl=function(){a.game.wasStarted||a.$document.trigger("startGame",{}),a.$document.unbind("keyup",a.handlers.startOnSpace)},a.hit=function(){d(function(){d(".error").html("ERROR "+a.genRandomFloorBetween(500,511)),d(".hit").css({display:"table"}).fadeOut(250)})},d(".menu_button").click(function(){a.$document.trigger("pauseGame",{})}),d(".resume").click(function(){a.$document.trigger("resumeGame",{})}),d(".music_button").click(a.handlers.mute),d(".fs_button").click(a.handlers.fullscreen),a.$document.keyup(function(b){var c=b.keyCode;77===c&&a.handlers.mute()}),a.$document.keyup(function(b){var c=b.keyCode;70===c&&a.handlers.fullscreen()}),a.$document.on("startGame",function(){d(".choose_control").fadeOut(250)}),a.$document.on("pauseGame",function(){d(".menu_page").css({display:"table"})}),a.$document.on("resumeGame",function(){d(".menu_page").css({display:"none"})}),a.$document.on("startGame",function(){d(".gameTimer").css({display:"block"})}),a.$document.on("showScore",function(a,b){d(".current_coins").text(b.score)}),a.$document.on("showHelth",function(a,b){d(".helth").animate({width:b.helth+"%"})}),a.$document.on("showBonuses",function(a,b){d(".bonus").text(b.caughtBonuses.join(" ")),3===b.caughtBonuses.length&&d(".bonus").fadeOut(300,function(){d(".bonus").text("").fadeIn(100)})}),a.$document.on("gameOver",function(){d(".total_coins").text(a.player.currentScore),d(".game_over").css({display:"table",opacity:"0"}).animate({opacity:"1"},1e3),d("#one_more_time").click(function(){a.$document.trigger("resetGame",{})})}),a.$document.on("resetGame",function(){d(".current_coins").html("0"),d(".bonus").html(""),d(".gameTimer").html("0:00"),d(".helth").css({width:"100%"}),d(".game_over").hide(),d("#one_more_time").unbind("click")}),a.setStats=function(){var b=document.getElementsByTagName("body")[0];a.stats=a.stats||new Stats,a.stats.domElement.style.position="absolute",a.stats.domElement.style.top="0px",a.stats.domElement.style.zIndex=100,b.appendChild(a.stats.domElement),a.stats2=a.stats2||new Stats,a.stats2.setMode(1),a.stats2.domElement.style.position="absolute",a.stats2.domElement.style.top="0px",a.stats2.domElement.style.left="80px",a.stats2.domElement.style.zIndex=100,b.appendChild(a.stats2.domElement)},a.$document.on("startGame",function(){a.setStats()}),a.$document.on("update",function(){a.stats.update(),a.stats2.update()});var v=new e.RendererStats;return v.domElement.style.position="absolute",v.domElement.style.left="0px",v.domElement.style.top="50px",document.body.appendChild(v.domElement),a.$document.on("update",function(){v.update(a.renderer)}),a}();
//# sourceMappingURL=DT.min.map